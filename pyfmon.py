#!/usr/bin/python
# -*- coding: utf8 -*-
# Author: Qiuyanchen

import os
import re
import logging
from hashlib import md5
from multiprocessing.dummy import Pool
from struct import pack, unpack

logging.basicConfig(level=logging.DEBUG,
                    format='%(asctime)s (filename)s[line:%(lineno)d] %(levelname)s %(message)s',
                    datefmt='[%Y-%m-%d %H:%M:%S]',
                    filename='./filemon.log',
                    filemode='w')

console = logging.StreamHandler()
console.setLevel(logging.DEBUG)
formatter = logging.Formatter('[%(asctime)s] (filename)s[line:%(lineno)d] %(levelname)s %(message)s')
console.setFormatter(formatter)
logging.getLogger('').addHandler(console)

pyinotifydata = '''IyEvdXNyL2Jpbi9lbnYgcHl0aG9uCgojIHB5aW5vdGlmeS5weSAtIHB5dGhvbiBpbnRlcmZhY2Ug
dG8gaW5vdGlmeQojIENvcHlyaWdodCAoYykgMjAwNS0yMDE1IFNlYmFzdGllbiBNYXJ0aW5pIDxz
ZWJAZGJ6dGVhbS5vcmc+CiMKIyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9m
IGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5CiMgb2YgdGhpcyBzb2Z0d2Fy
ZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRv
IGRlYWwKIyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdp
dGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdl
LCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAojIGNvcGllcyBv
ZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2Fy
ZSBpcwojIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRp
dGlvbnM6CiMKIyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9u
IG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgojIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwg
cG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgojCiMgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJB
UyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKIyBJTVBMSUVE
LCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5U
QUJJTElUWSwKIyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklO
R0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKIyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xE
RVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiMgTElBQklMSVRZ
LCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFS
SVNJTkcgRlJPTSwKIyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBP
UiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCiMgVEhFIFNPRlRXQVJFLgoiIiIKcHlpbm90
aWZ5CgpAYXV0aG9yOiBTZWJhc3RpZW4gTWFydGluaQpAbGljZW5zZTogTUlUIExpY2Vuc2UKQGNv
bnRhY3Q6IHNlYkBkYnp0ZWFtLm9yZwoiIiIKCmNsYXNzIFB5aW5vdGlmeUVycm9yKEV4Y2VwdGlv
bik6CiAgICAiIiJJbmRpY2F0ZXMgZXhjZXB0aW9ucyByYWlzZWQgYnkgYSBQeWlub3RpZnkgY2xh
c3MuIiIiCiAgICBwYXNzCgoKY2xhc3MgVW5zdXBwb3J0ZWRQeXRob25WZXJzaW9uRXJyb3IoUHlp
bm90aWZ5RXJyb3IpOgogICAgIiIiCiAgICBSYWlzZWQgb24gdW5zdXBwb3J0ZWQgUHl0aG9uIHZl
cnNpb25zLgogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgdmVyc2lvbik6CiAgICAgICAg
IiIiCiAgICAgICAgQHBhcmFtIHZlcnNpb246IEN1cnJlbnQgUHl0aG9uIHZlcnNpb24KICAgICAg
ICBAdHlwZSB2ZXJzaW9uOiBzdHJpbmcKICAgICAgICAiIiIKICAgICAgICBlcnIgPSAnUHl0aG9u
ICVzIGlzIHVuc3VwcG9ydGVkLCByZXF1aXJlcyBhdCBsZWFzdCBQeXRob24gMi40JwogICAgICAg
IFB5aW5vdGlmeUVycm9yLl9faW5pdF9fKHNlbGYsIGVyciAlIHZlcnNpb24pCgoKIyBDaGVjayBQ
eXRob24gdmVyc2lvbgppbXBvcnQgc3lzCmlmIHN5cy52ZXJzaW9uX2luZm8gPCAoMiwgNCk6CiAg
ICByYWlzZSBVbnN1cHBvcnRlZFB5dGhvblZlcnNpb25FcnJvcihzeXMudmVyc2lvbikKCgojIElt
cG9ydCBkaXJlY3RpdmVzCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IG9zCmltcG9ydCBzZWxlY3QK
aW1wb3J0IHN0cnVjdAppbXBvcnQgZmNudGwKaW1wb3J0IGVycm5vCmltcG9ydCB0ZXJtaW9zCmlt
cG9ydCBhcnJheQppbXBvcnQgbG9nZ2luZwppbXBvcnQgYXRleGl0CmZyb20gY29sbGVjdGlvbnMg
aW1wb3J0IGRlcXVlCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lZGVsdGEKaW1w
b3J0IHRpbWUKaW1wb3J0IHJlCmltcG9ydCBhc3luY29yZQppbXBvcnQgc3VicHJvY2VzcwoKdHJ5
OgogICAgZnJvbSBmdW5jdG9vbHMgaW1wb3J0IHJlZHVjZQpleGNlcHQgSW1wb3J0RXJyb3I6CiAg
ICBwYXNzICAjIFdpbGwgZmFpbCBvbiBQeXRob24gMi40IHdoaWNoIGhhcyByZWR1Y2UoKSBidWls
dGluIGFueXdheS4KCnRyeToKICAgIGZyb20gZ2xvYiBpbXBvcnQgaWdsb2IgYXMgZ2xvYgpleGNl
cHQgSW1wb3J0RXJyb3I6CiAgICAjIFB5dGhvbiAyLjQgZG9lcyBub3QgaGF2ZSBnbG9iLmlnbG9i
KCkuCiAgICBmcm9tIGdsb2IgaW1wb3J0IGdsb2IgYXMgZ2xvYgoKdHJ5OgogICAgaW1wb3J0IGN0
eXBlcwogICAgaW1wb3J0IGN0eXBlcy51dGlsCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIGN0eXBl
cyA9IE5vbmUKCnRyeToKICAgIGltcG9ydCBpbm90aWZ5X3N5c2NhbGxzCmV4Y2VwdCBJbXBvcnRF
cnJvcjoKICAgIGlub3RpZnlfc3lzY2FsbHMgPSBOb25lCgoKX19hdXRob3JfXyA9ICJzZWJAZGJ6
dGVhbS5vcmcgKFNlYmFzdGllbiBNYXJ0aW5pKSIKCl9fdmVyc2lvbl9fID0gIjAuOS42IgoKX19t
ZXRhY2xhc3NfXyA9IHR5cGUgICMgVXNlIG5ldy1zdHlsZSBjbGFzc2VzIGJ5IGRlZmF1bHQKCgoj
IENvbXBhdGliaXR5IG1vZGU6IHNldCB0byBUcnVlIHRvIGltcHJvdmUgY29tcGF0aWJpbGl0eSB3
aXRoCiMgUHlpbm90aWZ5IDAuNy4xLiBEbyBub3Qgc2V0IHRoaXMgdmFyaWFibGUgeW91cnNlbGYs
IGNhbGwgdGhlCiMgZnVuY3Rpb24gY29tcGF0aWJpbGl0eV9tb2RlKCkgaW5zdGVhZC4KQ09NUEFU
SUJJTElUWV9NT0RFID0gRmFsc2UKCgpjbGFzcyBJbm90aWZ5QmluZGluZ05vdEZvdW5kRXJyb3Io
UHlpbm90aWZ5RXJyb3IpOgogICAgIiIiCiAgICBSYWlzZWQgd2hlbiBubyBpbm90aWZ5IHN1cHBv
cnQgY291bGRuJ3QgYmUgZm91bmQuCiAgICAiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAg
ICAgICBlcnIgPSAiQ291bGRuJ3QgZmluZCBhbnkgaW5vdGlmeSBiaW5kaW5nIgogICAgICAgIFB5
aW5vdGlmeUVycm9yLl9faW5pdF9fKHNlbGYsIGVycikKCgpjbGFzcyBJTm90aWZ5V3JhcHBlcjoK
ICAgICIiIgogICAgQWJzdHJhY3QgY2xhc3Mgd3JhcHBpbmcgYWNjZXNzIHRvIGlub3RpZnkncyBm
dW5jdGlvbnMuIFRoaXMgaXMgYW4KICAgIGludGVybmFsIGNsYXNzLgogICAgIiIiCiAgICBAc3Rh
dGljbWV0aG9kCiAgICBkZWYgY3JlYXRlKCk6CiAgICAgICAgIiIiCiAgICAgICAgRmFjdG9yeSBt
ZXRob2QgaW5zdGFuY2lhdGluZyBhbmQgcmV0dXJuaW5nIHRoZSByaWdodCB3cmFwcGVyLgogICAg
ICAgICIiIgogICAgICAgICMgRmlyc3QsIHRyeSB0byB1c2UgY3R5cGVzLgogICAgICAgIGlmIGN0
eXBlczoKICAgICAgICAgICAgaW5vdGlmeSA9IF9DdHlwZXNMaWJjSU5vdGlmeVdyYXBwZXIoKQog
ICAgICAgICAgICBpZiBpbm90aWZ5LmluaXQoKToKICAgICAgICAgICAgICAgIHJldHVybiBpbm90
aWZ5CiAgICAgICAgIyBTZWNvbmQsIHNlZSBpZiBDIGV4dGVuc2lvbiBpcyBjb21waWxlZC4KICAg
ICAgICBpZiBpbm90aWZ5X3N5c2NhbGxzOgogICAgICAgICAgICBpbm90aWZ5ID0gX0lOb3RpZnlT
eXNjYWxsc1dyYXBwZXIoKQogICAgICAgICAgICBpZiBpbm90aWZ5LmluaXQoKToKICAgICAgICAg
ICAgICAgIHJldHVybiBpbm90aWZ5CgogICAgZGVmIGdldF9lcnJubyhzZWxmKToKICAgICAgICAi
IiIKICAgICAgICBSZXR1cm4gTm9uZSBpcyBubyBlcnJubyBjb2RlIGlzIGF2YWlsYWJsZS4KICAg
ICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fZ2V0X2Vycm5vKCkKCiAgICBkZWYgc3RyX2Vy
cm5vKHNlbGYpOgogICAgICAgIGNvZGUgPSBzZWxmLmdldF9lcnJubygpCiAgICAgICAgaWYgY29k
ZSBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gJ0Vycm5vOiBubyBlcnJubyBzdXBwb3J0Jwog
ICAgICAgIHJldHVybiAnRXJybm89JXMgKCVzKScgJSAob3Muc3RyZXJyb3IoY29kZSksIGVycm5v
LmVycm9yY29kZVtjb2RlXSkKCiAgICBkZWYgaW5vdGlmeV9pbml0KHNlbGYpOgogICAgICAgIHJl
dHVybiBzZWxmLl9pbm90aWZ5X2luaXQoKQoKICAgIGRlZiBpbm90aWZ5X2FkZF93YXRjaChzZWxm
LCBmZCwgcGF0aG5hbWUsIG1hc2spOgogICAgICAgICMgVW5pY29kZSBzdHJpbmdzIG11c3QgYmUg
ZW5jb2RlZCB0byBzdHJpbmcgcHJpb3IgdG8gY2FsbGluZyB0aGlzCiAgICAgICAgIyBtZXRob2Qu
CiAgICAgICAgYXNzZXJ0IGlzaW5zdGFuY2UocGF0aG5hbWUsIHN0cikKICAgICAgICByZXR1cm4g
c2VsZi5faW5vdGlmeV9hZGRfd2F0Y2goZmQsIHBhdGhuYW1lLCBtYXNrKQoKICAgIGRlZiBpbm90
aWZ5X3JtX3dhdGNoKHNlbGYsIGZkLCB3ZCk6CiAgICAgICAgcmV0dXJuIHNlbGYuX2lub3RpZnlf
cm1fd2F0Y2goZmQsIHdkKQoKCmNsYXNzIF9JTm90aWZ5U3lzY2FsbHNXcmFwcGVyKElOb3RpZnlX
cmFwcGVyKToKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICAjIFN0b3JlcyB0aGUgbGFz
dCBlcnJubyB2YWx1ZS4KICAgICAgICBzZWxmLl9sYXN0X2Vycm5vID0gTm9uZQoKICAgIGRlZiBp
bml0KHNlbGYpOgogICAgICAgIGFzc2VydCBpbm90aWZ5X3N5c2NhbGxzCiAgICAgICAgcmV0dXJu
IFRydWUKCiAgICBkZWYgX2dldF9lcnJubyhzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5fbGFz
dF9lcnJubwoKICAgIGRlZiBfaW5vdGlmeV9pbml0KHNlbGYpOgogICAgICAgIHRyeToKICAgICAg
ICAgICAgZmQgPSBpbm90aWZ5X3N5c2NhbGxzLmlub3RpZnlfaW5pdCgpCiAgICAgICAgZXhjZXB0
IElPRXJyb3IsIGVycjoKICAgICAgICAgICAgc2VsZi5fbGFzdF9lcnJubyA9IGVyci5lcnJubwog
ICAgICAgICAgICByZXR1cm4gLTEKICAgICAgICByZXR1cm4gZmQKCiAgICBkZWYgX2lub3RpZnlf
YWRkX3dhdGNoKHNlbGYsIGZkLCBwYXRobmFtZSwgbWFzayk6CiAgICAgICAgdHJ5OgogICAgICAg
ICAgICB3ZCA9IGlub3RpZnlfc3lzY2FsbHMuaW5vdGlmeV9hZGRfd2F0Y2goZmQsIHBhdGhuYW1l
LCBtYXNrKQogICAgICAgIGV4Y2VwdCBJT0Vycm9yLCBlcnI6CiAgICAgICAgICAgIHNlbGYuX2xh
c3RfZXJybm8gPSBlcnIuZXJybm8KICAgICAgICAgICAgcmV0dXJuIC0xCiAgICAgICAgcmV0dXJu
IHdkCgogICAgZGVmIF9pbm90aWZ5X3JtX3dhdGNoKHNlbGYsIGZkLCB3ZCk6CiAgICAgICAgdHJ5
OgogICAgICAgICAgICByZXQgPSBpbm90aWZ5X3N5c2NhbGxzLmlub3RpZnlfcm1fd2F0Y2goZmQs
IHdkKQogICAgICAgIGV4Y2VwdCBJT0Vycm9yLCBlcnI6CiAgICAgICAgICAgIHNlbGYuX2xhc3Rf
ZXJybm8gPSBlcnIuZXJybm8KICAgICAgICAgICAgcmV0dXJuIC0xCiAgICAgICAgcmV0dXJuIHJl
dAoKCmNsYXNzIF9DdHlwZXNMaWJjSU5vdGlmeVdyYXBwZXIoSU5vdGlmeVdyYXBwZXIpOgogICAg
ZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuX2xpYmMgPSBOb25lCiAgICAgICAgc2Vs
Zi5fZ2V0X2Vycm5vX2Z1bmMgPSBOb25lCgogICAgZGVmIGluaXQoc2VsZik6CiAgICAgICAgYXNz
ZXJ0IGN0eXBlcwoKICAgICAgICB0cnlfbGliY19uYW1lID0gJ2MnCiAgICAgICAgaWYgc3lzLnBs
YXRmb3JtLnN0YXJ0c3dpdGgoJ2ZyZWVic2QnKToKICAgICAgICAgICAgdHJ5X2xpYmNfbmFtZSA9
ICdpbm90aWZ5JwoKICAgICAgICBsaWJjX25hbWUgPSBOb25lCiAgICAgICAgdHJ5OgogICAgICAg
ICAgICBsaWJjX25hbWUgPSBjdHlwZXMudXRpbC5maW5kX2xpYnJhcnkodHJ5X2xpYmNfbmFtZSkK
ICAgICAgICBleGNlcHQgKE9TRXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICBwYXNzICAjIFdp
bGwgYXR0ZW1wIHRvIGxvYWQgaXQgd2l0aCBOb25lIGFueXdheS4KCiAgICAgICAgaWYgc3lzLnZl
cnNpb25faW5mbyA+PSAoMiwgNik6CiAgICAgICAgICAgIHNlbGYuX2xpYmMgPSBjdHlwZXMuQ0RM
TChsaWJjX25hbWUsIHVzZV9lcnJubz1UcnVlKQogICAgICAgICAgICBzZWxmLl9nZXRfZXJybm9f
ZnVuYyA9IGN0eXBlcy5nZXRfZXJybm8KICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLl9s
aWJjID0gY3R5cGVzLkNETEwobGliY19uYW1lKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAg
ICAgICBsb2NhdGlvbiA9IHNlbGYuX2xpYmMuX19lcnJub19sb2NhdGlvbgogICAgICAgICAgICAg
ICAgbG9jYXRpb24ucmVzdHlwZSA9IGN0eXBlcy5QT0lOVEVSKGN0eXBlcy5jX2ludCkKICAgICAg
ICAgICAgICAgIHNlbGYuX2dldF9lcnJub19mdW5jID0gbGFtYmRhOiBsb2NhdGlvbigpLmNvbnRl
bnRzLnZhbHVlCiAgICAgICAgICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvcjoKICAgICAgICAgICAg
ICAgIHBhc3MKCiAgICAgICAgIyBFdmVudHVhbGx5IGNoZWNrIHRoYXQgbGliYyBoYXMgbmVlZGVk
IGlub3RpZnkgYmluZGluZ3MuCiAgICAgICAgaWYgKG5vdCBoYXNhdHRyKHNlbGYuX2xpYmMsICdp
bm90aWZ5X2luaXQnKSBvcgogICAgICAgICAgICBub3QgaGFzYXR0cihzZWxmLl9saWJjLCAnaW5v
dGlmeV9hZGRfd2F0Y2gnKSBvcgogICAgICAgICAgICBub3QgaGFzYXR0cihzZWxmLl9saWJjLCAn
aW5vdGlmeV9ybV93YXRjaCcpKToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIHNl
bGYuX2xpYmMuaW5vdGlmeV9pbml0LmFyZ3R5cGVzID0gW10KICAgICAgICBzZWxmLl9saWJjLmlu
b3RpZnlfaW5pdC5yZXN0eXBlID0gY3R5cGVzLmNfaW50CiAgICAgICAgc2VsZi5fbGliYy5pbm90
aWZ5X2FkZF93YXRjaC5hcmd0eXBlcyA9IFtjdHlwZXMuY19pbnQsIGN0eXBlcy5jX2NoYXJfcCwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eXBlcy5j
X3VpbnQzMl0KICAgICAgICBzZWxmLl9saWJjLmlub3RpZnlfYWRkX3dhdGNoLnJlc3R5cGUgPSBj
dHlwZXMuY19pbnQKICAgICAgICBzZWxmLl9saWJjLmlub3RpZnlfcm1fd2F0Y2guYXJndHlwZXMg
PSBbY3R5cGVzLmNfaW50LCBjdHlwZXMuY19pbnRdCiAgICAgICAgc2VsZi5fbGliYy5pbm90aWZ5
X3JtX3dhdGNoLnJlc3R5cGUgPSBjdHlwZXMuY19pbnQKICAgICAgICByZXR1cm4gVHJ1ZQoKICAg
IGRlZiBfZ2V0X2Vycm5vKHNlbGYpOgogICAgICAgIGlmIHNlbGYuX2dldF9lcnJub19mdW5jIGlz
IG5vdCBOb25lOgogICAgICAgICAgICByZXR1cm4gc2VsZi5fZ2V0X2Vycm5vX2Z1bmMoKQogICAg
ICAgIHJldHVybiBOb25lCgogICAgZGVmIF9pbm90aWZ5X2luaXQoc2VsZik6CiAgICAgICAgYXNz
ZXJ0IHNlbGYuX2xpYmMgaXMgbm90IE5vbmUKICAgICAgICByZXR1cm4gc2VsZi5fbGliYy5pbm90
aWZ5X2luaXQoKQoKICAgIGRlZiBfaW5vdGlmeV9hZGRfd2F0Y2goc2VsZiwgZmQsIHBhdGhuYW1l
LCBtYXNrKToKICAgICAgICBhc3NlcnQgc2VsZi5fbGliYyBpcyBub3QgTm9uZQogICAgICAgIHBh
dGhuYW1lID0gY3R5cGVzLmNyZWF0ZV9zdHJpbmdfYnVmZmVyKHBhdGhuYW1lKQogICAgICAgIHJl
dHVybiBzZWxmLl9saWJjLmlub3RpZnlfYWRkX3dhdGNoKGZkLCBwYXRobmFtZSwgbWFzaykKCiAg
ICBkZWYgX2lub3RpZnlfcm1fd2F0Y2goc2VsZiwgZmQsIHdkKToKICAgICAgICBhc3NlcnQgc2Vs
Zi5fbGliYyBpcyBub3QgTm9uZQogICAgICAgIHJldHVybiBzZWxmLl9saWJjLmlub3RpZnlfcm1f
d2F0Y2goZmQsIHdkKQoKCiMgTG9nZ2luZwpkZWYgbG9nZ2VyX2luaXQoKToKICAgICIiIkluaXRp
YWxpemUgbG9nZ2VyIGluc3RhbmNlLiIiIgogICAgbG9nID0gbG9nZ2luZy5nZXRMb2dnZXIoInB5
aW5vdGlmeSIpCiAgICBjb25zb2xlX2hhbmRsZXIgPSBsb2dnaW5nLlN0cmVhbUhhbmRsZXIoKQog
ICAgY29uc29sZV9oYW5kbGVyLnNldEZvcm1hdHRlcigKICAgICAgICBsb2dnaW5nLkZvcm1hdHRl
cigiWyUoYXNjdGltZSlzICUobmFtZSlzICUobGV2ZWxuYW1lKXNdICUobWVzc2FnZSlzIikpCiAg
ICBsb2cuYWRkSGFuZGxlcihjb25zb2xlX2hhbmRsZXIpCiAgICBsb2cuc2V0TGV2ZWwoMjApCiAg
ICByZXR1cm4gbG9nCgpsb2cgPSBsb2dnZXJfaW5pdCgpCgoKIyBpbm90aWZ5J3MgdmFyaWFibGVz
CmNsYXNzIFByb2NJTm90aWZ5OgogICAgIiIiCiAgICBBY2Nlc3MgKHJlYWQsIHdyaXRlKSBpbm90
aWZ5J3MgdmFyaWFibGVzIHRocm91Z2ggL3Byb2Mvc3lzLy4gTm90ZSB0aGF0CiAgICB1c3VhbGx5
IGl0IHJlcXVpcmVzIGFkbWluaXN0cmF0b3IgcmlnaHRzIHRvIHVwZGF0ZSB0aGVtLgoKICAgIEV4
YW1wbGVzOgogICAgICAtIFJlYWQgbWF4X3F1ZXVlZF9ldmVudHMgYXR0cmlidXRlOiBteXZhciA9
IG1heF9xdWV1ZWRfZXZlbnRzLnZhbHVlCiAgICAgIC0gVXBkYXRlIG1heF9xdWV1ZWRfZXZlbnRz
IGF0dHJpYnV0ZTogbWF4X3F1ZXVlZF9ldmVudHMudmFsdWUgPSA0MgogICAgIiIiCiAgICBkZWYg
X19pbml0X18oc2VsZiwgYXR0cik6CiAgICAgICAgc2VsZi5fYmFzZSA9ICIvcHJvYy9zeXMvZnMv
aW5vdGlmeSIKICAgICAgICBzZWxmLl9hdHRyID0gYXR0cgoKICAgIGRlZiBnZXRfdmFsKHNlbGYp
OgogICAgICAgICIiIgogICAgICAgIEdldHMgYXR0cmlidXRlJ3MgdmFsdWUuCgogICAgICAgIEBy
ZXR1cm46IHN0b3JlZCB2YWx1ZS4KICAgICAgICBAcnR5cGU6IGludAogICAgICAgIEByYWlzZSBJ
T0Vycm9yOiBpZiBjb3JyZXNwb25kaW5nIGZpbGUgaW4gL3Byb2Mvc3lzIGNhbm5vdCBiZSByZWFk
LgogICAgICAgICIiIgogICAgICAgIGZpbGVfb2JqID0gZmlsZShvcy5wYXRoLmpvaW4oc2VsZi5f
YmFzZSwgc2VsZi5fYXR0ciksICdyJykKICAgICAgICB0cnk6CiAgICAgICAgICAgIHZhbCA9IGlu
dChmaWxlX29iai5yZWFkbGluZSgpKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIGZpbGVf
b2JqLmNsb3NlKCkKICAgICAgICByZXR1cm4gdmFsCgogICAgZGVmIHNldF92YWwoc2VsZiwgbnZh
bCk6CiAgICAgICAgIiIiCiAgICAgICAgU2V0cyBuZXcgYXR0cmlidXRlJ3MgdmFsdWUuCgogICAg
ICAgIEBwYXJhbSBudmFsOiByZXBsYWNlcyBjdXJyZW50IHZhbHVlIGJ5IG52YWwuCiAgICAgICAg
QHR5cGUgbnZhbDogaW50CiAgICAgICAgQHJhaXNlIElPRXJyb3I6IGlmIGNvcnJlc3BvbmRpbmcg
ZmlsZSBpbiAvcHJvYy9zeXMgY2Fubm90IGJlIHdyaXR0ZW4uCiAgICAgICAgIiIiCiAgICAgICAg
ZmlsZV9vYmogPSBmaWxlKG9zLnBhdGguam9pbihzZWxmLl9iYXNlLCBzZWxmLl9hdHRyKSwgJ3cn
KQogICAgICAgIHRyeToKICAgICAgICAgICAgZmlsZV9vYmoud3JpdGUoc3RyKG52YWwpICsgJ1xu
JykKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICBmaWxlX29iai5jbG9zZSgpCgogICAgdmFs
dWUgPSBwcm9wZXJ0eShnZXRfdmFsLCBzZXRfdmFsKQoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToK
ICAgICAgICByZXR1cm4gJzwlcz0lZD4nICUgKHNlbGYuX2F0dHIsIHNlbGYuZ2V0X3ZhbCgpKQoK
CiMgSW5vdGlmeSdzIHZhcmlhYmxlcwojCiMgTm90ZTogbWF5IHJhaXNlIElPRXJyb3IgaWYgdGhl
IGNvcnJlc3BvbmRpbmcgdmFsdWUgaW4gL3Byb2Mvc3lzCiMgICAgICAgY2Fubm90IGJlIGFjY2Vz
c2VkLgojCiMgRXhhbXBsZXM6CiMgIC0gcmVhZDogbXl2YXIgPSBtYXhfcXVldWVkX2V2ZW50cy52
YWx1ZQojICAtIHVwZGF0ZTogbWF4X3F1ZXVlZF9ldmVudHMudmFsdWUgPSA0MgojCmZvciBhdHRy
bmFtZSBpbiAoJ21heF9xdWV1ZWRfZXZlbnRzJywgJ21heF91c2VyX2luc3RhbmNlcycsICdtYXhf
dXNlcl93YXRjaGVzJyk6CiAgICBnbG9iYWxzKClbYXR0cm5hbWVdID0gUHJvY0lOb3RpZnkoYXR0
cm5hbWUpCgoKY2xhc3MgRXZlbnRzQ29kZXM6CiAgICAiIiIKICAgIFNldCBvZiBjb2RlcyBjb3Jy
ZXNwb25kaW5nIHRvIGVhY2gga2luZCBvZiBldmVudHMuCiAgICBTb21lIG9mIHRoZXNlIGZsYWdz
IGFyZSB1c2VkIHRvIGNvbW11bmljYXRlIHdpdGggaW5vdGlmeSwgd2hlcmVhcwogICAgdGhlIG90
aGVycyBhcmUgc2VudCB0byB1c2Vyc3BhY2UgYnkgaW5vdGlmeSBub3RpZnlpbmcgc29tZSBldmVu
dHMuCgogICAgQGN2YXIgSU5fQUNDRVNTOiBGaWxlIHdhcyBhY2Nlc3NlZC4KICAgIEB0eXBlIElO
X0FDQ0VTUzogaW50CiAgICBAY3ZhciBJTl9NT0RJRlk6IEZpbGUgd2FzIG1vZGlmaWVkLgogICAg
QHR5cGUgSU5fTU9ESUZZOiBpbnQKICAgIEBjdmFyIElOX0FUVFJJQjogTWV0YWRhdGEgY2hhbmdl
ZC4KICAgIEB0eXBlIElOX0FUVFJJQjogaW50CiAgICBAY3ZhciBJTl9DTE9TRV9XUklURTogV3Jp
dHRhYmxlIGZpbGUgd2FzIGNsb3NlZC4KICAgIEB0eXBlIElOX0NMT1NFX1dSSVRFOiBpbnQKICAg
IEBjdmFyIElOX0NMT1NFX05PV1JJVEU6IFVud3JpdHRhYmxlIGZpbGUgY2xvc2VkLgogICAgQHR5
cGUgSU5fQ0xPU0VfTk9XUklURTogaW50CiAgICBAY3ZhciBJTl9PUEVOOiBGaWxlIHdhcyBvcGVu
ZWQuCiAgICBAdHlwZSBJTl9PUEVOOiBpbnQKICAgIEBjdmFyIElOX01PVkVEX0ZST006IEZpbGUg
d2FzIG1vdmVkIGZyb20gWC4KICAgIEB0eXBlIElOX01PVkVEX0ZST006IGludAogICAgQGN2YXIg
SU5fTU9WRURfVE86IEZpbGUgd2FzIG1vdmVkIHRvIFkuCiAgICBAdHlwZSBJTl9NT1ZFRF9UTzog
aW50CiAgICBAY3ZhciBJTl9DUkVBVEU6IFN1YmZpbGUgd2FzIGNyZWF0ZWQuCiAgICBAdHlwZSBJ
Tl9DUkVBVEU6IGludAogICAgQGN2YXIgSU5fREVMRVRFOiBTdWJmaWxlIHdhcyBkZWxldGVkLgog
ICAgQHR5cGUgSU5fREVMRVRFOiBpbnQKICAgIEBjdmFyIElOX0RFTEVURV9TRUxGOiBTZWxmICh3
YXRjaGVkIGl0ZW0gaXRzZWxmKSB3YXMgZGVsZXRlZC4KICAgIEB0eXBlIElOX0RFTEVURV9TRUxG
OiBpbnQKICAgIEBjdmFyIElOX01PVkVfU0VMRjogU2VsZiAod2F0Y2hlZCBpdGVtIGl0c2VsZikg
d2FzIG1vdmVkLgogICAgQHR5cGUgSU5fTU9WRV9TRUxGOiBpbnQKICAgIEBjdmFyIElOX1VOTU9V
TlQ6IEJhY2tpbmcgZnMgd2FzIHVubW91bnRlZC4KICAgIEB0eXBlIElOX1VOTU9VTlQ6IGludAog
ICAgQGN2YXIgSU5fUV9PVkVSRkxPVzogRXZlbnQgcXVldWVkIG92ZXJmbG93ZWQuCiAgICBAdHlw
ZSBJTl9RX09WRVJGTE9XOiBpbnQKICAgIEBjdmFyIElOX0lHTk9SRUQ6IEZpbGUgd2FzIGlnbm9y
ZWQuCiAgICBAdHlwZSBJTl9JR05PUkVEOiBpbnQKICAgIEBjdmFyIElOX09OTFlESVI6IG9ubHkg
d2F0Y2ggdGhlIHBhdGggaWYgaXQgaXMgYSBkaXJlY3RvcnkgKG5ldwogICAgICAgICAgICAgICAg
ICAgICAgaW4ga2VybmVsIDIuNi4xNSkuCiAgICBAdHlwZSBJTl9PTkxZRElSOiBpbnQKICAgIEBj
dmFyIElOX0RPTlRfRk9MTE9XOiBkb24ndCBmb2xsb3cgYSBzeW1saW5rIChuZXcgaW4ga2VybmVs
IDIuNi4xNSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgSU5fT05MWURJUiB3ZSBjYW4gbWFr
ZSBzdXJlIHRoYXQgd2UgZG9uJ3Qgd2F0Y2gKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUg
dGFyZ2V0IG9mIHN5bWxpbmtzLgogICAgQHR5cGUgSU5fRE9OVF9GT0xMT1c6IGludAogICAgQGN2
YXIgSU5fRVhDTF9VTkxJTks6IEV2ZW50cyBhcmUgbm90IGdlbmVyYXRlZCBmb3IgY2hpbGRyZW4g
YWZ0ZXIgdGhleQogICAgICAgICAgICAgICAgICAgICAgICAgIGhhdmUgYmVlbiB1bmxpbmtlZCBm
cm9tIHRoZSB3YXRjaGVkIGRpcmVjdG9yeS4KICAgICAgICAgICAgICAgICAgICAgICAgICAobmV3
IGluIGtlcm5lbCAyLjYuMzYpLgogICAgQHR5cGUgSU5fRVhDTF9VTkxJTks6IGludAogICAgQGN2
YXIgSU5fTUFTS19BREQ6IGFkZCB0byB0aGUgbWFzayBvZiBhbiBhbHJlYWR5IGV4aXN0aW5nIHdh
dGNoIChuZXcKICAgICAgICAgICAgICAgICAgICAgICBpbiBrZXJuZWwgMi42LjE0KS4KICAgIEB0
eXBlIElOX01BU0tfQUREOiBpbnQKICAgIEBjdmFyIElOX0lTRElSOiBFdmVudCBvY2N1cnJlZCBh
Z2FpbnN0IGRpci4KICAgIEB0eXBlIElOX0lTRElSOiBpbnQKICAgIEBjdmFyIElOX09ORVNIT1Q6
IE9ubHkgc2VuZCBldmVudCBvbmNlLgogICAgQHR5cGUgSU5fT05FU0hPVDogaW50CiAgICBAY3Zh
ciBBTExfRVZFTlRTOiBBbGlhcyBmb3IgY29uc2lkZXJpbmcgYWxsIG9mIHRoZSBldmVudHMuCiAg
ICBAdHlwZSBBTExfRVZFTlRTOiBpbnQKICAgICIiIgoKICAgICMgVGhlIGlkZWEgaGVyZSBpcyAn
Y29uZmlndXJhdGlvbi1hcy1jb2RlJyAtIHRoaXMgd2F5LCB3ZSBnZXQgb3VyIG5pY2UgY2xhc3MK
ICAgICMgY29uc3RhbnRzLCBidXQgd2UgYWxzbyBnZXQgbmljZSBodW1hbi1mcmllbmRseSB0ZXh0
IG1hcHBpbmdzIHRvIGRvIGxvb2t1cHMKICAgICMgYWdhaW5zdCBhcyB3ZWxsLCBmb3IgZnJlZToK
ICAgIEZMQUdfQ09MTEVDVElPTlMgPSB7J09QX0ZMQUdTJzogewogICAgICAgICdJTl9BQ0NFU1Mn
ICAgICAgICA6IDB4MDAwMDAwMDEsICAjIEZpbGUgd2FzIGFjY2Vzc2VkCiAgICAgICAgJ0lOX01P
RElGWScgICAgICAgIDogMHgwMDAwMDAwMiwgICMgRmlsZSB3YXMgbW9kaWZpZWQKICAgICAgICAn
SU5fQVRUUklCJyAgICAgICAgOiAweDAwMDAwMDA0LCAgIyBNZXRhZGF0YSBjaGFuZ2VkCiAgICAg
ICAgJ0lOX0NMT1NFX1dSSVRFJyAgIDogMHgwMDAwMDAwOCwgICMgV3JpdGFibGUgZmlsZSB3YXMg
Y2xvc2VkCiAgICAgICAgJ0lOX0NMT1NFX05PV1JJVEUnIDogMHgwMDAwMDAxMCwgICMgVW53cml0
YWJsZSBmaWxlIGNsb3NlZAogICAgICAgICdJTl9PUEVOJyAgICAgICAgICA6IDB4MDAwMDAwMjAs
ICAjIEZpbGUgd2FzIG9wZW5lZAogICAgICAgICdJTl9NT1ZFRF9GUk9NJyAgICA6IDB4MDAwMDAw
NDAsICAjIEZpbGUgd2FzIG1vdmVkIGZyb20gWAogICAgICAgICdJTl9NT1ZFRF9UTycgICAgICA6
IDB4MDAwMDAwODAsICAjIEZpbGUgd2FzIG1vdmVkIHRvIFkKICAgICAgICAnSU5fQ1JFQVRFJyAg
ICAgICAgOiAweDAwMDAwMTAwLCAgIyBTdWJmaWxlIHdhcyBjcmVhdGVkCiAgICAgICAgJ0lOX0RF
TEVURScgICAgICAgIDogMHgwMDAwMDIwMCwgICMgU3ViZmlsZSB3YXMgZGVsZXRlZAogICAgICAg
ICdJTl9ERUxFVEVfU0VMRicgICA6IDB4MDAwMDA0MDAsICAjIFNlbGYgKHdhdGNoZWQgaXRlbSBp
dHNlbGYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgd2FzIGRl
bGV0ZWQKICAgICAgICAnSU5fTU9WRV9TRUxGJyAgICAgOiAweDAwMDAwODAwLCAgIyBTZWxmICh3
YXRjaGVkIGl0ZW0gaXRzZWxmKSB3YXMgbW92ZWQKICAgICAgICB9LAogICAgICAgICAgICAgICAg
ICAgICAgICAnRVZFTlRfRkxBR1MnOiB7CiAgICAgICAgJ0lOX1VOTU9VTlQnICAgICAgIDogMHgw
MDAwMjAwMCwgICMgQmFja2luZyBmcyB3YXMgdW5tb3VudGVkCiAgICAgICAgJ0lOX1FfT1ZFUkZM
T1cnICAgIDogMHgwMDAwNDAwMCwgICMgRXZlbnQgcXVldWVkIG92ZXJmbG93ZWQKICAgICAgICAn
SU5fSUdOT1JFRCcgICAgICAgOiAweDAwMDA4MDAwLCAgIyBGaWxlIHdhcyBpZ25vcmVkCiAgICAg
ICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgJ1NQRUNJQUxfRkxBR1MnOiB7CiAgICAgICAg
J0lOX09OTFlESVInICAgICAgIDogMHgwMTAwMDAwMCwgICMgb25seSB3YXRjaCB0aGUgcGF0aCBp
ZiBpdCBpcyBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgZGly
ZWN0b3J5CiAgICAgICAgJ0lOX0RPTlRfRk9MTE9XJyAgIDogMHgwMjAwMDAwMCwgICMgZG9uJ3Qg
Zm9sbG93IGEgc3ltbGluawogICAgICAgICdJTl9FWENMX1VOTElOSycgICA6IDB4MDQwMDAwMDAs
ICAjIGV4Y2x1ZGUgZXZlbnRzIG9uIHVubGlua2VkIG9iamVjdHMKICAgICAgICAnSU5fTUFTS19B
REQnICAgICAgOiAweDIwMDAwMDAwLCAgIyBhZGQgdG8gdGhlIG1hc2sgb2YgYW4gYWxyZWFkeQog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGV4aXN0aW5nIHdhdGNo
CiAgICAgICAgJ0lOX0lTRElSJyAgICAgICAgIDogMHg0MDAwMDAwMCwgICMgZXZlbnQgb2NjdXJy
ZWQgYWdhaW5zdCBkaXIKICAgICAgICAnSU5fT05FU0hPVCcgICAgICAgOiAweDgwMDAwMDAwLCAg
IyBvbmx5IHNlbmQgZXZlbnQgb25jZQogICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAg
IH0KCiAgICBkZWYgbWFza25hbWUobWFzayk6CiAgICAgICAgIiIiCiAgICAgICAgUmV0dXJucyB0
aGUgZXZlbnQgbmFtZSBhc3NvY2lhdGVkIHRvIG1hc2suIElOX0lTRElSIGlzIGFwcGVuZGVkIHRv
CiAgICAgICAgdGhlIHJlc3VsdCB3aGVuIGFwcHJvcHJpYXRlLiBOb3RlOiBvbmx5IG9uZSBldmVu
dCBpcyByZXR1cm5lZCwgYmVjYXVzZQogICAgICAgIG9ubHkgb25lIGV2ZW50IGNhbiBiZSByYWlz
ZWQgYXQgYSBnaXZlbiB0aW1lLgoKICAgICAgICBAcGFyYW0gbWFzazogbWFzay4KICAgICAgICBA
dHlwZSBtYXNrOiBpbnQKICAgICAgICBAcmV0dXJuOiBldmVudCBuYW1lLgogICAgICAgIEBydHlw
ZTogc3RyCiAgICAgICAgIiIiCiAgICAgICAgbXMgPSBtYXNrCiAgICAgICAgbmFtZSA9ICclcycK
ICAgICAgICBpZiBtYXNrICYgSU5fSVNESVI6CiAgICAgICAgICAgIG1zID0gbWFzayAtIElOX0lT
RElSCiAgICAgICAgICAgIG5hbWUgPSAnJXN8SU5fSVNESVInCiAgICAgICAgcmV0dXJuIG5hbWUg
JSBFdmVudHNDb2Rlcy5BTExfVkFMVUVTW21zXQoKICAgIG1hc2tuYW1lID0gc3RhdGljbWV0aG9k
KG1hc2tuYW1lKQoKCiMgU28gbGV0J3Mgbm93IHR1cm4gdGhlIGNvbmZpZ3VyYXRpb24gaW50byBj
b2RlCkV2ZW50c0NvZGVzLkFMTF9GTEFHUyA9IHt9CkV2ZW50c0NvZGVzLkFMTF9WQUxVRVMgPSB7
fQpmb3IgZmxhZ2MsIHZhbGMgaW4gRXZlbnRzQ29kZXMuRkxBR19DT0xMRUNUSU9OUy5pdGVtcygp
OgogICAgIyBNYWtlIHRoZSBjb2xsZWN0aW9ucycgbWVtYmVycyBkaXJlY3RseSBhY2Nlc3NpYmxl
IHRocm91Z2ggdGhlCiAgICAjIGNsYXNzIGRpY3Rpb25hcnkKICAgIHNldGF0dHIoRXZlbnRzQ29k
ZXMsIGZsYWdjLCB2YWxjKQoKICAgICMgQ29sbGVjdCBhbGwgdGhlIGZsYWdzIHVuZGVyIGEgY29t
bW9uIHVtYnJlbGxhCiAgICBFdmVudHNDb2Rlcy5BTExfRkxBR1MudXBkYXRlKHZhbGMpCgogICAg
IyBNYWtlIHRoZSBpbmRpdmlkdWFsIG1hc2tzIGFjY2Vzc2libGUgYXMgJ2NvbnN0YW50cycgYXQg
Z2xvYmFscygpIHNjb3BlCiAgICAjIGFuZCBtYXNrbmFtZXMgYWNjZXNzaWJsZSBieSB2YWx1ZXMu
CiAgICBmb3IgbmFtZSwgdmFsIGluIHZhbGMuaXRlbXMoKToKICAgICAgICBnbG9iYWxzKClbbmFt
ZV0gPSB2YWwKICAgICAgICBFdmVudHNDb2Rlcy5BTExfVkFMVUVTW3ZhbF0gPSBuYW1lCgoKIyBh
bGwgJ25vcm1hbCcgZXZlbnRzCkFMTF9FVkVOVFMgPSByZWR1Y2UobGFtYmRhIHgsIHk6IHggfCB5
LCBFdmVudHNDb2Rlcy5PUF9GTEFHUy52YWx1ZXMoKSkKRXZlbnRzQ29kZXMuQUxMX0ZMQUdTWydB
TExfRVZFTlRTJ10gPSBBTExfRVZFTlRTCkV2ZW50c0NvZGVzLkFMTF9WQUxVRVNbQUxMX0VWRU5U
U10gPSAnQUxMX0VWRU5UUycKCgpjbGFzcyBfRXZlbnQ6CiAgICAiIiIKICAgIEV2ZW50IHN0cnVj
dHVyZSwgcmVwcmVzZW50IGV2ZW50cyByYWlzZWQgYnkgdGhlIHN5c3RlbS4gVGhpcwogICAgaXMg
dGhlIGJhc2UgY2xhc3MgYW5kIHNob3VsZCBiZSBzdWJjbGFzc2VkLgoKICAgICIiIgogICAgZGVm
IF9faW5pdF9fKHNlbGYsIGRpY3RfKToKICAgICAgICAiIiIKICAgICAgICBBdHRhY2ggYXR0cmli
dXRlcyAoY29udGFpbmVkIGluIGRpY3RfKSB0byBzZWxmLgoKICAgICAgICBAcGFyYW0gZGljdF86
IFNldCBvZiBhdHRyaWJ1dGVzLgogICAgICAgIEB0eXBlIGRpY3RfOiBkaWN0aW9uYXJ5CiAgICAg
ICAgIiIiCiAgICAgICAgZm9yIHRwbCBpbiBkaWN0Xy5pdGVtcygpOgogICAgICAgICAgICBzZXRh
dHRyKHNlbGYsICp0cGwpCgogICAgZGVmIF9fcmVwcl9fKHNlbGYpOgogICAgICAgICIiIgogICAg
ICAgIEByZXR1cm46IEdlbmVyaWMgZXZlbnQgc3RyaW5nIHJlcHJlc2VudGF0aW9uLgogICAgICAg
IEBydHlwZTogc3RyCiAgICAgICAgIiIiCiAgICAgICAgcyA9ICcnCiAgICAgICAgZm9yIGF0dHIs
IHZhbHVlIGluIHNvcnRlZChzZWxmLl9fZGljdF9fLml0ZW1zKCksIGtleT1sYW1iZGEgeDogeFsw
XSk6CiAgICAgICAgICAgIGlmIGF0dHIuc3RhcnRzd2l0aCgnXycpOgogICAgICAgICAgICAgICAg
Y29udGludWUKICAgICAgICAgICAgaWYgYXR0ciA9PSAnbWFzayc6CiAgICAgICAgICAgICAgICB2
YWx1ZSA9IGhleChnZXRhdHRyKHNlbGYsIGF0dHIpKQogICAgICAgICAgICBlbGlmIGlzaW5zdGFu
Y2UodmFsdWUsIGJhc2VzdHJpbmcpIGFuZCBub3QgdmFsdWU6CiAgICAgICAgICAgICAgICB2YWx1
ZSA9ICInJyIKICAgICAgICAgICAgcyArPSAnICVzJXMlcycgJSAob3V0cHV0X2Zvcm1hdC5maWVs
ZF9uYW1lKGF0dHIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRfZm9ybWF0
LnB1bmN0dWF0aW9uKCc9JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dF9m
b3JtYXQuZmllbGRfdmFsdWUodmFsdWUpKQoKICAgICAgICBzID0gJyVzJXMlcyAlcycgJSAob3V0
cHV0X2Zvcm1hdC5wdW5jdHVhdGlvbignPCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICBv
dXRwdXRfZm9ybWF0LmNsYXNzX25hbWUoc2VsZi5fX2NsYXNzX18uX19uYW1lX18pLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICBzLAogICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRf
Zm9ybWF0LnB1bmN0dWF0aW9uKCc+JykpCiAgICAgICAgcmV0dXJuIHMKCiAgICBkZWYgX19zdHJf
XyhzZWxmKToKICAgICAgICByZXR1cm4gcmVwcihzZWxmKQoKCmNsYXNzIF9SYXdFdmVudChfRXZl
bnQpOgogICAgIiIiCiAgICBSYXcgZXZlbnQsIGl0IGNvbnRhaW5zIG9ubHkgdGhlIGluZm9ybWF0
aW9ucyBwcm92aWRlZCBieSB0aGUgc3lzdGVtLgogICAgSXQgZG9lc24ndCBpbmZlciBhbnl0aGlu
Zy4KICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHdkLCBtYXNrLCBjb29raWUsIG5hbWUp
OgogICAgICAgICIiIgogICAgICAgIEBwYXJhbSB3ZDogV2F0Y2ggRGVzY3JpcHRvci4KICAgICAg
ICBAdHlwZSB3ZDogaW50CiAgICAgICAgQHBhcmFtIG1hc2s6IEJpdG1hc2sgb2YgZXZlbnRzLgog
ICAgICAgIEB0eXBlIG1hc2s6IGludAogICAgICAgIEBwYXJhbSBjb29raWU6IENvb2tpZS4KICAg
ICAgICBAdHlwZSBjb29raWU6IGludAogICAgICAgIEBwYXJhbSBuYW1lOiBCYXNlbmFtZSBvZiB0
aGUgZmlsZSBvciBkaXJlY3RvcnkgYWdhaW5zdCB3aGljaCB0aGUKICAgICAgICAgICAgICAgICAg
ICAgZXZlbnQgd2FzIHJhaXNlZCBpbiBjYXNlIHdoZXJlIHRoZSB3YXRjaGVkIGRpcmVjdG9yeQog
ICAgICAgICAgICAgICAgICAgICBpcyB0aGUgcGFyZW50IGRpcmVjdG9yeS4gTm9uZSBpZiB0aGUg
ZXZlbnQgd2FzIHJhaXNlZAogICAgICAgICAgICAgICAgICAgICBvbiB0aGUgd2F0Y2hlZCBpdGVt
IGl0c2VsZi4KICAgICAgICBAdHlwZSBuYW1lOiBzdHJpbmcgb3IgTm9uZQogICAgICAgICIiIgog
ICAgICAgICMgVXNlIHRoaXMgdmFyaWFibGUgdG8gY2FjaGUgdGhlIHJlc3VsdCBvZiBzdHIoc2Vs
ZiksIHRoaXMgb2JqZWN0CiAgICAgICAgIyBpcyBpbW11dGFibGUuCiAgICAgICAgc2VsZi5fc3Ry
ID0gTm9uZQogICAgICAgICMgbmFtZTogcmVtb3ZlIHRyYWlsaW5nICdcMCcKICAgICAgICBkID0g
eyd3ZCc6IHdkLAogICAgICAgICAgICAgJ21hc2snOiBtYXNrLAogICAgICAgICAgICAgJ2Nvb2tp
ZSc6IGNvb2tpZSwKICAgICAgICAgICAgICduYW1lJzogbmFtZS5yc3RyaXAoJ1wwJyl9CiAgICAg
ICAgX0V2ZW50Ll9faW5pdF9fKHNlbGYsIGQpCiAgICAgICAgbG9nLmRlYnVnKHN0cihzZWxmKSkK
CiAgICBkZWYgX19zdHJfXyhzZWxmKToKICAgICAgICBpZiBzZWxmLl9zdHIgaXMgTm9uZToKICAg
ICAgICAgICAgc2VsZi5fc3RyID0gX0V2ZW50Ll9fc3RyX18oc2VsZikKICAgICAgICByZXR1cm4g
c2VsZi5fc3RyCgoKY2xhc3MgRXZlbnQoX0V2ZW50KToKICAgICIiIgogICAgVGhpcyBjbGFzcyBj
b250YWlucyBhbGwgdGhlIHVzZWZ1bCBpbmZvcm1hdGlvbnMgYWJvdXQgdGhlIG9ic2VydmVkCiAg
ICBldmVudC4gSG93ZXZlciwgdGhlIHByZXNlbmNlIG9mIGVhY2ggZmllbGQgaXMgbm90IGd1YXJh
bnRlZWQgYW5kCiAgICBkZXBlbmRzIG9uIHRoZSB0eXBlIG9mIGV2ZW50LiBJbiBlZmZlY3QsIHNv
bWUgZmllbGRzIGFyZSBpcnJlbGV2YW50CiAgICBmb3Igc29tZSBraW5kIG9mIGV2ZW50IChmb3Ig
ZXhhbXBsZSAnY29va2llJyBpcyBtZWFuaW5nbGVzcyBmb3IKICAgIElOX0NSRUFURSB3aGVyZWFz
IGl0IGlzIG1hbmRhdG9yeSBmb3IgSU5fTU9WRV9UTykuCgogICAgVGhlIHBvc3NpYmxlIGZpZWxk
cyBhcmU6CiAgICAgIC0gd2QgKGludCk6IFdhdGNoIERlc2NyaXB0b3IuCiAgICAgIC0gbWFzayAo
aW50KTogTWFzay4KICAgICAgLSBtYXNrbmFtZSAoc3RyKTogUmVhZGFibGUgZXZlbnQgbmFtZS4K
ICAgICAgLSBwYXRoIChzdHIpOiBwYXRoIG9mIHRoZSBmaWxlIG9yIGRpcmVjdG9yeSBiZWluZyB3
YXRjaGVkLgogICAgICAtIG5hbWUgKHN0cik6IEJhc2VuYW1lIG9mIHRoZSBmaWxlIG9yIGRpcmVj
dG9yeSBhZ2FpbnN0IHdoaWNoIHRoZQogICAgICAgICAgICAgIGV2ZW50IHdhcyByYWlzZWQgaW4g
Y2FzZSB3aGVyZSB0aGUgd2F0Y2hlZCBkaXJlY3RvcnkKICAgICAgICAgICAgICBpcyB0aGUgcGFy
ZW50IGRpcmVjdG9yeS4gTm9uZSBpZiB0aGUgZXZlbnQgd2FzIHJhaXNlZAogICAgICAgICAgICAg
IG9uIHRoZSB3YXRjaGVkIGl0ZW0gaXRzZWxmLiBUaGlzIGZpZWxkIGlzIGFsd2F5cyBwcm92aWRl
ZAogICAgICAgICAgICAgIGV2ZW4gaWYgdGhlIHN0cmluZyBpcyAnJy4KICAgICAgLSBwYXRobmFt
ZSAoc3RyKTogQ29uY2F0ZW5hdGlvbiBvZiAncGF0aCcgYW5kICduYW1lJy4KICAgICAgLSBzcmNf
cGF0aG5hbWUgKHN0cik6IE9ubHkgcHJlc2VudCBmb3IgSU5fTU9WRURfVE8gZXZlbnRzIGFuZCBv
bmx5IGluCiAgICAgICAgICAgICAgdGhlIGNhc2Ugd2hlcmUgSU5fTU9WRURfRlJPTSBldmVudHMg
YXJlIHdhdGNoZWQgdG9vLiBIb2xkcyB0aGUKICAgICAgICAgICAgICBzb3VyY2UgcGF0aG5hbWUg
ZnJvbSB3aGVyZSBwYXRobmFtZSB3YXMgbW92ZWQgZnJvbS4KICAgICAgLSBjb29raWUgKGludCk6
IENvb2tpZS4KICAgICAgLSBkaXIgKGJvb2wpOiBUcnVlIGlmIHRoZSBldmVudCB3YXMgcmFpc2Vk
IGFnYWluc3QgYSBkaXJlY3RvcnkuCgogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgcmF3
KToKICAgICAgICAiIiIKICAgICAgICBDb25jcmV0ZWx5LCB0aGlzIGlzIHRoZSByYXcgZXZlbnQg
cGx1cyBpbmZlcnJlZCBpbmZvcy4KICAgICAgICAiIiIKICAgICAgICBfRXZlbnQuX19pbml0X18o
c2VsZiwgcmF3KQogICAgICAgIHNlbGYubWFza25hbWUgPSBFdmVudHNDb2Rlcy5tYXNrbmFtZShz
ZWxmLm1hc2spCiAgICAgICAgaWYgQ09NUEFUSUJJTElUWV9NT0RFOgogICAgICAgICAgICBzZWxm
LmV2ZW50X25hbWUgPSBzZWxmLm1hc2tuYW1lCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBz
ZWxmLm5hbWU6CiAgICAgICAgICAgICAgICBzZWxmLnBhdGhuYW1lID0gb3MucGF0aC5hYnNwYXRo
KG9zLnBhdGguam9pbihzZWxmLnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm5hbWUpKQogICAgICAgICAgICBlbHNl
OgogICAgICAgICAgICAgICAgc2VsZi5wYXRobmFtZSA9IG9zLnBhdGguYWJzcGF0aChzZWxmLnBh
dGgpCiAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yLCBlcnI6CiAgICAgICAgICAgICMgVXN1
YWxseSBpdCBpcyBub3QgYW4gZXJyb3Igc29tZSBldmVudHMgYXJlIHBlcmZlY3RseSB2YWxpZHMK
ICAgICAgICAgICAgIyBkZXNwaXRlIHRoZSBsYWNrIG9mIHRoZXNlIGF0dHJpYnV0ZXMuCiAgICAg
ICAgICAgIGxvZy5kZWJ1ZyhlcnIpCgoKY2xhc3MgUHJvY2Vzc0V2ZW50RXJyb3IoUHlpbm90aWZ5
RXJyb3IpOgogICAgIiIiCiAgICBQcm9jZXNzRXZlbnRFcnJvciBFeGNlcHRpb24uIFJhaXNlZCBv
biBQcm9jZXNzRXZlbnQgZXJyb3IuCiAgICAiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBlcnIp
OgogICAgICAgICIiIgogICAgICAgIEBwYXJhbSBlcnI6IEV4Y2VwdGlvbiBlcnJvciBkZXNjcmlw
dGlvbi4KICAgICAgICBAdHlwZSBlcnI6IHN0cmluZwogICAgICAgICIiIgogICAgICAgIFB5aW5v
dGlmeUVycm9yLl9faW5pdF9fKHNlbGYsIGVycikKCgpjbGFzcyBfUHJvY2Vzc0V2ZW50OgogICAg
IiIiCiAgICBBYnN0cmFjdCBwcm9jZXNzaW5nIGV2ZW50IGNsYXNzLgogICAgIiIiCiAgICBkZWYg
X19jYWxsX18oc2VsZiwgZXZlbnQpOgogICAgICAgICIiIgogICAgICAgIFRvIGJlaGF2ZSBsaWtl
IGEgZnVuY3RvciB0aGUgb2JqZWN0IG11c3QgYmUgY2FsbGFibGUuCiAgICAgICAgVGhpcyBtZXRo
b2QgaXMgYSBkaXNwYXRjaCBtZXRob2QuIEl0cyBsb29rdXAgb3JkZXIgaXM6CiAgICAgICAgICAx
LiBwcm9jZXNzX01BU0tOQU1FIG1ldGhvZAogICAgICAgICAgMi4gcHJvY2Vzc19GQU1JTFlfTkFN
RSBtZXRob2QKICAgICAgICAgIDMuIG90aGVyd2lzZSBjYWxscyBwcm9jZXNzX2RlZmF1bHQKCiAg
ICAgICAgQHBhcmFtIGV2ZW50OiBFdmVudCB0byBiZSBwcm9jZXNzZWQuCiAgICAgICAgQHR5cGUg
ZXZlbnQ6IEV2ZW50IG9iamVjdAogICAgICAgIEByZXR1cm46IEJ5IGNvbnZlbnRpb24gd2hlbiB1
c2VkIGZyb20gdGhlIFByb2Nlc3NFdmVudCBjbGFzczoKICAgICAgICAgICAgICAgICAtIFJldHVy
bmluZyBGYWxzZSBvciBOb25lIChkZWZhdWx0IHZhbHVlKSBtZWFucyBrZWVwIG9uCiAgICAgICAg
ICAgICAgICAgZXhlY3V0aW5nIG5leHQgY2hhaW5lZCBmdW5jdG9ycyAoc2VlIGNoYWluLnB5IGV4
YW1wbGUpLgogICAgICAgICAgICAgICAgIC0gUmV0dXJuaW5nIFRydWUgaW5zdGVhZCBtZWFucyBk
byBub3QgZXhlY3V0ZSBuZXh0CiAgICAgICAgICAgICAgICAgICBwcm9jZXNzaW5nIGZ1bmN0aW9u
cy4KICAgICAgICBAcnR5cGU6IGJvb2wKICAgICAgICBAcmFpc2UgUHJvY2Vzc0V2ZW50RXJyb3I6
IEV2ZW50IG9iamVjdCB1bmRpc3BhdGNoYWJsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHVua25vd24gZXZlbnQuCiAgICAgICAgIiIiCiAgICAgICAgc3RyaXBwZWRfbWFzayA9
IGV2ZW50Lm1hc2sgLSAoZXZlbnQubWFzayAmIElOX0lTRElSKQogICAgICAgIG1hc2tuYW1lID0g
RXZlbnRzQ29kZXMuQUxMX1ZBTFVFUy5nZXQoc3RyaXBwZWRfbWFzaykKICAgICAgICBpZiBtYXNr
bmFtZSBpcyBOb25lOgogICAgICAgICAgICByYWlzZSBQcm9jZXNzRXZlbnRFcnJvcigiVW5rbm93
biBtYXNrIDB4JTA4eCIgJSBzdHJpcHBlZF9tYXNrKQoKICAgICAgICAjIDEtIGxvb2sgZm9yIHBy
b2Nlc3NfTUFTS05BTUUKICAgICAgICBtZXRoID0gZ2V0YXR0cihzZWxmLCAncHJvY2Vzc18nICsg
bWFza25hbWUsIE5vbmUpCiAgICAgICAgaWYgbWV0aCBpcyBub3QgTm9uZToKICAgICAgICAgICAg
cmV0dXJuIG1ldGgoZXZlbnQpCiAgICAgICAgIyAyLSBsb29rIGZvciBwcm9jZXNzX0ZBTUlMWV9O
QU1FCiAgICAgICAgbWV0aCA9IGdldGF0dHIoc2VsZiwgJ3Byb2Nlc3NfSU5fJyArIG1hc2tuYW1l
LnNwbGl0KCdfJylbMV0sIE5vbmUpCiAgICAgICAgaWYgbWV0aCBpcyBub3QgTm9uZToKICAgICAg
ICAgICAgcmV0dXJuIG1ldGgoZXZlbnQpCiAgICAgICAgIyAzLSBkZWZhdWx0IGNhbGwgbWV0aG9k
IHByb2Nlc3NfZGVmYXVsdAogICAgICAgIHJldHVybiBzZWxmLnByb2Nlc3NfZGVmYXVsdChldmVu
dCkKCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgcmV0dXJuICc8JXM+JyAlIHNlbGYu
X19jbGFzc19fLl9fbmFtZV9fCgoKY2xhc3MgX1N5c1Byb2Nlc3NFdmVudChfUHJvY2Vzc0V2ZW50
KToKICAgICIiIgogICAgVGhlcmUgaXMgdGhyZWUga2luZCBvZiBwcm9jZXNzaW5nIGFjY29yZGlu
ZyB0byBlYWNoIGV2ZW50OgoKICAgICAgMS4gc3BlY2lhbCBoYW5kbGluZyAoZGVsZXRpb24gZnJv
bSBpbnRlcm5hbCBjb250YWluZXIsIGJ1ZywgLi4uKS4KICAgICAgMi4gZGVmYXVsdCB0cmVhdG1l
bnQ6IHdoaWNoIGlzIGFwcGxpZWQgdG8gdGhlIG1ham9yaXR5IG9mIGV2ZW50cy4KICAgICAgMy4g
SU5fSVNESVIgaXMgbmV2ZXIgc2VudCBhbG9uZSwgaGUgaXMgcGlnZ3liYWNrZWQgd2l0aCBhIHN0
YW5kYXJkCiAgICAgICAgIGV2ZW50LCBoZSBpcyBub3QgcHJvY2Vzc2VkIGFzIHRoZSBvdGhlcnMg
ZXZlbnRzLCBpbnN0ZWFkLCBpdHMKICAgICAgICAgdmFsdWUgaXMgY2FwdHVyZWQgYW5kIGFwcHJv
cHJpYXRlbHkgYWdncmVnYXRlZCB0byBkc3QgZXZlbnQuCiAgICAiIiIKICAgIGRlZiBfX2luaXRf
XyhzZWxmLCB3bSwgbm90aWZpZXIpOgogICAgICAgICIiIgoKICAgICAgICBAcGFyYW0gd206IFdh
dGNoIE1hbmFnZXIuCiAgICAgICAgQHR5cGUgd206IFdhdGNoTWFuYWdlciBpbnN0YW5jZQogICAg
ICAgIEBwYXJhbSBub3RpZmllcjogTm90aWZpZXIuCiAgICAgICAgQHR5cGUgbm90aWZpZXI6IE5v
dGlmaWVyIGluc3RhbmNlCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5fd2F0Y2hfbWFuYWdlciA9
IHdtICAjIHdhdGNoIG1hbmFnZXIKICAgICAgICBzZWxmLl9ub3RpZmllciA9IG5vdGlmaWVyICAj
IG5vdGlmaWVyCiAgICAgICAgc2VsZi5fbXZfY29va2llID0ge30gICMge2Nvb2tpZShpbnQpOiAo
c3JjX3BhdGgoc3RyKSwgZGF0ZSksIC4uLn0KICAgICAgICBzZWxmLl9tdiA9IHt9ICAjIHtzcmNf
cGF0aChzdHIpOiAoZHN0X3BhdGgoc3RyKSwgZGF0ZSksIC4uLn0KCiAgICBkZWYgY2xlYW51cChz
ZWxmKToKICAgICAgICAiIiIKICAgICAgICBDbGVhbnVwIChkZWxldGUpIG9sZCAoPjFtbikgcmVj
b3JkcyBjb250YWluZWQgaW4gc2VsZi5fbXZfY29va2llCiAgICAgICAgYW5kIHNlbGYuX212Lgog
ICAgICAgICIiIgogICAgICAgIGRhdGVfY3VyXyA9IGRhdGV0aW1lLm5vdygpCiAgICAgICAgZm9y
IHNlcSBpbiBbc2VsZi5fbXZfY29va2llLCBzZWxmLl9tdl06CiAgICAgICAgICAgIGZvciBrIGlu
IHNlcS5rZXlzKCk6CiAgICAgICAgICAgICAgICBpZiAoZGF0ZV9jdXJfIC0gc2VxW2tdWzFdKSA+
IHRpbWVkZWx0YShtaW51dGVzPTEpOgogICAgICAgICAgICAgICAgICAgIGxvZy5kZWJ1ZygnQ2xl
YW51cDogZGVsZXRpbmcgZW50cnkgJXMnLCBzZXFba11bMF0pCiAgICAgICAgICAgICAgICAgICAg
ZGVsIHNlcVtrXQoKICAgIGRlZiBwcm9jZXNzX0lOX0NSRUFURShzZWxmLCByYXdfZXZlbnQpOgog
ICAgICAgICIiIgogICAgICAgIElmIHRoZSBldmVudCBhZmZlY3RzIGEgZGlyZWN0b3J5IGFuZCB0
aGUgYXV0b19hZGQgZmxhZyBvZiB0aGUKICAgICAgICB0YXJnZXR0ZWQgd2F0Y2ggaXMgc2V0IHRv
IFRydWUsIGEgbmV3IHdhdGNoIGlzIGFkZGVkIG9uIHRoaXMKICAgICAgICBuZXcgZGlyZWN0b3J5
LCB3aXRoIHRoZSBzYW1lIGF0dHJpYnV0ZSB2YWx1ZXMgdGhhbiB0aG9zZSBvZgogICAgICAgIHRo
aXMgd2F0Y2guCiAgICAgICAgIiIiCiAgICAgICAgaWYgcmF3X2V2ZW50Lm1hc2sgJiBJTl9JU0RJ
UjoKICAgICAgICAgICAgd2F0Y2hfID0gc2VsZi5fd2F0Y2hfbWFuYWdlci5nZXRfd2F0Y2gocmF3
X2V2ZW50LndkKQogICAgICAgICAgICBjcmVhdGVkX2RpciA9IG9zLnBhdGguam9pbih3YXRjaF8u
cGF0aCwgcmF3X2V2ZW50Lm5hbWUpCiAgICAgICAgICAgIGlmIHdhdGNoXy5hdXRvX2FkZCBhbmQg
bm90IHdhdGNoXy5leGNsdWRlX2ZpbHRlcihjcmVhdGVkX2Rpcik6CiAgICAgICAgICAgICAgICBh
ZGR3ID0gc2VsZi5fd2F0Y2hfbWFuYWdlci5hZGRfd2F0Y2gKICAgICAgICAgICAgICAgICMgVGhl
IG5ld2x5IG1vbml0b3JlZCBkaXJlY3RvcnkgaW5oZXJpdHMgYXR0cmlidXRlcyBmcm9tIGl0cwog
ICAgICAgICAgICAgICAgIyBwYXJlbnQgZGlyZWN0b3J5LgogICAgICAgICAgICAgICAgYWRkd19y
ZXQgPSBhZGR3KGNyZWF0ZWRfZGlyLCB3YXRjaF8ubWFzaywKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBwcm9jX2Z1bj13YXRjaF8ucHJvY19mdW4sCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgcmVjPUZhbHNlLCBhdXRvX2FkZD13YXRjaF8uYXV0b19hZGQsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZXhjbHVkZV9maWx0ZXI9d2F0Y2hfLmV4Y2x1ZGVfZmls
dGVyKQoKICAgICAgICAgICAgICAgICMgVHJpY2sgdG8gaGFuZGxlIG1rZGlyIC1wIC9kMS9kMi90
MyB3aGVyZSBkMSBpcyB3YXRjaGVkIGFuZAogICAgICAgICAgICAgICAgIyBkMiBhbmQgdDMgKGRp
cmVjdG9yeSBvciBmaWxlKSBhcmUgY3JlYXRlZC4KICAgICAgICAgICAgICAgICMgU2luY2UgdGhl
IGRpcmVjdG9yeSBkMiBpcyBuZXcsIHRoZW4gZXZlcnl0aGluZyBpbnNpZGUgaXQgbXVzdAogICAg
ICAgICAgICAgICAgIyBhbHNvIGJlIG5ldy4KICAgICAgICAgICAgICAgIGNyZWF0ZWRfZGlyX3dk
ID0gYWRkd19yZXQuZ2V0KGNyZWF0ZWRfZGlyKQogICAgICAgICAgICAgICAgaWYgKChjcmVhdGVk
X2Rpcl93ZCBpcyBub3QgTm9uZSkgYW5kIChjcmVhdGVkX2Rpcl93ZCA+IDApIGFuZAogICAgICAg
ICAgICAgICAgICAgIG9zLnBhdGguaXNkaXIoY3JlYXRlZF9kaXIpKToKICAgICAgICAgICAgICAg
ICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBuYW1lIGluIG9zLmxpc3RkaXIo
Y3JlYXRlZF9kaXIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5uZXIgPSBvcy5wYXRo
LmpvaW4oY3JlYXRlZF9kaXIsIG5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBz
ZWxmLl93YXRjaF9tYW5hZ2VyLmdldF93ZChpbm5lcikgaXMgbm90IE5vbmU6CiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICMgR2VuZXJhdGUgKHNpbXVsYXRlKSBjcmVhdGlvbiBldmVudHMgZm9yIHN1Yi0KICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICMgZGlyZWN0b3JpZXMgYW5kIGZpbGVzLgogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2ZpbGUoaW5uZXIpOgogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICMgc3ltbGlua3MgYXJlIGhhbmRsZWQgYXMgZmlsZXMuCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3MgPSBJTl9DUkVBVEUKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGVsaWYgb3MucGF0aC5pc2Rpcihpbm5lcik6CiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZmxhZ3MgPSBJTl9DUkVBVEUgfCBJTl9JU0RJUgogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRo
aXMgcGF0aCBzaG91bGQgbm90IGJlIHRha2VuLgogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYXdldmVudCA9IF9SYXdF
dmVudChjcmVhdGVkX2Rpcl93ZCwgZmxhZ3MsIDAsIG5hbWUpCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBzZWxmLl9ub3RpZmllci5hcHBlbmRfZXZlbnQocmF3ZXZlbnQpCiAgICAgICAgICAg
ICAgICAgICAgZXhjZXB0IE9TRXJyb3IsIGVycjoKICAgICAgICAgICAgICAgICAgICAgICAgbXNn
ID0gInByb2Nlc3NfSU5fQ1JFQVRFLCBpbnZhbGlkIGRpcmVjdG9yeSAlczogJXMiCiAgICAgICAg
ICAgICAgICAgICAgICAgIGxvZy5kZWJ1Zyhtc2cgJSAoY3JlYXRlZF9kaXIsIHN0cihlcnIpKSkK
ICAgICAgICByZXR1cm4gc2VsZi5wcm9jZXNzX2RlZmF1bHQocmF3X2V2ZW50KQoKICAgIGRlZiBw
cm9jZXNzX0lOX01PVkVEX0ZST00oc2VsZiwgcmF3X2V2ZW50KToKICAgICAgICAiIiIKICAgICAg
ICBNYXAgdGhlIGNvb2tpZSB3aXRoIHRoZSBzb3VyY2UgcGF0aCAoKyBkYXRlIGZvciBjbGVhbmlu
ZykuCiAgICAgICAgIiIiCiAgICAgICAgd2F0Y2hfID0gc2VsZi5fd2F0Y2hfbWFuYWdlci5nZXRf
d2F0Y2gocmF3X2V2ZW50LndkKQogICAgICAgIHBhdGhfID0gd2F0Y2hfLnBhdGgKICAgICAgICBz
cmNfcGF0aCA9IG9zLnBhdGgubm9ybXBhdGgob3MucGF0aC5qb2luKHBhdGhfLCByYXdfZXZlbnQu
bmFtZSkpCiAgICAgICAgc2VsZi5fbXZfY29va2llW3Jhd19ldmVudC5jb29raWVdID0gKHNyY19w
YXRoLCBkYXRldGltZS5ub3coKSkKICAgICAgICByZXR1cm4gc2VsZi5wcm9jZXNzX2RlZmF1bHQo
cmF3X2V2ZW50LCB7J2Nvb2tpZSc6IHJhd19ldmVudC5jb29raWV9KQoKICAgIGRlZiBwcm9jZXNz
X0lOX01PVkVEX1RPKHNlbGYsIHJhd19ldmVudCk6CiAgICAgICAgIiIiCiAgICAgICAgTWFwIHRo
ZSBzb3VyY2UgcGF0aCB3aXRoIHRoZSBkZXN0aW5hdGlvbiBwYXRoICgrIGRhdGUgZm9yCiAgICAg
ICAgY2xlYW5pbmcpLgogICAgICAgICIiIgogICAgICAgIHdhdGNoXyA9IHNlbGYuX3dhdGNoX21h
bmFnZXIuZ2V0X3dhdGNoKHJhd19ldmVudC53ZCkKICAgICAgICBwYXRoXyA9IHdhdGNoXy5wYXRo
CiAgICAgICAgZHN0X3BhdGggPSBvcy5wYXRoLm5vcm1wYXRoKG9zLnBhdGguam9pbihwYXRoXywg
cmF3X2V2ZW50Lm5hbWUpKQogICAgICAgIG12XyA9IHNlbGYuX212X2Nvb2tpZS5nZXQocmF3X2V2
ZW50LmNvb2tpZSkKICAgICAgICB0b19hcHBlbmQgPSB7J2Nvb2tpZSc6IHJhd19ldmVudC5jb29r
aWV9CiAgICAgICAgaWYgbXZfIGlzIG5vdCBOb25lOgogICAgICAgICAgICBzZWxmLl9tdlttdl9b
MF1dID0gKGRzdF9wYXRoLCBkYXRldGltZS5ub3coKSkKICAgICAgICAgICAgIyBMZXQncyBhc3N1
bWUgdGhhdCBJTl9NT1ZFRF9GUk9NIGV2ZW50IGlzIGFsd2F5cyBxdWV1ZWQgYmVmb3JlCiAgICAg
ICAgICAgICMgdGhhdCBpdHMgYXNzb2NpYXRlZCAodGhleSBzaGFyZSBhIGNvbW1vbiBjb29raWUp
IElOX01PVkVEX1RPCiAgICAgICAgICAgICMgZXZlbnQgaXMgcXVldWVkIGl0c2VsZi4gSXQgaXMg
dGhlbiBwb3NzaWJsZSBpbiB0aGF0IHNjZW5hcmlvCiAgICAgICAgICAgICMgdG8gcHJvdmlkZSBh
cyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIHRvIHRoZSBJTl9NT1ZFRF9UTyBldmVudAogICAgICAg
ICAgICAjIHRoZSBvcmlnaW5hbCBwYXRobmFtZSBvZiB0aGUgbW92ZWQgZmlsZS9kaXJlY3Rvcnku
CiAgICAgICAgICAgIHRvX2FwcGVuZFsnc3JjX3BhdGhuYW1lJ10gPSBtdl9bMF0KICAgICAgICBl
bGlmIChyYXdfZXZlbnQubWFzayAmIElOX0lTRElSIGFuZCB3YXRjaF8uYXV0b19hZGQgYW5kCiAg
ICAgICAgICAgICAgbm90IHdhdGNoXy5leGNsdWRlX2ZpbHRlcihkc3RfcGF0aCkpOgogICAgICAg
ICAgICAjIFdlIGdvdCBhIGRpcmV0b3J5IHRoYXQncyAibW92ZWQgaW4iIGZyb20gYW4gdW5rbm93
biBzb3VyY2UgYW5kCiAgICAgICAgICAgICMgYXV0b19hZGQgaXMgZW5hYmxlZC4gTWFudWFsbHkg
YWRkIHdhdGNoZXMgdG8gdGhlIGlubmVyIHN1YnRyZWVzLgogICAgICAgICAgICAjIFRoZSBuZXds
eSBtb25pdG9yZWQgZGlyZWN0b3J5IGluaGVyaXRzIGF0dHJpYnV0ZXMgZnJvbSBpdHMKICAgICAg
ICAgICAgIyBwYXJlbnQgZGlyZWN0b3J5LgogICAgICAgICAgICBzZWxmLl93YXRjaF9tYW5hZ2Vy
LmFkZF93YXRjaChkc3RfcGF0aCwgd2F0Y2hfLm1hc2ssCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHByb2NfZnVuPXdhdGNoXy5wcm9jX2Z1biwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjPVRydWUsIGF1dG9fYWRkPVRydWUsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGVfZmlsdGVyPXdh
dGNoXy5leGNsdWRlX2ZpbHRlcikKICAgICAgICByZXR1cm4gc2VsZi5wcm9jZXNzX2RlZmF1bHQo
cmF3X2V2ZW50LCB0b19hcHBlbmQpCgogICAgZGVmIHByb2Nlc3NfSU5fTU9WRV9TRUxGKHNlbGYs
IHJhd19ldmVudCk6CiAgICAgICAgIiIiCiAgICAgICAgU1RBVFVTOiB0aGUgZm9sbG93aW5nIGJ1
ZyBoYXMgYmVlbiBmaXhlZCBpbiByZWNlbnQga2VybmVscyAoRklYTUU6CiAgICAgICAgd2hpY2gg
dmVyc2lvbiA/KS4gTm93IGl0IHJhaXNlcyBJTl9ERUxFVEVfU0VMRiBpbnN0ZWFkLgoKICAgICAg
ICBPbGQga2VybmVscyB3ZXJlIGJ1Z2dlZCwgdGhpcyBldmVudCByYWlzZWQgd2hlbiB0aGUgd2F0
Y2hlZCBpdGVtCiAgICAgICAgd2VyZSBtb3ZlZCwgc28gd2UgaGFkIHRvIHVwZGF0ZSBpdHMgcGF0
aCwgYnV0IHVuZGVyIHNvbWUgY2lyY3Vtc3RhbmNlcwogICAgICAgIGl0IHdhcyBpbXBvc3NpYmxl
OiBpZiBpdHMgcGFyZW50IGRpcmVjdG9yeSBhbmQgaXRzIGRlc3RpbmF0aW9uCiAgICAgICAgZGly
ZWN0b3J5IHdhc24ndCB3YXRjaGVkLiBUaGUga2VybmVsIChzZWUgaW5jbHVkZS9saW51eC9mc25v
dGlmeS5oKQogICAgICAgIGRvZXNuJ3QgYnJpbmcgdXMgZW5vdWdoIGluZm9ybWF0aW9ucyBsaWtl
IHRoZSBkZXN0aW5hdGlvbiBwYXRoIG9mCiAgICAgICAgbW92ZWQgaXRlbXMuCiAgICAgICAgIiIi
CiAgICAgICAgd2F0Y2hfID0gc2VsZi5fd2F0Y2hfbWFuYWdlci5nZXRfd2F0Y2gocmF3X2V2ZW50
LndkKQogICAgICAgIHNyY19wYXRoID0gd2F0Y2hfLnBhdGgKICAgICAgICBtdl8gPSBzZWxmLl9t
di5nZXQoc3JjX3BhdGgpCiAgICAgICAgaWYgbXZfOgogICAgICAgICAgICBkZXN0X3BhdGggPSBt
dl9bMF0KICAgICAgICAgICAgd2F0Y2hfLnBhdGggPSBkZXN0X3BhdGgKICAgICAgICAgICAgIyBh
ZGQgdGhlIHNlcGFyYXRvciB0byB0aGUgc291cmNlIHBhdGggdG8gYXZvaWQgb3ZlcmxhcHBpbmcK
ICAgICAgICAgICAgIyBwYXRoIGlzc3VlIHdoZW4gdGVzdGluZyB3aXRoIHN0YXJ0c3dpdGgoKQog
ICAgICAgICAgICBzcmNfcGF0aCArPSBvcy5wYXRoLnNlcAogICAgICAgICAgICBzcmNfcGF0aF9s
ZW4gPSBsZW4oc3JjX3BhdGgpCiAgICAgICAgICAgICMgVGhlIG5leHQgbG9vcCByZW5hbWVzIGFs
bCB3YXRjaGVzIHdpdGggc3JjX3BhdGggYXMgYmFzZSBwYXRoLgogICAgICAgICAgICAjIEl0IHNl
ZW1zIHRoYXQgSU5fTU9WRV9TRUxGIGRvZXMgbm90IHByb3ZpZGUgSU5fSVNESVIgaW5mb3JtYXRp
b24KICAgICAgICAgICAgIyB0aGVyZWZvcmUgdGhlIG5leHQgbG9vcCBpcyBpdGVyYXRlZCBldmVu
IGlmIHJhd19ldmVudCBpcyBhIGZpbGUuCiAgICAgICAgICAgIGZvciB3IGluIHNlbGYuX3dhdGNo
X21hbmFnZXIud2F0Y2hlcy52YWx1ZXMoKToKICAgICAgICAgICAgICAgIGlmIHcucGF0aC5zdGFy
dHN3aXRoKHNyY19wYXRoKToKICAgICAgICAgICAgICAgICAgICAjIE5vdGUgdGhhdCBkZXN0X3Bh
dGggaXMgYSBub3JtYWxpemVkIHBhdGguCiAgICAgICAgICAgICAgICAgICAgdy5wYXRoID0gb3Mu
cGF0aC5qb2luKGRlc3RfcGF0aCwgdy5wYXRoW3NyY19wYXRoX2xlbjpdKQogICAgICAgIGVsc2U6
CiAgICAgICAgICAgIGxvZy5lcnJvcigiVGhlIHBhdGhuYW1lICclcycgb2YgdGhpcyB3YXRjaCAl
cyBoYXMgcHJvYmFibHkgY2hhbmdlZCAiCiAgICAgICAgICAgICAgICAgICAgICAiYW5kIGNvdWxk
bid0IGJlIHVwZGF0ZWQsIHNvIGl0IGNhbm5vdCBiZSB0cnVzdGVkICIKICAgICAgICAgICAgICAg
ICAgICAgICJhbnltb3JlLiBUbyBmaXggdGhpcyBlcnJvciBtb3ZlIGRpcmVjdG9yaWVzL2ZpbGVz
IG9ubHkgIgogICAgICAgICAgICAgICAgICAgICAgImJldHdlZW4gd2F0Y2hlZCBwYXJlbnRzIGRp
cmVjdG9yaWVzLCBpbiB0aGlzIGNhc2UgZS5nLiAiCiAgICAgICAgICAgICAgICAgICAgICAicHV0
IGEgd2F0Y2ggb24gJyVzJy4iLAogICAgICAgICAgICAgICAgICAgICAgd2F0Y2hfLnBhdGgsIHdh
dGNoXywKICAgICAgICAgICAgICAgICAgICAgIG9zLnBhdGgubm9ybXBhdGgob3MucGF0aC5qb2lu
KHdhdGNoXy5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgb3MucGF0aC5wYXJkaXIpKSkKICAgICAgICAgICAgaWYgbm90IHdhdGNoXy5wYXRo
LmVuZHN3aXRoKCctdW5rbm93bi1wYXRoJyk6CiAgICAgICAgICAgICAgICB3YXRjaF8ucGF0aCAr
PSAnLXVua25vd24tcGF0aCcKICAgICAgICByZXR1cm4gc2VsZi5wcm9jZXNzX2RlZmF1bHQocmF3
X2V2ZW50KQoKICAgIGRlZiBwcm9jZXNzX0lOX1FfT1ZFUkZMT1coc2VsZiwgcmF3X2V2ZW50KToK
ICAgICAgICAiIiIKICAgICAgICBPbmx5IHNpZ25hbCBhbiBvdmVyZmxvdywgbW9zdCBvZiB0aGUg
Y29tbW9uIGZsYWdzIGFyZSBpcnJlbGV2YW50CiAgICAgICAgZm9yIHRoaXMgZXZlbnQgKHBhdGgs
IHdkLCBuYW1lKS4KICAgICAgICAiIiIKICAgICAgICByZXR1cm4gRXZlbnQoeydtYXNrJzogcmF3
X2V2ZW50Lm1hc2t9KQoKICAgIGRlZiBwcm9jZXNzX0lOX0lHTk9SRUQoc2VsZiwgcmF3X2V2ZW50
KToKICAgICAgICAiIiIKICAgICAgICBUaGUgd2F0Y2ggZGVzY3JpcHRvciByYWlzZWQgYnkgdGhp
cyBldmVudCBpcyBub3cgaWdub3JlZCAoZm9yZXZlciksCiAgICAgICAgaXQgY2FuIGJlIHNhZmVs
eSBkZWxldGVkIGZyb20gdGhlIHdhdGNoIG1hbmFnZXIgZGljdGlvbmFyeS4KICAgICAgICBBZnRl
ciB0aGlzIGV2ZW50IHdlIGNhbiBiZSBzdXJlIHRoYXQgbmVpdGhlciB0aGUgZXZlbnQgcXVldWUg
bm9yCiAgICAgICAgdGhlIHN5c3RlbSB3aWxsIHJhaXNlIGFuIGV2ZW50IGFzc29jaWF0ZWQgdG8g
dGhpcyB3ZCBhZ2Fpbi4KICAgICAgICAiIiIKICAgICAgICBldmVudF8gPSBzZWxmLnByb2Nlc3Nf
ZGVmYXVsdChyYXdfZXZlbnQpCiAgICAgICAgc2VsZi5fd2F0Y2hfbWFuYWdlci5kZWxfd2F0Y2go
cmF3X2V2ZW50LndkKQogICAgICAgIHJldHVybiBldmVudF8KCiAgICBkZWYgcHJvY2Vzc19kZWZh
dWx0KHNlbGYsIHJhd19ldmVudCwgdG9fYXBwZW5kPU5vbmUpOgogICAgICAgICIiIgogICAgICAg
IENvbW1vbnMgaGFuZGxpbmcgZm9yIHRoZSBmb2xsb3dpbmdzIGV2ZW50czoKCiAgICAgICAgSU5f
QUNDRVNTLCBJTl9NT0RJRlksIElOX0FUVFJJQiwgSU5fQ0xPU0VfV1JJVEUsIElOX0NMT1NFX05P
V1JJVEUsCiAgICAgICAgSU5fT1BFTiwgSU5fREVMRVRFLCBJTl9ERUxFVEVfU0VMRiwgSU5fVU5N
T1VOVC4KICAgICAgICAiIiIKICAgICAgICB3YXRjaF8gPSBzZWxmLl93YXRjaF9tYW5hZ2VyLmdl
dF93YXRjaChyYXdfZXZlbnQud2QpCiAgICAgICAgaWYgcmF3X2V2ZW50Lm1hc2sgJiAoSU5fREVM
RVRFX1NFTEYgfCBJTl9NT1ZFX1NFTEYpOgogICAgICAgICAgICAjIFVuZm9ybnVsYXRlbHkgdGhp
cyBpbmZvcm1hdGlvbiBpcyBub3QgcHJvdmlkZWQgYnkgdGhlIGtlcm5lbAogICAgICAgICAgICBk
aXJfID0gd2F0Y2hfLmRpcgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRpcl8gPSBib29sKHJh
d19ldmVudC5tYXNrICYgSU5fSVNESVIpCiAgICAgICAgZGljdF8gPSB7J3dkJzogcmF3X2V2ZW50
LndkLAogICAgICAgICAgICAgICAgICdtYXNrJzogcmF3X2V2ZW50Lm1hc2ssCiAgICAgICAgICAg
ICAgICAgJ3BhdGgnOiB3YXRjaF8ucGF0aCwKICAgICAgICAgICAgICAgICAnbmFtZSc6IHJhd19l
dmVudC5uYW1lLAogICAgICAgICAgICAgICAgICdkaXInOiBkaXJffQogICAgICAgIGlmIENPTVBB
VElCSUxJVFlfTU9ERToKICAgICAgICAgICAgZGljdF9bJ2lzX2RpciddID0gZGlyXwogICAgICAg
IGlmIHRvX2FwcGVuZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgZGljdF8udXBkYXRlKHRvX2Fw
cGVuZCkKICAgICAgICByZXR1cm4gRXZlbnQoZGljdF8pCgoKY2xhc3MgUHJvY2Vzc0V2ZW50KF9Q
cm9jZXNzRXZlbnQpOgogICAgIiIiCiAgICBQcm9jZXNzIGV2ZW50cyBvYmplY3RzLCBjYW4gYmUg
c3BlY2lhbGl6ZWQgdmlhIHN1YmNsYXNzaW5nLCB0aHVzIGl0cwogICAgYmVoYXZpb3IgY2FuIGJl
IG92ZXJyaWRlbjoKCiAgICBOb3RlOiB5b3Ugc2hvdWxkIG5vdCBvdmVycmlkZSBfX2luaXRfXyBp
biB5b3VyIHN1YmNsYXNzIGluc3RlYWQgZGVmaW5lCiAgICBhIG15X2luaXQoKSBtZXRob2QsIHRo
aXMgbWV0aG9kIHdpbGwgYmUgY2FsbGVkIGF1dG9tYXRpY2FsbHkgZnJvbSB0aGUKICAgIGNvbnN0
cnVjdG9yIG9mIHRoaXMgY2xhc3Mgd2l0aCBpdHMgb3B0aW9uYWxzIHBhcmFtZXRlcnMuCgogICAg
ICAxLiBQcm92aWRlIHNwZWNpYWxpemVkIGluZGl2aWR1YWwgbWV0aG9kcywgZS5nLiBwcm9jZXNz
X0lOX0RFTEVURSBmb3IKICAgICAgICAgcHJvY2Vzc2luZyBhIHByZWNpc2UgdHlwZSBvZiBldmVu
dCAoZS5nLiBJTl9ERUxFVEUgaW4gdGhpcyBjYXNlKS4KICAgICAgMi4gT3IvYW5kIHByb3ZpZGUg
bWV0aG9kcyBmb3IgcHJvY2Vzc2luZyBldmVudHMgYnkgJ2ZhbWlseScsIGUuZy4KICAgICAgICAg
cHJvY2Vzc19JTl9DTE9TRSBtZXRob2Qgd2lsbCBwcm9jZXNzIGJvdGggSU5fQ0xPU0VfV1JJVEUg
YW5kCiAgICAgICAgIElOX0NMT1NFX05PV1JJVEUgZXZlbnRzIChpZiBwcm9jZXNzX0lOX0NMT1NF
X1dSSVRFIGFuZAogICAgICAgICBwcm9jZXNzX0lOX0NMT1NFX05PV1JJVEUgYXJlbid0IGRlZmlu
ZWQgdGhvdWdoKS4KICAgICAgMy4gT3IvYW5kIG92ZXJyaWRlIHByb2Nlc3NfZGVmYXVsdCBmb3Ig
Y2F0Y2hpbmcgYW5kIHByb2Nlc3NpbmcgYWxsCiAgICAgICAgIHRoZSByZW1haW5pbmcgdHlwZXMg
b2YgZXZlbnRzLgogICAgIiIiCiAgICBwZXZlbnQgPSBOb25lCgogICAgZGVmIF9faW5pdF9fKHNl
bGYsIHBldmVudD1Ob25lLCAqKmthcmdzKToKICAgICAgICAiIiIKICAgICAgICBFbmFibGUgY2hh
aW5pbmcgb2YgUHJvY2Vzc0V2ZW50IGluc3RhbmNlcy4KCiAgICAgICAgQHBhcmFtIHBldmVudDog
T3B0aW9uYWwgY2FsbGFibGUgb2JqZWN0LCB3aWxsIGJlIGNhbGxlZCBvbiBldmVudAogICAgICAg
ICAgICAgICAgICAgICAgIHByb2Nlc3NpbmcgKGJlZm9yZSBzZWxmKS4KICAgICAgICBAdHlwZSBw
ZXZlbnQ6IGNhbGxhYmxlCiAgICAgICAgQHBhcmFtIGthcmdzOiBUaGlzIGNvbnN0cnVjdG9yIGlz
IGltcGxlbWVudGVkIGFzIGEgdGVtcGxhdGUgbWV0aG9kCiAgICAgICAgICAgICAgICAgICAgICBk
ZWxlZ2F0aW5nIGl0cyBvcHRpb25hbHMga2V5d29yZGVkIGFyZ3VtZW50cyB0byB0aGUKICAgICAg
ICAgICAgICAgICAgICAgIG1ldGhvZCBteV9pbml0KCkuCiAgICAgICAgQHR5cGUga2FyZ3M6IGRp
Y3QKICAgICAgICAiIiIKICAgICAgICBzZWxmLnBldmVudCA9IHBldmVudAogICAgICAgIHNlbGYu
bXlfaW5pdCgqKmthcmdzKQoKICAgIGRlZiBteV9pbml0KHNlbGYsICoqa2FyZ3MpOgogICAgICAg
ICIiIgogICAgICAgIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBmcm9tIFByb2Nlc3NFdmVudC5fX2lu
aXRfXygpLiBUaGlzIG1ldGhvZCBpcwogICAgICAgIGVtcHR5IGhlcmUgYW5kIG11c3QgYmUgcmVk
ZWZpbmVkIHRvIGJlIHVzZWZ1bC4gSW4gZWZmZWN0LCBpZiB5b3UKICAgICAgICBuZWVkIHRvIHNw
ZWNpZmljYWxseSBpbml0aWFsaXplIHlvdXIgc3ViY2xhc3MnIGluc3RhbmNlIHRoZW4geW91CiAg
ICAgICAganVzdCBoYXZlIHRvIG92ZXJyaWRlIHRoaXMgbWV0aG9kIGluIHlvdXIgc3ViY2xhc3Mu
IFRoZW4gYWxsIHRoZQogICAgICAgIGtleXdvcmRlZCBhcmd1bWVudHMgcGFzc2VkIHRvIFByb2Nl
c3NFdmVudC5fX2luaXRfXygpIHdpbGwgYmUKICAgICAgICB0cmFuc21pdHRlZCBhcyBwYXJhbWV0
ZXJzIHRvIHRoaXMgbWV0aG9kLiBCZXdhcmUgeW91IE1VU1QgcGFzcwogICAgICAgIGtleXdvcmQg
YXJndW1lbnRzIHRob3VnaC4KCiAgICAgICAgQHBhcmFtIGthcmdzOiBvcHRpb25hbCBkZWxlZ2F0
ZWQgYXJndW1lbnRzIGZyb20gX19pbml0X18oKS4KICAgICAgICBAdHlwZSBrYXJnczogZGljdAog
ICAgICAgICIiIgogICAgICAgIHBhc3MKCiAgICBkZWYgX19jYWxsX18oc2VsZiwgZXZlbnQpOgog
ICAgICAgIHN0b3BfY2hhaW5pbmcgPSBGYWxzZQogICAgICAgIGlmIHNlbGYucGV2ZW50IGlzIG5v
dCBOb25lOgogICAgICAgICAgICAjIEJ5IGRlZmF1bHQgbWV0aG9kcyByZXR1cm4gTm9uZSBzbyB3
ZSBzZXQgYXMgZ3VpZGVsaW5lCiAgICAgICAgICAgICMgdGhhdCBtZXRob2RzIGFza2luZyBmb3Ig
c3RvcCBjaGFpbmluZyBtdXN0IGV4cGxpY2l0ZWx5CiAgICAgICAgICAgICMgcmV0dXJuIG5vbiBO
b25lIG9yIG5vbiBGYWxzZSB2YWx1ZXMsIG90aGVyd2lzZSB0aGUgZGVmYXVsdAogICAgICAgICAg
ICAjIGJlaGF2aW9yIHdpbGwgYmUgdG8gYWNjZXB0IGNoYWluIGNhbGwgdG8gdGhlIGNvcnJlc3Bv
bmRpbmcKICAgICAgICAgICAgIyBsb2NhbCBtZXRob2QuCiAgICAgICAgICAgIHN0b3BfY2hhaW5p
bmcgPSBzZWxmLnBldmVudChldmVudCkKICAgICAgICBpZiBub3Qgc3RvcF9jaGFpbmluZzoKICAg
ICAgICAgICAgcmV0dXJuIF9Qcm9jZXNzRXZlbnQuX19jYWxsX18oc2VsZiwgZXZlbnQpCgogICAg
ZGVmIG5lc3RlZF9wZXZlbnQoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYucGV2ZW50CgogICAg
ZGVmIHByb2Nlc3NfSU5fUV9PVkVSRkxPVyhzZWxmLCBldmVudCk6CiAgICAgICAgIiIiCiAgICAg
ICAgQnkgZGVmYXVsdCB0aGlzIG1ldGhvZCBvbmx5IHJlcG9ydHMgd2FybmluZyBtZXNzYWdlcywg
eW91IGNhbiBvdmVycmVkaWRlCiAgICAgICAgaXQgYnkgc3ViY2xhc3NpbmcgUHJvY2Vzc0V2ZW50
IGFuZCBpbXBsZW1lbnQgeW91ciBvd24KICAgICAgICBwcm9jZXNzX0lOX1FfT1ZFUkZMT1cgbWV0
aG9kLiBUaGUgYWN0aW9ucyB5b3UgY2FuIHRha2Ugb24gcmVjZWl2aW5nIHRoaXMKICAgICAgICBl
dmVudCBpcyBlaXRoZXIgdG8gdXBkYXRlIHRoZSB2YXJpYWJsZSBtYXhfcXVldWVkX2V2ZW50cyBp
biBvcmRlciB0bwogICAgICAgIGhhbmRsZSBtb3JlIHNpbXVsdGFuZW91cyBldmVudHMgb3IgdG8g
bW9kaWZ5IHlvdXIgY29kZSBpbiBvcmRlciB0bwogICAgICAgIGFjY29tcGxpc2ggYSBiZXR0ZXIg
ZmlsdGVyaW5nIGRpbWluaXNoaW5nIHRoZSBudW1iZXIgb2YgcmFpc2VkIGV2ZW50cy4KICAgICAg
ICBCZWNhdXNlIHRoaXMgbWV0aG9kIGlzIGRlZmluZWQsIElOX1FfT1ZFUkZMT1cgd2lsbCBuZXZl
ciBnZXQKICAgICAgICB0cmFuc21pdHRlZCBhcyBhcmd1bWVudHMgdG8gcHJvY2Vzc19kZWZhdWx0
IGNhbGxzLgoKICAgICAgICBAcGFyYW0gZXZlbnQ6IElOX1FfT1ZFUkZMT1cgZXZlbnQuCiAgICAg
ICAgQHR5cGUgZXZlbnQ6IGRpY3QKICAgICAgICAiIiIKICAgICAgICBsb2cud2FybmluZygnRXZl
bnQgcXVldWUgb3ZlcmZsb3dlZC4nKQoKICAgIGRlZiBwcm9jZXNzX2RlZmF1bHQoc2VsZiwgZXZl
bnQpOgogICAgICAgICIiIgogICAgICAgIERlZmF1bHQgcHJvY2Vzc2luZyBldmVudCBtZXRob2Qu
IEJ5IGRlZmF1bHQgZG9lcyBub3RoaW5nLiBTdWJjbGFzcwogICAgICAgIFByb2Nlc3NFdmVudCBh
bmQgcmVkZWZpbmUgdGhpcyBtZXRob2QgaW4gb3JkZXIgdG8gbW9kaWZ5IGl0cyBiZWhhdmlvci4K
CiAgICAgICAgQHBhcmFtIGV2ZW50OiBFdmVudCB0byBiZSBwcm9jZXNzZWQuIENhbiBiZSBvZiBh
bnkgdHlwZSBvZiBldmVudHMgYnV0CiAgICAgICAgICAgICAgICAgICAgICBJTl9RX09WRVJGTE9X
IGV2ZW50cyAoc2VlIG1ldGhvZCBwcm9jZXNzX0lOX1FfT1ZFUkZMT1cpLgogICAgICAgIEB0eXBl
IGV2ZW50OiBFdmVudCBpbnN0YW5jZQogICAgICAgICIiIgogICAgICAgIHBhc3MKCgpjbGFzcyBQ
cmludEFsbEV2ZW50cyhQcm9jZXNzRXZlbnQpOgogICAgIiIiCiAgICBEdW1teSBjbGFzcyB1c2Vk
IHRvIHByaW50IGV2ZW50cyBzdHJpbmdzIHJlcHJlc2VudGF0aW9ucy4gRm9yIGluc3RhbmNlIHRo
aXMKICAgIGNsYXNzIGlzIHVzZWQgZnJvbSBjb21tYW5kIGxpbmUgdG8gcHJpbnQgYWxsIHJlY2Vp
dmVkIGV2ZW50cyB0byBzdGRvdXQuCiAgICAiIiIKICAgIGRlZiBteV9pbml0KHNlbGYsIG91dD1O
b25lKToKICAgICAgICAiIiIKICAgICAgICBAcGFyYW0gb3V0OiBXaGVyZSBldmVudHMgd2lsbCBi
ZSB3cml0dGVuLgogICAgICAgIEB0eXBlIG91dDogT2JqZWN0IHByb3ZpZGluZyBhIHZhbGlkIGZp
bGUgb2JqZWN0IGludGVyZmFjZS4KICAgICAgICAiIiIKICAgICAgICBpZiBvdXQgaXMgTm9uZToK
ICAgICAgICAgICAgb3V0ID0gc3lzLnN0ZG91dAogICAgICAgIHNlbGYuX291dCA9IG91dAoKICAg
IGRlZiBwcm9jZXNzX2RlZmF1bHQoc2VsZiwgZXZlbnQpOgogICAgICAgICIiIgogICAgICAgIFdy
aXRlcyBldmVudCBzdHJpbmcgcmVwcmVzZW50YXRpb24gdG8gZmlsZSBvYmplY3QgcHJvdmlkZWQg
dG8KICAgICAgICBteV9pbml0KCkuCgogICAgICAgIEBwYXJhbSBldmVudDogRXZlbnQgdG8gYmUg
cHJvY2Vzc2VkLiBDYW4gYmUgb2YgYW55IHR5cGUgb2YgZXZlbnRzIGJ1dAogICAgICAgICAgICAg
ICAgICAgICAgSU5fUV9PVkVSRkxPVyBldmVudHMgKHNlZSBtZXRob2QgcHJvY2Vzc19JTl9RX09W
RVJGTE9XKS4KICAgICAgICBAdHlwZSBldmVudDogRXZlbnQgaW5zdGFuY2UKICAgICAgICAiIiIK
ICAgICAgICBzZWxmLl9vdXQud3JpdGUoc3RyKGV2ZW50KSkKICAgICAgICBzZWxmLl9vdXQud3Jp
dGUoJ1xuJykKICAgICAgICBzZWxmLl9vdXQuZmx1c2goKQoKCmNsYXNzIENoYWluSWZUcnVlKFBy
b2Nlc3NFdmVudCk6CiAgICAiIiIKICAgIE1ha2VzIGNvbmRpdGlvbmFsIGNoYWluaW5nIGRlcGVu
ZGluZyBvbiB0aGUgcmVzdWx0IG9mIHRoZSBuZXN0ZWQKICAgIHByb2Nlc3NpbmcgaW5zdGFuY2Uu
CiAgICAiIiIKICAgIGRlZiBteV9pbml0KHNlbGYsIGZ1bmMpOgogICAgICAgICIiIgogICAgICAg
IE1ldGhvZCBhdXRvbWF0aWNhbGx5IGNhbGxlZCBmcm9tIGJhc2UgY2xhc3MgY29uc3RydWN0b3Iu
CiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5fZnVuYyA9IGZ1bmMKCiAgICBkZWYgcHJvY2Vzc19k
ZWZhdWx0KHNlbGYsIGV2ZW50KToKICAgICAgICByZXR1cm4gbm90IHNlbGYuX2Z1bmMoZXZlbnQp
CgoKY2xhc3MgU3RhdHMoUHJvY2Vzc0V2ZW50KToKICAgICIiIgogICAgQ29tcHV0ZSBhbmQgZGlz
cGxheSB0cml2aWFsIHN0YXRpc3RpY3MgYWJvdXQgcHJvY2Vzc2VkIGV2ZW50cy4KICAgICIiIgog
ICAgZGVmIG15X2luaXQoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgTWV0aG9kIGF1dG9tYXRp
Y2FsbHkgY2FsbGVkIGZyb20gYmFzZSBjbGFzcyBjb25zdHJ1Y3Rvci4KICAgICAgICAiIiIKICAg
ICAgICBzZWxmLl9zdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICBzZWxmLl9zdGF0cyA9
IHt9CiAgICAgICAgc2VsZi5fc3RhdHNfbG9jayA9IHRocmVhZGluZy5Mb2NrKCkKCiAgICBkZWYg
cHJvY2Vzc19kZWZhdWx0KHNlbGYsIGV2ZW50KToKICAgICAgICAiIiIKICAgICAgICBQcm9jZXNz
ZXMgfGV2ZW50fC4KICAgICAgICAiIiIKICAgICAgICBzZWxmLl9zdGF0c19sb2NrLmFjcXVpcmUo
KQogICAgICAgIHRyeToKICAgICAgICAgICAgZXZlbnRzID0gZXZlbnQubWFza25hbWUuc3BsaXQo
J3wnKQogICAgICAgICAgICBmb3IgZXZlbnRfbmFtZSBpbiBldmVudHM6CiAgICAgICAgICAgICAg
ICBjb3VudCA9IHNlbGYuX3N0YXRzLmdldChldmVudF9uYW1lLCAwKQogICAgICAgICAgICAgICAg
c2VsZi5fc3RhdHNbZXZlbnRfbmFtZV0gPSBjb3VudCArIDEKICAgICAgICBmaW5hbGx5OgogICAg
ICAgICAgICBzZWxmLl9zdGF0c19sb2NrLnJlbGVhc2UoKQoKICAgIGRlZiBfc3RhdHNfY29weShz
ZWxmKToKICAgICAgICBzZWxmLl9zdGF0c19sb2NrLmFjcXVpcmUoKQogICAgICAgIHRyeToKICAg
ICAgICAgICAgcmV0dXJuIHNlbGYuX3N0YXRzLmNvcHkoKQogICAgICAgIGZpbmFsbHk6CiAgICAg
ICAgICAgIHNlbGYuX3N0YXRzX2xvY2sucmVsZWFzZSgpCgogICAgZGVmIF9fcmVwcl9fKHNlbGYp
OgogICAgICAgIHN0YXRzID0gc2VsZi5fc3RhdHNfY29weSgpCgogICAgICAgIGVsYXBzZWQgPSBp
bnQodGltZS50aW1lKCkgLSBzZWxmLl9zdGFydF90aW1lKQogICAgICAgIGVsYXBzZWRfc3RyID0g
JycKICAgICAgICBpZiBlbGFwc2VkIDwgNjA6CiAgICAgICAgICAgIGVsYXBzZWRfc3RyID0gc3Ry
KGVsYXBzZWQpICsgJ3NlYycKICAgICAgICBlbGlmIDYwIDw9IGVsYXBzZWQgPCAzNjAwOgogICAg
ICAgICAgICBlbGFwc2VkX3N0ciA9ICclZG1uJWRzZWMnICUgKGVsYXBzZWQgLyA2MCwgZWxhcHNl
ZCAlIDYwKQogICAgICAgIGVsaWYgMzYwMCA8PSBlbGFwc2VkIDwgODY0MDA6CiAgICAgICAgICAg
IGVsYXBzZWRfc3RyID0gJyVkaCVkbW4nICUgKGVsYXBzZWQgLyAzNjAwLCAoZWxhcHNlZCAlIDM2
MDApIC8gNjApCiAgICAgICAgZWxpZiBlbGFwc2VkID49IDg2NDAwOgogICAgICAgICAgICBlbGFw
c2VkX3N0ciA9ICclZGQlZGgnICUgKGVsYXBzZWQgLyA4NjQwMCwgKGVsYXBzZWQgJSA4NjQwMCkg
LyAzNjAwKQogICAgICAgIHN0YXRzWydFbGFwc2VkVGltZSddID0gZWxhcHNlZF9zdHIKCiAgICAg
ICAgbCA9IFtdCiAgICAgICAgZm9yIGV2LCB2YWx1ZSBpbiBzb3J0ZWQoc3RhdHMuaXRlbXMoKSwg
a2V5PWxhbWJkYSB4OiB4WzBdKToKICAgICAgICAgICAgbC5hcHBlbmQoJyAlcz0lcycgJSAob3V0
cHV0X2Zvcm1hdC5maWVsZF9uYW1lKGV2KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgb3V0cHV0X2Zvcm1hdC5maWVsZF92YWx1ZSh2YWx1ZSkpKQogICAgICAgIHMgPSAnPCVzJXMg
PicgJSAob3V0cHV0X2Zvcm1hdC5jbGFzc19uYW1lKHNlbGYuX19jbGFzc19fLl9fbmFtZV9fKSwK
ICAgICAgICAgICAgICAgICAgICAgICAgICcnLmpvaW4obCkpCiAgICAgICAgcmV0dXJuIHMKCiAg
ICBkZWYgZHVtcChzZWxmLCBmaWxlbmFtZSk6CiAgICAgICAgIiIiCiAgICAgICAgRHVtcHMgc3Rh
dGlzdGljcy4KCiAgICAgICAgQHBhcmFtIGZpbGVuYW1lOiBmaWxlbmFtZSB3aGVyZSBzdGF0cyB3
aWxsIGJlIGR1bXBlZCwgZmlsZW5hbWUgaXMKICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0
ZWQgYW5kIG11c3Qgbm90IGV4aXN0IHByaW9yIHRvIHRoaXMgY2FsbC4KICAgICAgICBAdHlwZSBm
aWxlbmFtZTogc3RyaW5nCiAgICAgICAgIiIiCiAgICAgICAgZmxhZ3MgPSBvcy5PX1dST05MWXxv
cy5PX0NSRUFUfG9zLk9fTk9GT0xMT1d8b3MuT19FWENMCiAgICAgICAgZmQgPSBvcy5vcGVuKGZp
bGVuYW1lLCBmbGFncywgMDYwMCkKICAgICAgICBvcy53cml0ZShmZCwgc3RyKHNlbGYpKQogICAg
ICAgIG9zLmNsb3NlKGZkKQoKICAgIGRlZiBfX3N0cl9fKHNlbGYsIHNjYWxlPTQ1KToKICAgICAg
ICBzdGF0cyA9IHNlbGYuX3N0YXRzX2NvcHkoKQogICAgICAgIGlmIG5vdCBzdGF0czoKICAgICAg
ICAgICAgcmV0dXJuICcnCgogICAgICAgIG0gPSBtYXgoc3RhdHMudmFsdWVzKCkpCiAgICAgICAg
dW5pdHkgPSBmbG9hdChzY2FsZSkgLyBtCiAgICAgICAgZm10ID0gJyUlLTI2cyUlLSVkcyUlcycg
JSAobGVuKG91dHB1dF9mb3JtYXQuZmllbGRfdmFsdWUoJ0AnICogc2NhbGUpKQogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICsgMSkKICAgICAgICBkZWYgZnVuYyh4KToKICAgICAg
ICAgICAgcmV0dXJuIGZtdCAlIChvdXRwdXRfZm9ybWF0LmZpZWxkX25hbWUoeFswXSksCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgb3V0cHV0X2Zvcm1hdC5maWVsZF92YWx1ZSgnQCcgKiBpbnQo
eFsxXSAqIHVuaXR5KSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0X2Zvcm1hdC5z
aW1wbGUoJyVkJyAlIHhbMV0sICd5ZWxsb3cnKSkKICAgICAgICBzID0gJ1xuJy5qb2luKG1hcChm
dW5jLCBzb3J0ZWQoc3RhdHMuaXRlbXMoKSwga2V5PWxhbWJkYSB4OiB4WzBdKSkpCiAgICAgICAg
cmV0dXJuIHMKCgpjbGFzcyBOb3RpZmllckVycm9yKFB5aW5vdGlmeUVycm9yKToKICAgICIiIgog
ICAgTm90aWZpZXIgRXhjZXB0aW9uLiBSYWlzZWQgb24gTm90aWZpZXIgZXJyb3IuCgogICAgIiIi
CiAgICBkZWYgX19pbml0X18oc2VsZiwgZXJyKToKICAgICAgICAiIiIKICAgICAgICBAcGFyYW0g
ZXJyOiBFeGNlcHRpb24gc3RyaW5nJ3MgZGVzY3JpcHRpb24uCiAgICAgICAgQHR5cGUgZXJyOiBz
dHJpbmcKICAgICAgICAiIiIKICAgICAgICBQeWlub3RpZnlFcnJvci5fX2luaXRfXyhzZWxmLCBl
cnIpCgoKY2xhc3MgTm90aWZpZXI6CiAgICAiIiIKICAgIFJlYWQgbm90aWZpY2F0aW9ucywgcHJv
Y2VzcyBldmVudHMuCgogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwgd2F0Y2hfbWFuYWdl
ciwgZGVmYXVsdF9wcm9jX2Z1bj1Ob25lLCByZWFkX2ZyZXE9MCwKICAgICAgICAgICAgICAgICB0
aHJlc2hvbGQ9MCwgdGltZW91dD1Ob25lKToKICAgICAgICAiIiIKICAgICAgICBJbml0aWFsaXph
dGlvbi4gcmVhZF9mcmVxLCB0aHJlc2hvbGQgYW5kIHRpbWVvdXQgcGFyYW1ldGVycyBhcmUgdXNl
ZAogICAgICAgIHdoZW4gbG9vcGluZy4KCiAgICAgICAgQHBhcmFtIHdhdGNoX21hbmFnZXI6IFdh
dGNoIE1hbmFnZXIuCiAgICAgICAgQHR5cGUgd2F0Y2hfbWFuYWdlcjogV2F0Y2hNYW5hZ2VyIGlu
c3RhbmNlCiAgICAgICAgQHBhcmFtIGRlZmF1bHRfcHJvY19mdW46IERlZmF1bHQgcHJvY2Vzc2lu
ZyBtZXRob2QuIElmIE5vbmUsIGEgbmV3CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGluc3RhbmNlIG9mIFByaW50QWxsRXZlbnRzIHdpbGwgYmUgYXNzaWduZWQuCiAgICAgICAgQHR5
cGUgZGVmYXVsdF9wcm9jX2Z1bjogaW5zdGFuY2Ugb2YgUHJvY2Vzc0V2ZW50CiAgICAgICAgQHBh
cmFtIHJlYWRfZnJlcTogaWYgcmVhZF9mcmVxID09IDAsIGV2ZW50cyBhcmUgcmVhZCBhc2FwLAog
ICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlYWRfZnJlcSBpcyA+IDAsIHRoaXMgdGhyZWFk
IHNsZWVwcwogICAgICAgICAgICAgICAgICAgICAgICAgIG1heCgwLCByZWFkX2ZyZXEgLSAodGlt
ZW91dCAvIDEwMDApKSBzZWNvbmRzLiBCdXQgaWYKICAgICAgICAgICAgICAgICAgICAgICAgICB0
aW1lb3V0IGlzIE5vbmUgaXQgbWF5IGJlIGRpZmZlcmVudCBiZWNhdXNlCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgcG9sbCBpcyBibG9ja2luZyB3YWl0aW5nIGZvciBzb21ldGhpbmcgdG8gcmVh
ZC4KICAgICAgICBAdHlwZSByZWFkX2ZyZXE6IGludAogICAgICAgIEBwYXJhbSB0aHJlc2hvbGQ6
IEZpbGUgZGVzY3JpcHRvciB3aWxsIGJlIHJlYWQgb25seSBpZiB0aGUgYWNjdW11bGF0ZWQKICAg
ICAgICAgICAgICAgICAgICAgICAgICBzaXplIHRvIHJlYWQgYmVjb21lcyA+PSB0aHJlc2hvbGQu
IElmICE9IDAsIHlvdSBsaWtlbHkKICAgICAgICAgICAgICAgICAgICAgICAgICB3YW50IHRvIHVz
ZSBpdCBpbiBjb21iaW5hdGlvbiB3aXRoIGFuIGFwcHJvcHJpYXRlCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgdmFsdWUgZm9yIHJlYWRfZnJlcSBiZWNhdXNlIHdpdGhvdXQgdGhhdCB5b3Ugd291
bGQKICAgICAgICAgICAgICAgICAgICAgICAgICBrZWVwIGxvb3Bpbmcgd2l0aG91dCByZWFsbHkg
cmVhZGluZyBhbnl0aGluZyBhbmQgdGhhdAogICAgICAgICAgICAgICAgICAgICAgICAgIHVudGls
IHRoZSBhbW91bnQgb2YgZXZlbnRzIHRvIHJlYWQgaXMgPj0gdGhyZXNob2xkLgogICAgICAgICAg
ICAgICAgICAgICAgICAgIEF0IGxlYXN0IHdpdGggcmVhZF9mcmVxIHNldCB5b3UgbWlnaHQgc2xl
ZXAuCiAgICAgICAgQHR5cGUgdGhyZXNob2xkOiBpbnQKICAgICAgICBAcGFyYW0gdGltZW91dDog
c2VlIHJlYWRfZnJlcSBhYm92ZS4gSWYgcHJvdmlkZWQsIGl0IG11c3QgYmUgc2V0IGluCiAgICAg
ICAgICAgICAgICAgICAgICAgIG1pbGxpc2Vjb25kcy4gU2VlCiAgICAgICAgICAgICAgICAgICAg
ICAgIGh0dHBzOi8vZG9jcy5weXRob24ub3JnLzIvbGlicmFyeS9zZWxlY3QuaHRtbCNwb2xsaW5n
LW9iamVjdHMKICAgICAgICBAdHlwZSB0aW1lb3V0OiBpbnQKICAgICAgICAiIiIKICAgICAgICAj
IFdhdGNoIE1hbmFnZXIgaW5zdGFuY2UKICAgICAgICBzZWxmLl93YXRjaF9tYW5hZ2VyID0gd2F0
Y2hfbWFuYWdlcgogICAgICAgICMgRmlsZSBkZXNjcmlwdG9yCiAgICAgICAgc2VsZi5fZmQgPSBz
ZWxmLl93YXRjaF9tYW5hZ2VyLmdldF9mZCgpCiAgICAgICAgIyBQb2xsIG9iamVjdCBhbmQgcmVn
aXN0cmF0aW9uCiAgICAgICAgc2VsZi5fcG9sbG9iaiA9IHNlbGVjdC5wb2xsKCkKICAgICAgICBz
ZWxmLl9wb2xsb2JqLnJlZ2lzdGVyKHNlbGYuX2ZkLCBzZWxlY3QuUE9MTElOKQogICAgICAgICMg
VGhpcyBwaXBlIGlzIGNvcnJlY3RlbHkgaW5pdGlhbGl6ZWQgYW5kIHVzZWQgYnkgVGhyZWFkZWRO
b3RpZmllcgogICAgICAgIHNlbGYuX3BpcGUgPSAoLTEsIC0xKQogICAgICAgICMgRXZlbnQgcXVl
dWUKICAgICAgICBzZWxmLl9ldmVudHEgPSBkZXF1ZSgpCiAgICAgICAgIyBTeXN0ZW0gcHJvY2Vz
c2luZyBmdW5jdG9yLCBjb21tb24gdG8gYWxsIGV2ZW50cwogICAgICAgIHNlbGYuX3N5c19wcm9j
X2Z1biA9IF9TeXNQcm9jZXNzRXZlbnQoc2VsZi5fd2F0Y2hfbWFuYWdlciwgc2VsZikKICAgICAg
ICAjIERlZmF1bHQgcHJvY2Vzc2luZyBtZXRob2QKICAgICAgICBzZWxmLl9kZWZhdWx0X3Byb2Nf
ZnVuID0gZGVmYXVsdF9wcm9jX2Z1bgogICAgICAgIGlmIGRlZmF1bHRfcHJvY19mdW4gaXMgTm9u
ZToKICAgICAgICAgICAgc2VsZi5fZGVmYXVsdF9wcm9jX2Z1biA9IFByaW50QWxsRXZlbnRzKCkK
ICAgICAgICAjIExvb3AgcGFyYW1ldGVycwogICAgICAgIHNlbGYuX3JlYWRfZnJlcSA9IHJlYWRf
ZnJlcQogICAgICAgIHNlbGYuX3RocmVzaG9sZCA9IHRocmVzaG9sZAogICAgICAgIHNlbGYuX3Rp
bWVvdXQgPSB0aW1lb3V0CiAgICAgICAgIyBDb2FsZXNjZSBldmVudHMgb3B0aW9uCiAgICAgICAg
c2VsZi5fY29hbGVzY2UgPSBGYWxzZQogICAgICAgICMgc2V0IG9mIHN0cihyYXdfZXZlbnQpLCBv
bmx5IHVzZWQgd2hlbiBjb2FsZXNjZSBvcHRpb24gaXMgVHJ1ZQogICAgICAgIHNlbGYuX2V2ZW50
c2V0ID0gc2V0KCkKCiAgICBkZWYgYXBwZW5kX2V2ZW50KHNlbGYsIGV2ZW50KToKICAgICAgICAi
IiIKICAgICAgICBBcHBlbmQgYSByYXcgZXZlbnQgdG8gdGhlIGV2ZW50IHF1ZXVlLgoKICAgICAg
ICBAcGFyYW0gZXZlbnQ6IEFuIGV2ZW50LgogICAgICAgIEB0eXBlIGV2ZW50OiBfUmF3RXZlbnQg
aW5zdGFuY2UuCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5fZXZlbnRxLmFwcGVuZChldmVudCkK
CiAgICBkZWYgcHJvY19mdW4oc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX2RlZmF1bHRfcHJv
Y19mdW4KCiAgICBkZWYgY29hbGVzY2VfZXZlbnRzKHNlbGYsIGNvYWxlc2NlPVRydWUpOgogICAg
ICAgICIiIgogICAgICAgIENvYWxlc2NpbmcgZXZlbnRzLiBFdmVudHMgYXJlIHVzdWFsbHkgcHJv
Y2Vzc2VkIGJ5IGJhdGNocywgdGhlaXIgc2l6ZQogICAgICAgIGRlcGVuZCBvbiB2YXJpb3VzIGZh
Y3RvcnMuIFRodXMsIGJlZm9yZSBwcm9jZXNzaW5nIHRoZW0sIGV2ZW50cyByZWNlaXZlZAogICAg
ICAgIGZyb20gaW5vdGlmeSBhcmUgYWdncmVnYXRlZCBpbiBhIGZpZm8gcXVldWUuIElmIHRoaXMg
Y29hbGVzY2luZwogICAgICAgIG9wdGlvbiBpcyBlbmFibGVkIGV2ZW50cyBhcmUgZmlsdGVyZWQg
YmFzZWQgb24gdGhlaXIgdW5pY2l0eSwgb25seQogICAgICAgIHVuaXF1ZSBldmVudHMgYXJlIGVu
cXVldWVkLCBkb3VibG9ucyBhcmUgZGlzY2FyZGVkLiBBbiBldmVudCBpcyB1bmlxdWUKICAgICAg
ICB3aGVuIHRoZSBjb21iaW5hdGlvbiBvZiBpdHMgZmllbGRzICh3ZCwgbWFzaywgY29va2llLCBu
YW1lKSBpcyB1bmlxdWUKICAgICAgICBhbW9uZyBldmVudHMgb2YgYSBzYW1lIGJhdGNoLiBBZnRl
ciBhIGJhdGNoIG9mIGV2ZW50cyBpcyBwcm9jZXNzZWQgYW55CiAgICAgICAgZXZlbnRzIGlzIGFj
Y2VwdGVkIGFnYWluLiBCeSBkZWZhdWx0IHRoaXMgb3B0aW9uIGlzIGRpc2FibGVkLCB5b3UgaGF2
ZQogICAgICAgIHRvIGV4cGxpY3RseSBjYWxsIHRoaXMgZnVuY3Rpb24gdG8gdHVybiBpdCBvbi4K
CiAgICAgICAgQHBhcmFtIGNvYWxlc2NlOiBPcHRpb25hbCBuZXcgY29hbGVzY2luZyB2YWx1ZS4g
VHJ1ZSBieSBkZWZhdWx0LgogICAgICAgIEB0eXBlIGNvYWxlc2NlOiBCb29sCiAgICAgICAgIiIi
CiAgICAgICAgc2VsZi5fY29hbGVzY2UgPSBjb2FsZXNjZQogICAgICAgIGlmIG5vdCBjb2FsZXNj
ZToKICAgICAgICAgICAgc2VsZi5fZXZlbnRzZXQuY2xlYXIoKQoKICAgIGRlZiBjaGVja19ldmVu
dHMoc2VsZiwgdGltZW91dD1Ob25lKToKICAgICAgICAiIiIKICAgICAgICBDaGVjayBmb3IgbmV3
IGV2ZW50cyBhdmFpbGFibGUgdG8gcmVhZCwgYmxvY2tzIHVwIHRvIHRpbWVvdXQKICAgICAgICBt
aWxsaXNlY29uZHMuCgogICAgICAgIEBwYXJhbSB0aW1lb3V0OiBJZiBzcGVjaWZpZWQgaXQgb3Zl
cnJpZGVzIHRoZSBjb3JyZXNwb25kaW5nIGluc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgICAg
IGF0dHJpYnV0ZSBfdGltZW91dC4gdGltZW91dCBtdXN0IGJlIHNlcGNpZmllZCBpbgogICAgICAg
ICAgICAgICAgICAgICAgICBtaWxsaXNlY29uZHMuCiAgICAgICAgQHR5cGUgdGltZW91dDogaW50
CgogICAgICAgIEByZXR1cm46IE5ldyBldmVudHMgdG8gcmVhZC4KICAgICAgICBAcnR5cGU6IGJv
b2wKICAgICAgICAiIiIKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICB0cnk6CiAgICAg
ICAgICAgICAgICAjIGJsb2NrcyB1cCB0byAndGltZW91dCcgbWlsbGlzZWNvbmRzCiAgICAgICAg
ICAgICAgICBpZiB0aW1lb3V0IGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9
IHNlbGYuX3RpbWVvdXQKICAgICAgICAgICAgICAgIHJldCA9IHNlbGYuX3BvbGxvYmoucG9sbCh0
aW1lb3V0KQogICAgICAgICAgICBleGNlcHQgc2VsZWN0LmVycm9yLCBlcnI6CiAgICAgICAgICAg
ICAgICBpZiBlcnJbMF0gPT0gZXJybm8uRUlOVFI6CiAgICAgICAgICAgICAgICAgICAgY29udGlu
dWUgIyBpbnRlcnJ1cHRlZCwgcmV0cnkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAg
ICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGJyZWFrCgog
ICAgICAgIGlmIG5vdCByZXQgb3IgKHNlbGYuX3BpcGVbMF0gPT0gcmV0WzBdWzBdKToKICAgICAg
ICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgIyBvbmx5IG9uZSBmZCBpcyBwb2xsZWQKICAgICAg
ICByZXR1cm4gcmV0WzBdWzFdICYgc2VsZWN0LlBPTExJTgoKICAgIGRlZiByZWFkX2V2ZW50cyhz
ZWxmKToKICAgICAgICAiIiIKICAgICAgICBSZWFkIGV2ZW50cyBmcm9tIGRldmljZSwgYnVpbGQg
X1Jhd0V2ZW50cywgYW5kIGVucXVldWUgdGhlbS4KICAgICAgICAiIiIKICAgICAgICBidWZfID0g
YXJyYXkuYXJyYXkoJ2knLCBbMF0pCiAgICAgICAgIyBnZXQgZXZlbnQgcXVldWUgc2l6ZQogICAg
ICAgIGlmIGZjbnRsLmlvY3RsKHNlbGYuX2ZkLCB0ZXJtaW9zLkZJT05SRUFELCBidWZfLCAxKSA9
PSAtMToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgcXVldWVfc2l6ZSA9IGJ1Zl9bMF0KICAg
ICAgICBpZiBxdWV1ZV9zaXplIDwgc2VsZi5fdGhyZXNob2xkOgogICAgICAgICAgICBsb2cuZGVi
dWcoJyhmZDogJWQpICVkIGJ5dGVzIGF2YWlsYWJsZSB0byByZWFkIGJ1dCB0aHJlc2hvbGQgaXMg
JwogICAgICAgICAgICAgICAgICAgICAgJ2ZpeGVkIHRvICVkIGJ5dGVzJywgc2VsZi5fZmQsIHF1
ZXVlX3NpemUsCiAgICAgICAgICAgICAgICAgICAgICBzZWxmLl90aHJlc2hvbGQpCiAgICAgICAg
ICAgIHJldHVybgoKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgUmVhZCBjb250ZW50IGZyb20g
ZmlsZQogICAgICAgICAgICByID0gb3MucmVhZChzZWxmLl9mZCwgcXVldWVfc2l6ZSkKICAgICAg
ICBleGNlcHQgRXhjZXB0aW9uLCBtc2c6CiAgICAgICAgICAgIHJhaXNlIE5vdGlmaWVyRXJyb3Io
bXNnKQogICAgICAgIGxvZy5kZWJ1ZygnRXZlbnQgcXVldWUgc2l6ZTogJWQnLCBxdWV1ZV9zaXpl
KQogICAgICAgIHJzdW0gPSAwICAjIGNvdW50ZXIKICAgICAgICB3aGlsZSByc3VtIDwgcXVldWVf
c2l6ZToKICAgICAgICAgICAgc19zaXplID0gMTYKICAgICAgICAgICAgIyBSZXRyaWV2ZSB3ZCwg
bWFzaywgY29va2llIGFuZCBmbmFtZV9sZW4KICAgICAgICAgICAgd2QsIG1hc2ssIGNvb2tpZSwg
Zm5hbWVfbGVuID0gc3RydWN0LnVucGFjaygnaUlJSScsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcltyc3VtOnJzdW0rc19zaXplXSkKICAg
ICAgICAgICAgIyBSZXRyaWV2ZSBuYW1lCiAgICAgICAgICAgIGZuYW1lLCA9IHN0cnVjdC51bnBh
Y2soJyVkcycgJSBmbmFtZV9sZW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cltyc3VtICsgc19zaXplOnJzdW0gKyBzX3NpemUgKyBmbmFtZV9sZW5dKQogICAgICAgICAgICBy
YXdldmVudCA9IF9SYXdFdmVudCh3ZCwgbWFzaywgY29va2llLCBmbmFtZSkKICAgICAgICAgICAg
aWYgc2VsZi5fY29hbGVzY2U6CiAgICAgICAgICAgICAgICAjIE9ubHkgZW5xdWV1ZSBuZXcgKHVu
aXF1ZSkgZXZlbnRzLgogICAgICAgICAgICAgICAgcmF3ZXZlbnRzdHIgPSBzdHIocmF3ZXZlbnQp
CiAgICAgICAgICAgICAgICBpZiByYXdldmVudHN0ciBub3QgaW4gc2VsZi5fZXZlbnRzZXQ6CiAg
ICAgICAgICAgICAgICAgICAgc2VsZi5fZXZlbnRzZXQuYWRkKHJhd2V2ZW50c3RyKQogICAgICAg
ICAgICAgICAgICAgIHNlbGYuX2V2ZW50cS5hcHBlbmQocmF3ZXZlbnQpCiAgICAgICAgICAgIGVs
c2U6CiAgICAgICAgICAgICAgICBzZWxmLl9ldmVudHEuYXBwZW5kKHJhd2V2ZW50KQogICAgICAg
ICAgICByc3VtICs9IHNfc2l6ZSArIGZuYW1lX2xlbgoKICAgIGRlZiBwcm9jZXNzX2V2ZW50cyhz
ZWxmKToKICAgICAgICAiIiIKICAgICAgICBSb3V0aW5lIGZvciBwcm9jZXNzaW5nIGV2ZW50cyBm
cm9tIHF1ZXVlIGJ5IGNhbGxpbmcgdGhlaXIKICAgICAgICBhc3NvY2lhdGVkIHByb2NjZXNzaW5n
IG1ldGhvZCAoYW4gaW5zdGFuY2Ugb2YgUHJvY2Vzc0V2ZW50KS4KICAgICAgICBJdCBhbHNvIGRv
ZXMgaW50ZXJuYWwgcHJvY2Vzc2luZ3MsIHRvIGtlZXAgdGhlIHN5c3RlbSB1cGRhdGVkLgogICAg
ICAgICIiIgogICAgICAgIHdoaWxlIHNlbGYuX2V2ZW50cToKICAgICAgICAgICAgcmF3X2V2ZW50
ID0gc2VsZi5fZXZlbnRxLnBvcGxlZnQoKSAgIyBwb3AgbmV4dCBldmVudAogICAgICAgICAgICBp
ZiBzZWxmLl93YXRjaF9tYW5hZ2VyLmlnbm9yZV9ldmVudHM6CiAgICAgICAgICAgICAgICBsb2cu
ZGVidWcoIkV2ZW50IGlnbm9yZWQ6ICVzIiAlIHJlcHIocmF3X2V2ZW50KSkKICAgICAgICAgICAg
ICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHdhdGNoXyA9IHNlbGYuX3dhdGNoX21hbmFnZXIuZ2V0
X3dhdGNoKHJhd19ldmVudC53ZCkKICAgICAgICAgICAgaWYgKHdhdGNoXyBpcyBOb25lKSBhbmQg
bm90IChyYXdfZXZlbnQubWFzayAmIElOX1FfT1ZFUkZMT1cpOgogICAgICAgICAgICAgICAgaWYg
bm90IChyYXdfZXZlbnQubWFzayAmIElOX0lHTk9SRUQpOgogICAgICAgICAgICAgICAgICAgICMg
Tm90IHJlYWxseSBzdXJlIGhvdyB3ZSBlbmRlZCB1cCBoZXJlLCBub3IgaG93IHdlIHNob3VsZAog
ICAgICAgICAgICAgICAgICAgICMgaGFuZGxlIHRoZXNlIHR5cGVzIG9mIGV2ZW50cyBhbmQgaWYg
aXQgaXMgYXBwcm9wcmlhdGUgdG8KICAgICAgICAgICAgICAgICAgICAjIGNvbXBsZXRseSBza2lw
IHRoZW0gKGxpa2Ugd2UgYXJlIGRvaW5nIGhlcmUpLgogICAgICAgICAgICAgICAgICAgIGxvZy53
YXJuaW5nKCJVbmFibGUgdG8gcmV0cmlldmUgV2F0Y2ggb2JqZWN0IGFzc29jaWF0ZWQgdG8gJXMi
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcHIocmF3X2V2ZW50KSkKICAgICAg
ICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHJldmVudCA9IHNlbGYuX3N5c19wcm9jX2Z1
bihyYXdfZXZlbnQpICAjIHN5c3RlbSBwcm9jZXNzaW5ncwogICAgICAgICAgICBpZiB3YXRjaF8g
YW5kIHdhdGNoXy5wcm9jX2Z1bjoKICAgICAgICAgICAgICAgIHdhdGNoXy5wcm9jX2Z1bihyZXZl
bnQpICAjIHVzZXIgcHJvY2Vzc2luZ3MKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAg
IHNlbGYuX2RlZmF1bHRfcHJvY19mdW4ocmV2ZW50KQogICAgICAgIHNlbGYuX3N5c19wcm9jX2Z1
bi5jbGVhbnVwKCkgICMgcmVtb3ZlIG9sZHMgTU9WRURfKiBldmVudHMgcmVjb3JkcwogICAgICAg
IGlmIHNlbGYuX2NvYWxlc2NlOgogICAgICAgICAgICBzZWxmLl9ldmVudHNldC5jbGVhcigpCgog
ICAgZGVmIF9fZGFlbW9uaXplKHNlbGYsIHBpZF9maWxlPU5vbmUsIHN0ZGluPW9zLmRldm51bGws
IHN0ZG91dD1vcy5kZXZudWxsLAogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1vcy5kZXZudWxs
KToKICAgICAgICAiIiIKICAgICAgICBAcGFyYW0gcGlkX2ZpbGU6IGZpbGUgd2hlcmUgdGhlIHBp
ZCB3aWxsIGJlIHdyaXR0ZW4uIElmIHBpZF9maWxlPU5vbmUKICAgICAgICAgICAgICAgICAgICAg
ICAgIHRoZSBwaWQgaXMgd3JpdHRlbiB0bwogICAgICAgICAgICAgICAgICAgICAgICAgL3Zhci9y
dW4vPHN5cy5hcmd2WzBdfHB5aW5vdGlmeT4ucGlkLCBpZiBwaWRfZmlsZT1GYWxzZQogICAgICAg
ICAgICAgICAgICAgICAgICAgbm8gcGlkX2ZpbGUgaXMgd3JpdHRlbi4KICAgICAgICBAcGFyYW0g
c3RkaW46CiAgICAgICAgQHBhcmFtIHN0ZG91dDoKICAgICAgICBAcGFyYW0gc3RkZXJyOiBmaWxl
cyBhc3NvY2lhdGVkIHRvIGNvbW1vbiBzdHJlYW1zLgogICAgICAgICIiIgogICAgICAgIGlmIHBp
ZF9maWxlIGlzIE5vbmU6CiAgICAgICAgICAgIGRpcm5hbWUgPSAnL3Zhci9ydW4vJwogICAgICAg
ICAgICBiYXNlbmFtZSA9IG9zLnBhdGguYmFzZW5hbWUoc3lzLmFyZ3ZbMF0pIG9yICdweWlub3Rp
ZnknCiAgICAgICAgICAgIHBpZF9maWxlID0gb3MucGF0aC5qb2luKGRpcm5hbWUsIGJhc2VuYW1l
ICsgJy5waWQnKQoKICAgICAgICBpZiBwaWRfZmlsZSAhPSBGYWxzZSBhbmQgb3MucGF0aC5sZXhp
c3RzKHBpZF9maWxlKToKICAgICAgICAgICAgZXJyID0gJ0Nhbm5vdCBkYWVtb25pemU6IHBpZCBm
aWxlICVzIGFscmVhZHkgZXhpc3RzLicgJSBwaWRfZmlsZQogICAgICAgICAgICByYWlzZSBOb3Rp
ZmllckVycm9yKGVycikKCiAgICAgICAgZGVmIGZvcmtfZGFlbW9uKCk6CiAgICAgICAgICAgICMg
QWRhcHRlZCBmcm9tIENoYWQgSi4gU2Nocm9lZGVyJ3MgcmVjaXBlCiAgICAgICAgICAgICMgQHNl
ZSBodHRwOi8vY29kZS5hY3RpdmVzdGF0ZS5jb20vcmVjaXBlcy8yNzg3MzEvCiAgICAgICAgICAg
IHBpZCA9IG9zLmZvcmsoKQogICAgICAgICAgICBpZiAocGlkID09IDApOgogICAgICAgICAgICAg
ICAgIyBwYXJlbnQgMgogICAgICAgICAgICAgICAgb3Muc2V0c2lkKCkKICAgICAgICAgICAgICAg
IHBpZCA9IG9zLmZvcmsoKQogICAgICAgICAgICAgICAgaWYgKHBpZCA9PSAwKToKICAgICAgICAg
ICAgICAgICAgICAjIGNoaWxkCiAgICAgICAgICAgICAgICAgICAgb3MuY2hkaXIoJy8nKQogICAg
ICAgICAgICAgICAgICAgIG9zLnVtYXNrKDAyMikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAg
ICAgICAgICAgICAgICAgIyBwYXJlbnQgMgogICAgICAgICAgICAgICAgICAgIG9zLl9leGl0KDAp
CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIHBhcmVudCAxCiAgICAgICAgICAg
ICAgICBvcy5fZXhpdCgwKQoKICAgICAgICAgICAgZmRfaW5wID0gb3Mub3BlbihzdGRpbiwgb3Mu
T19SRE9OTFkpCiAgICAgICAgICAgIG9zLmR1cDIoZmRfaW5wLCAwKQogICAgICAgICAgICBmZF9v
dXQgPSBvcy5vcGVuKHN0ZG91dCwgb3MuT19XUk9OTFl8b3MuT19DUkVBVCwgMDYwMCkKICAgICAg
ICAgICAgb3MuZHVwMihmZF9vdXQsIDEpCiAgICAgICAgICAgIGZkX2VyciA9IG9zLm9wZW4oc3Rk
ZXJyLCBvcy5PX1dST05MWXxvcy5PX0NSRUFULCAwNjAwKQogICAgICAgICAgICBvcy5kdXAyKGZk
X2VyciwgMikKCiAgICAgICAgIyBEZXRhY2ggdGFzawogICAgICAgIGZvcmtfZGFlbW9uKCkKCiAg
ICAgICAgIyBXcml0ZSBwaWQKICAgICAgICBpZiBwaWRfZmlsZSAhPSBGYWxzZToKICAgICAgICAg
ICAgZmxhZ3MgPSBvcy5PX1dST05MWXxvcy5PX0NSRUFUfG9zLk9fTk9GT0xMT1d8b3MuT19FWENM
CiAgICAgICAgICAgIGZkX3BpZCA9IG9zLm9wZW4ocGlkX2ZpbGUsIGZsYWdzLCAwNjAwKQogICAg
ICAgICAgICBvcy53cml0ZShmZF9waWQsIHN0cihvcy5nZXRwaWQoKSkgKyAnXG4nKQogICAgICAg
ICAgICBvcy5jbG9zZShmZF9waWQpCiAgICAgICAgICAgICMgUmVnaXN0ZXIgdW5saW5rIGZ1bmN0
aW9uCiAgICAgICAgICAgIGF0ZXhpdC5yZWdpc3RlcihsYW1iZGEgOiBvcy51bmxpbmsocGlkX2Zp
bGUpKQoKICAgIGRlZiBfc2xlZXAoc2VsZiwgcmVmX3RpbWUpOgogICAgICAgICMgT25seSBjb25z
aWRlciBzbGVlcGluZyBpZiByZWFkX2ZyZXEgaXMgPiAwCiAgICAgICAgaWYgc2VsZi5fcmVhZF9m
cmVxID4gMDoKICAgICAgICAgICAgY3VyX3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICBz
bGVlcF9hbW91bnQgPSBzZWxmLl9yZWFkX2ZyZXEgLSAoY3VyX3RpbWUgLSByZWZfdGltZSkKICAg
ICAgICAgICAgaWYgc2xlZXBfYW1vdW50ID4gMDoKICAgICAgICAgICAgICAgIGxvZy5kZWJ1Zygn
Tm93IHNsZWVwaW5nICVkIHNlY29uZHMnLCBzbGVlcF9hbW91bnQpCiAgICAgICAgICAgICAgICB0
aW1lLnNsZWVwKHNsZWVwX2Ftb3VudCkKCiAgICBkZWYgbG9vcChzZWxmLCBjYWxsYmFjaz1Ob25l
LCBkYWVtb25pemU9RmFsc2UsICoqYXJncyk6CiAgICAgICAgIiIiCiAgICAgICAgRXZlbnRzIGFy
ZSByZWFkIG9ubHkgb25lIHRpbWUgZXZlcnkgbWluKHJlYWRfZnJlcSwgdGltZW91dCkKICAgICAg
ICBzZWNvbmRzIGF0IGJlc3QgYW5kIG9ubHkgaWYgdGhlIHNpemUgdG8gcmVhZCBpcyA+PSB0aHJl
c2hvbGQuCiAgICAgICAgQWZ0ZXIgdGhpcyBtZXRob2QgcmV0dXJucyBpdCBtdXN0IG5vdCBiZSBj
YWxsZWQgYWdhaW4gZm9yIHRoZSBzYW1lCiAgICAgICAgaW5zdGFuY2UuCgogICAgICAgIEBwYXJh
bSBjYWxsYmFjazogRnVuY3RvciBjYWxsZWQgYWZ0ZXIgZWFjaCBldmVudCBwcm9jZXNzaW5nIGl0
ZXJhdGlvbi4KICAgICAgICAgICAgICAgICAgICAgICAgIEV4cGVjdHMgdG8gcmVjZWl2ZSB0aGUg
bm90aWZpZXIgb2JqZWN0IChzZWxmKSBhcyBmaXJzdAogICAgICAgICAgICAgICAgICAgICAgICAg
cGFyYW1ldGVyLiBJZiB0aGlzIGZ1bmN0aW9uIHJldHVybnMgVHJ1ZSB0aGUgbG9vcCBpcwogICAg
ICAgICAgICAgICAgICAgICAgICAgaW1tZWRpYXRlbHkgdGVybWluYXRlZCBvdGhlcndpc2UgdGhl
IGxvb3AgbWV0aG9kIGtlZXBzCiAgICAgICAgICAgICAgICAgICAgICAgICBsb29waW5nLgogICAg
ICAgIEB0eXBlIGNhbGxiYWNrOiBjYWxsYWJsZSBvYmplY3Qgb3IgZnVuY3Rpb24KICAgICAgICBA
cGFyYW0gZGFlbW9uaXplOiBUaGlzIHRocmVhZCBpcyBkYWVtb25pemVkIGlmIHNldCB0byBUcnVl
LgogICAgICAgIEB0eXBlIGRhZW1vbml6ZTogYm9vbGVhbgogICAgICAgIEBwYXJhbSBhcmdzOiBP
cHRpb25hbCBhbmQgcmVsZXZhbnQgb25seSBpZiBkYWVtb25pemUgaXMgVHJ1ZS4gUmVtYWluaW5n
CiAgICAgICAgICAgICAgICAgICAgIGtleXdvcmRlZCBhcmd1bWVudHMgYXJlIGRpcmVjdGx5IHBh
c3NlZCB0byBkYWVtb25pemUgc2VlCiAgICAgICAgICAgICAgICAgICAgIF9fZGFlbW9uaXplKCkg
bWV0aG9kLiBJZiBwaWRfZmlsZT1Ob25lIG9yIGlzIHNldCB0byBhCiAgICAgICAgICAgICAgICAg
ICAgIHBhdGhuYW1lIHRoZSBjYWxsZXIgbXVzdCBlbnN1cmUgdGhlIGZpbGUgZG9lcyBub3QgZXhp
c3QKICAgICAgICAgICAgICAgICAgICAgYmVmb3JlIHRoaXMgbWV0aG9kIGlzIGNhbGxlZCBvdGhl
cndpc2UgYW4gZXhjZXB0aW9uCiAgICAgICAgICAgICAgICAgICAgIHB5aW5vdGlmeS5Ob3RpZmll
ckVycm9yIHdpbGwgYmUgcmFpc2VkLiBJZiBwaWRfZmlsZT1GYWxzZQogICAgICAgICAgICAgICAg
ICAgICBpdCBpcyBzdGlsbCBkYWVtb25pemVkIGJ1dCB0aGUgcGlkIGlzIG5vdCB3cml0dGVuIGlu
IGFueQogICAgICAgICAgICAgICAgICAgICBmaWxlLgogICAgICAgIEB0eXBlIGFyZ3M6IHZhcmlv
dXMKICAgICAgICAiIiIKICAgICAgICBpZiBkYWVtb25pemU6CiAgICAgICAgICAgIHNlbGYuX19k
YWVtb25pemUoKiphcmdzKQoKICAgICAgICAjIFJlYWQgYW5kIHByb2Nlc3MgZXZlbnRzIGZvcmV2
ZXIKICAgICAgICB3aGlsZSAxOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxm
LnByb2Nlc3NfZXZlbnRzKCkKICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayBpcyBub3QgTm9u
ZSkgYW5kIChjYWxsYmFjayhzZWxmKSBpcyBUcnVlKToKICAgICAgICAgICAgICAgICAgICBicmVh
awogICAgICAgICAgICAgICAgcmVmX3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICAgICAg
IyBjaGVja19ldmVudHMgaXMgYmxvY2tpbmcKICAgICAgICAgICAgICAgIGlmIHNlbGYuY2hlY2tf
ZXZlbnRzKCk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2xlZXAocmVmX3RpbWUpCiAgICAg
ICAgICAgICAgICAgICAgc2VsZi5yZWFkX2V2ZW50cygpCiAgICAgICAgICAgIGV4Y2VwdCBLZXli
b2FyZEludGVycnVwdDoKICAgICAgICAgICAgICAgICMgU3RvcCBtb25pdG9yaW5nIGlmIHNpZ2lu
dCBpcyBjYXVnaHQgKENvbnRyb2wtQykuCiAgICAgICAgICAgICAgICBsb2cuZGVidWcoJ1B5aW5v
dGlmeSBzdG9wcyBtb25pdG9yaW5nLicpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICMg
Q2xvc2UgaW50ZXJuYWxzCiAgICAgICAgc2VsZi5zdG9wKCkKCiAgICBkZWYgc3RvcChzZWxmKToK
ICAgICAgICAiIiIKICAgICAgICBDbG9zZSBpbm90aWZ5J3MgaW5zdGFuY2UgKGNsb3NlIGl0cyBm
aWxlIGRlc2NyaXB0b3IpLgogICAgICAgIEl0IGRlc3Ryb3lzIGFsbCBleGlzdGluZyB3YXRjaGVz
LCBwZW5kaW5nIGV2ZW50cywuLi4KICAgICAgICBUaGlzIG1ldGhvZCBpcyBhdXRvbWF0aWNhbGx5
IGNhbGxlZCBhdCB0aGUgZW5kIG9mIGxvb3AoKS4KICAgICAgICBBZnRlcndhcmQgaXQgaXMgaW52
YWxpZCB0byBhY2Nlc3MgdGhpcyBpbnN0YW5jZS4KICAgICAgICAiIiIKICAgICAgICBpZiBzZWxm
Ll9mZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgc2VsZi5fcG9sbG9iai51bnJlZ2lzdGVyKHNl
bGYuX2ZkKQogICAgICAgICAgICBvcy5jbG9zZShzZWxmLl9mZCkKICAgICAgICAgICAgc2VsZi5f
ZmQgPSBOb25lCiAgICAgICAgc2VsZi5fc3lzX3Byb2NfZnVuID0gTm9uZQoKCmNsYXNzIFRocmVh
ZGVkTm90aWZpZXIodGhyZWFkaW5nLlRocmVhZCwgTm90aWZpZXIpOgogICAgIiIiCiAgICBUaGlz
IG5vdGlmaWVyIGluaGVyaXRzIGZyb20gdGhyZWFkaW5nLlRocmVhZCBmb3IgaW5zdGFuY2lhdGlu
ZyBhIHNlcGFyYXRlCiAgICB0aHJlYWQsIGFuZCBhbHNvIGluaGVyaXRzIGZyb20gTm90aWZpZXIs
IGJlY2F1c2UgaXQgaXMgYSB0aHJlYWRlZCBub3RpZmllci4KCiAgICBOb3RlIHRoYXQgZXZlcnkg
ZnVuY3Rpb25hbGl0eSBwcm92aWRlZCBieSB0aGlzIGNsYXNzIGlzIGFsc28gcHJvdmlkZWQKICAg
IHRocm91Z2ggTm90aWZpZXIgY2xhc3MuIE1vcmVvdmVyIE5vdGlmaWVyIHNob3VsZCBiZSBjb25z
aWRlcmVkIGZpcnN0IGJlY2F1c2UKICAgIGl0IGlzIG5vdCB0aHJlYWRlZCBhbmQgY291bGQgYmUg
ZWFzaWx5IGRhZW1vbml6ZWQuCiAgICAiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB3YXRjaF9t
YW5hZ2VyLCBkZWZhdWx0X3Byb2NfZnVuPU5vbmUsIHJlYWRfZnJlcT0wLAogICAgICAgICAgICAg
ICAgIHRocmVzaG9sZD0wLCB0aW1lb3V0PU5vbmUpOgogICAgICAgICIiIgogICAgICAgIEluaXRp
YWxpemF0aW9uLCBpbml0aWFsaXplIGJhc2UgY2xhc3Nlcy4gcmVhZF9mcmVxLCB0aHJlc2hvbGQg
YW5kCiAgICAgICAgdGltZW91dCBwYXJhbWV0ZXJzIGFyZSB1c2VkIHdoZW4gbG9vcGluZy4KCiAg
ICAgICAgQHBhcmFtIHdhdGNoX21hbmFnZXI6IFdhdGNoIE1hbmFnZXIuCiAgICAgICAgQHR5cGUg
d2F0Y2hfbWFuYWdlcjogV2F0Y2hNYW5hZ2VyIGluc3RhbmNlCiAgICAgICAgQHBhcmFtIGRlZmF1
bHRfcHJvY19mdW46IERlZmF1bHQgcHJvY2Vzc2luZyBtZXRob2QuIFNlZSBiYXNlIGNsYXNzLgog
ICAgICAgIEB0eXBlIGRlZmF1bHRfcHJvY19mdW46IGluc3RhbmNlIG9mIFByb2Nlc3NFdmVudAog
ICAgICAgIEBwYXJhbSByZWFkX2ZyZXE6IGlmIHJlYWRfZnJlcSA9PSAwLCBldmVudHMgYXJlIHJl
YWQgYXNhcCwKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZWFkX2ZyZXEgaXMgPiAwLCB0
aGlzIHRocmVhZCBzbGVlcHMKICAgICAgICAgICAgICAgICAgICAgICAgICBtYXgoMCwgcmVhZF9m
cmVxIC0gKHRpbWVvdXQgLyAxMDAwKSkgc2Vjb25kcy4KICAgICAgICBAdHlwZSByZWFkX2ZyZXE6
IGludAogICAgICAgIEBwYXJhbSB0aHJlc2hvbGQ6IEZpbGUgZGVzY3JpcHRvciB3aWxsIGJlIHJl
YWQgb25seSBpZiB0aGUgYWNjdW11bGF0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgICBzaXpl
IHRvIHJlYWQgYmVjb21lcyA+PSB0aHJlc2hvbGQuIElmICE9IDAsIHlvdSBsaWtlbHkKICAgICAg
ICAgICAgICAgICAgICAgICAgICB3YW50IHRvIHVzZSBpdCBpbiBjb21iaW5hdGlvbiB3aXRoIGFu
IGFwcHJvcHJpYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgc2V0IGZvciByZWFk
X2ZyZXEgYmVjYXVzZSB3aXRob3V0IHRoYXQgeW91IHdvdWxkCiAgICAgICAgICAgICAgICAgICAg
ICAgICAga2VlcCBsb29waW5nIHdpdGhvdXQgcmVhbGx5IHJlYWRpbmcgYW55dGhpbmcgYW5kIHRo
YXQKICAgICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCB0aGUgYW1vdW50IG9mIGV2ZW50cyB0
byByZWFkIGlzID49IHRocmVzaG9sZC4gQXQKICAgICAgICAgICAgICAgICAgICAgICAgICBsZWFz
dCB3aXRoIHJlYWRfZnJlcSB5b3UgbWlnaHQgc2xlZXAuCiAgICAgICAgQHR5cGUgdGhyZXNob2xk
OiBpbnQKICAgICAgICBAcGFyYW0gdGltZW91dDogc2VlIHJlYWRfZnJlcSBhYm92ZS4gSWYgcHJv
dmlkZWQsIGl0IG11c3QgYmUgc2V0IGluCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbGxpc2Vj
b25kcy4gU2VlCiAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBzOi8vZG9jcy5weXRob24ub3Jn
LzIvbGlicmFyeS9zZWxlY3QuaHRtbCNzZWxlY3QucG9sbC5wb2xsCiAgICAgICAgQHR5cGUgdGlt
ZW91dDogaW50CiAgICAgICAgIiIiCiAgICAgICAgIyBJbml0IHRocmVhZGluZyBiYXNlIGNsYXNz
CiAgICAgICAgdGhyZWFkaW5nLlRocmVhZC5fX2luaXRfXyhzZWxmKQogICAgICAgICMgU3RvcCBj
b25kaXRpb24KICAgICAgICBzZWxmLl9zdG9wX2V2ZW50ID0gdGhyZWFkaW5nLkV2ZW50KCkKICAg
ICAgICAjIEluaXQgTm90aWZpZXIgYmFzZSBjbGFzcwogICAgICAgIE5vdGlmaWVyLl9faW5pdF9f
KHNlbGYsIHdhdGNoX21hbmFnZXIsIGRlZmF1bHRfcHJvY19mdW4sIHJlYWRfZnJlcSwKICAgICAg
ICAgICAgICAgICAgICAgICAgICB0aHJlc2hvbGQsIHRpbWVvdXQpCiAgICAgICAgIyBDcmVhdGUg
YSBuZXcgcGlwZSB1c2VkIGZvciB0aHJlYWQgdGVybWluYXRpb24KICAgICAgICBzZWxmLl9waXBl
ID0gb3MucGlwZSgpCiAgICAgICAgc2VsZi5fcG9sbG9iai5yZWdpc3RlcihzZWxmLl9waXBlWzBd
LCBzZWxlY3QuUE9MTElOKQoKICAgIGRlZiBzdG9wKHNlbGYpOgogICAgICAgICIiIgogICAgICAg
IFN0b3Agbm90aWZpZXIncyBsb29wLiBTdG9wIG5vdGlmaWNhdGlvbi4gSm9pbiB0aGUgdGhyZWFk
LgogICAgICAgICIiIgogICAgICAgIHNlbGYuX3N0b3BfZXZlbnQuc2V0KCkKICAgICAgICBvcy53
cml0ZShzZWxmLl9waXBlWzFdLCAnc3RvcCcpCiAgICAgICAgdGhyZWFkaW5nLlRocmVhZC5qb2lu
KHNlbGYpCiAgICAgICAgTm90aWZpZXIuc3RvcChzZWxmKQogICAgICAgIHNlbGYuX3BvbGxvYmou
dW5yZWdpc3RlcihzZWxmLl9waXBlWzBdKQogICAgICAgIG9zLmNsb3NlKHNlbGYuX3BpcGVbMF0p
CiAgICAgICAgb3MuY2xvc2Uoc2VsZi5fcGlwZVsxXSkKCiAgICBkZWYgbG9vcChzZWxmKToKICAg
ICAgICAiIiIKICAgICAgICBUaHJlYWQncyBtYWluIGxvb3AuIERvbid0IG1lYW50IHRvIGJlIGNh
bGxlZCBieSB1c2VyIGRpcmVjdGx5LgogICAgICAgIENhbGwgaW5oZXJpdGVkIHN0YXJ0KCkgbWV0
aG9kIGluc3RlYWQuCgogICAgICAgIEV2ZW50cyBhcmUgcmVhZCBvbmx5IG9uY2UgdGltZSBldmVy
eSBtaW4ocmVhZF9mcmVxLCB0aW1lb3V0KQogICAgICAgIHNlY29uZHMgYXQgYmVzdCBhbmQgb25s
eSBpZiB0aGUgc2l6ZSBvZiBldmVudHMgdG8gcmVhZCBpcyA+PSB0aHJlc2hvbGQuCiAgICAgICAg
IiIiCiAgICAgICAgIyBXaGVuIHRoZSBsb29wIG11c3QgYmUgdGVybWluYXRlZCAuc3RvcCgpIGlz
IGNhbGxlZCwgJ3N0b3AnCiAgICAgICAgIyBpcyB3cml0dGVuIHRvIHBpcGUgZmQgc28gcG9sbCgp
IHJldHVybnMgYW5kIC5jaGVja19ldmVudHMoKQogICAgICAgICMgcmV0dXJucyBGYWxzZSB3aGlj
aCBtYWtlIGV2YWx1YXRlIHRoZSBXaGlsZSdzIHN0b3AgY29uZGl0aW9uCiAgICAgICAgIyAuX3N0
b3BfZXZlbnQuaXNTZXQoKSB3aWNoIHB1dCBhbiBlbmQgdG8gdGhlIHRocmVhZCdzIGV4ZWN1dGlv
bi4KICAgICAgICB3aGlsZSBub3Qgc2VsZi5fc3RvcF9ldmVudC5pc1NldCgpOgogICAgICAgICAg
ICBzZWxmLnByb2Nlc3NfZXZlbnRzKCkKICAgICAgICAgICAgcmVmX3RpbWUgPSB0aW1lLnRpbWUo
KQogICAgICAgICAgICBpZiBzZWxmLmNoZWNrX2V2ZW50cygpOgogICAgICAgICAgICAgICAgc2Vs
Zi5fc2xlZXAocmVmX3RpbWUpCiAgICAgICAgICAgICAgICBzZWxmLnJlYWRfZXZlbnRzKCkKCiAg
ICBkZWYgcnVuKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIFN0YXJ0IHRocmVhZCdzIGxvb3A6
IHJlYWQgYW5kIHByb2Nlc3MgZXZlbnRzIHVudGlsIHRoZSBtZXRob2QKICAgICAgICBzdG9wKCkg
aXMgY2FsbGVkLgogICAgICAgIE5ldmVyIGNhbGwgdGhpcyBtZXRob2QgZGlyZWN0bHksIGluc3Rl
YWQgY2FsbCB0aGUgc3RhcnQoKSBtZXRob2QKICAgICAgICBpbmhlcml0ZWQgZnJvbSB0aHJlYWRp
bmcuVGhyZWFkLCB3aGljaCB0aGVuIHdpbGwgY2FsbCBydW4oKSBpbgogICAgICAgIGl0cyB0dXJu
LgogICAgICAgICIiIgogICAgICAgIHNlbGYubG9vcCgpCgoKY2xhc3MgQXN5bmNOb3RpZmllcihh
c3luY29yZS5maWxlX2Rpc3BhdGNoZXIsIE5vdGlmaWVyKToKICAgICIiIgogICAgVGhpcyBub3Rp
ZmllciBpbmhlcml0cyBmcm9tIGFzeW5jb3JlLmZpbGVfZGlzcGF0Y2hlciBpbiBvcmRlciB0byBi
ZSBhYmxlIHRvCiAgICB1c2UgcHlpbm90aWZ5IGFsb25nIHdpdGggdGhlIGFzeW5jb3JlIGZyYW1l
d29yay4KCiAgICAiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB3YXRjaF9tYW5hZ2VyLCBkZWZh
dWx0X3Byb2NfZnVuPU5vbmUsIHJlYWRfZnJlcT0wLAogICAgICAgICAgICAgICAgIHRocmVzaG9s
ZD0wLCB0aW1lb3V0PU5vbmUsIGNoYW5uZWxfbWFwPU5vbmUpOgogICAgICAgICIiIgogICAgICAg
IEluaXRpYWxpemVzIHRoZSBhc3luYyBub3RpZmllci4gVGhlIG9ubHkgYWRkaXRpb25hbCBwYXJh
bWV0ZXIgaXMKICAgICAgICAnY2hhbm5lbF9tYXAnIHdoaWNoIGlzIHRoZSBvcHRpb25hbCBhc3lu
Y29yZSBwcml2YXRlIG1hcC4gU2VlCiAgICAgICAgTm90aWZpZXIgY2xhc3MgZm9yIHRoZSBtZWFu
aW5nIG9mIHRoZSBvdGhlcnMgcGFyYW1ldGVycy4KCiAgICAgICAgIiIiCiAgICAgICAgTm90aWZp
ZXIuX19pbml0X18oc2VsZiwgd2F0Y2hfbWFuYWdlciwgZGVmYXVsdF9wcm9jX2Z1biwgcmVhZF9m
cmVxLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVzaG9sZCwgdGltZW91dCkKICAgICAg
ICBhc3luY29yZS5maWxlX2Rpc3BhdGNoZXIuX19pbml0X18oc2VsZiwgc2VsZi5fZmQsIGNoYW5u
ZWxfbWFwKQoKICAgIGRlZiBoYW5kbGVfcmVhZChzZWxmKToKICAgICAgICAiIiIKICAgICAgICBX
aGVuIGFzeW5jb3JlIHRlbGxzIHVzIHdlIGNhbiByZWFkIGZyb20gdGhlIGZkLCB3ZSBwcm9jZWVk
IHByb2Nlc3NpbmcKICAgICAgICBldmVudHMuIFRoaXMgbWV0aG9kIGNhbiBiZSBvdmVycmlkZGVu
IGZvciBoYW5kbGluZyBhIG5vdGlmaWNhdGlvbgogICAgICAgIGRpZmZlcmVudGx5LgoKICAgICAg
ICAiIiIKICAgICAgICBzZWxmLnJlYWRfZXZlbnRzKCkKICAgICAgICBzZWxmLnByb2Nlc3NfZXZl
bnRzKCkKCgpjbGFzcyBUb3JuYWRvQXN5bmNOb3RpZmllcihOb3RpZmllcik6CiAgICAiIiIKICAg
IFRvcm5hZG8gaW9sb29wIGFkYXB0ZXIuCgogICAgIiIiCiAgICBkZWYgX19pbml0X18oc2VsZiwg
d2F0Y2hfbWFuYWdlciwgaW9sb29wLCBjYWxsYmFjaz1Ob25lLAogICAgICAgICAgICAgICAgIGRl
ZmF1bHRfcHJvY19mdW49Tm9uZSwgcmVhZF9mcmVxPTAsIHRocmVzaG9sZD0wLCB0aW1lb3V0PU5v
bmUsCiAgICAgICAgICAgICAgICAgY2hhbm5lbF9tYXA9Tm9uZSk6CiAgICAgICAgIiIiCiAgICAg
ICAgTm90ZSB0aGF0IGlmIGxhdGVyIHlvdSBtdXN0IGNhbGwgaW9sb29wLmNsb3NlKCkgYmUgc3Vy
ZSB0byBsZXQgdGhlCiAgICAgICAgZGVmYXVsdCBwYXJhbWV0ZXIgdG8gYWxsX2Zkcz1GYWxzZS4K
CiAgICAgICAgU2VlIGV4YW1wbGUgdG9ybmFkb19ub3RpZmllci5weSBmb3IgYW4gZXhhbXBsZSB1
c2luZyB0aGlzIG5vdGlmaWVyLgoKICAgICAgICBAcGFyYW0gaW9sb29wOiBUb3JuYWRvJ3MgSU8g
bG9vcC4KICAgICAgICBAdHlwZSBpb2xvb3A6IHRvcm5hZG8uaW9sb29wLklPTG9vcCBpbnN0YW5j
ZS4KICAgICAgICBAcGFyYW0gY2FsbGJhY2s6IEZ1bmN0b3IgY2FsbGVkIGF0IHRoZSBlbmQgb2Yg
ZWFjaCBjYWxsIHRvIGhhbmRsZV9yZWFkCiAgICAgICAgICAgICAgICAgICAgICAgICAoSU9Mb29w
J3MgcmVhZCBoYW5kbGVyKS4gRXhwZWN0cyB0byByZWNlaXZlIHRoZQogICAgICAgICAgICAgICAg
ICAgICAgICAgbm90aWZpZXIgb2JqZWN0IChzZWxmKSBhcyBzaW5nbGUgcGFyYW1ldGVyLgogICAg
ICAgIEB0eXBlIGNhbGxiYWNrOiBjYWxsYWJsZSBvYmplY3Qgb3IgZnVuY3Rpb24KICAgICAgICAi
IiIKICAgICAgICBzZWxmLmlvX2xvb3AgPSBpb2xvb3AKICAgICAgICBzZWxmLmhhbmRsZV9yZWFk
X2NhbGxiYWNrID0gY2FsbGJhY2sKICAgICAgICBOb3RpZmllci5fX2luaXRfXyhzZWxmLCB3YXRj
aF9tYW5hZ2VyLCBkZWZhdWx0X3Byb2NfZnVuLCByZWFkX2ZyZXEsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgdGhyZXNob2xkLCB0aW1lb3V0KQogICAgICAgIGlvbG9vcC5hZGRfaGFuZGxlcihz
ZWxmLl9mZCwgc2VsZi5oYW5kbGVfcmVhZCwgaW9sb29wLlJFQUQpCgogICAgZGVmIHN0b3Aoc2Vs
Zik6CiAgICAgICAgc2VsZi5pb19sb29wLnJlbW92ZV9oYW5kbGVyKHNlbGYuX2ZkKQogICAgICAg
IE5vdGlmaWVyLnN0b3Aoc2VsZikKCiAgICBkZWYgaGFuZGxlX3JlYWQoc2VsZiwgKmFyZ3MsICoq
a3dhcmdzKToKICAgICAgICAiIiIKICAgICAgICBTZWUgY29tbWVudCBpbiBBc3luY05vdGlmaWVy
LgoKICAgICAgICAiIiIKICAgICAgICBzZWxmLnJlYWRfZXZlbnRzKCkKICAgICAgICBzZWxmLnBy
b2Nlc3NfZXZlbnRzKCkKICAgICAgICBpZiBzZWxmLmhhbmRsZV9yZWFkX2NhbGxiYWNrIGlzIG5v
dCBOb25lOgogICAgICAgICAgICBzZWxmLmhhbmRsZV9yZWFkX2NhbGxiYWNrKHNlbGYpCgoKY2xh
c3MgQXN5bmNpb05vdGlmaWVyKE5vdGlmaWVyKToKICAgICIiIgoKICAgIGFzeW5jaW8vdHJvbGxp
dXMgZXZlbnQgbG9vcCBhZGFwdGVyLgoKICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHdh
dGNoX21hbmFnZXIsIGxvb3AsIGNhbGxiYWNrPU5vbmUsCiAgICAgICAgICAgICAgICAgZGVmYXVs
dF9wcm9jX2Z1bj1Ob25lLCByZWFkX2ZyZXE9MCwgdGhyZXNob2xkPTAsIHRpbWVvdXQ9Tm9uZSk6
CiAgICAgICAgIiIiCgogICAgICAgIFNlZSBleGFtcGxlcy9hc3luY2lvX25vdGlmaWVyLnB5IGZv
ciBhbiBleGFtcGxlIHVzYWdlLgoKICAgICAgICBAcGFyYW0gbG9vcDogYXN5bmNpbyBvciB0cm9s
bGl1cyBldmVudCBsb29wIGluc3RhbmNlLgogICAgICAgIEB0eXBlIGxvb3A6IGFzeW5jaW8uQmFz
ZUV2ZW50TG9vcCBvciB0cm9sbGl1cy5CYXNlRXZlbnRMb29wIGluc3RhbmNlLgogICAgICAgIEBw
YXJhbSBjYWxsYmFjazogRnVuY3RvciBjYWxsZWQgYXQgdGhlIGVuZCBvZiBlYWNoIGNhbGwgdG8g
aGFuZGxlX3JlYWQuCiAgICAgICAgICAgICAgICAgICAgICAgICBFeHBlY3RzIHRvIHJlY2VpdmUg
dGhlIG5vdGlmaWVyIG9iamVjdCAoc2VsZikgYXMKICAgICAgICAgICAgICAgICAgICAgICAgIHNp
bmdsZSBwYXJhbWV0ZXIuCiAgICAgICAgQHR5cGUgY2FsbGJhY2s6IGNhbGxhYmxlIG9iamVjdCBv
ciBmdW5jdGlvbgoKICAgICAgICAiIiIKICAgICAgICBzZWxmLmxvb3AgPSBsb29wCiAgICAgICAg
c2VsZi5oYW5kbGVfcmVhZF9jYWxsYmFjayA9IGNhbGxiYWNrCiAgICAgICAgTm90aWZpZXIuX19p
bml0X18oc2VsZiwgd2F0Y2hfbWFuYWdlciwgZGVmYXVsdF9wcm9jX2Z1biwgcmVhZF9mcmVxLAog
ICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVzaG9sZCwgdGltZW91dCkKICAgICAgICBsb29w
LmFkZF9yZWFkZXIoc2VsZi5fZmQsIHNlbGYuaGFuZGxlX3JlYWQpCgogICAgZGVmIHN0b3Aoc2Vs
Zik6CiAgICAgICAgc2VsZi5sb29wLnJlbW92ZV9yZWFkZXIoc2VsZi5fZmQpCiAgICAgICAgTm90
aWZpZXIuc3RvcChzZWxmKQoKICAgIGRlZiBoYW5kbGVfcmVhZChzZWxmLCAqYXJncywgKiprd2Fy
Z3MpOgogICAgICAgIHNlbGYucmVhZF9ldmVudHMoKQogICAgICAgIHNlbGYucHJvY2Vzc19ldmVu
dHMoKQogICAgICAgIGlmIHNlbGYuaGFuZGxlX3JlYWRfY2FsbGJhY2sgaXMgbm90IE5vbmU6CiAg
ICAgICAgICAgIHNlbGYuaGFuZGxlX3JlYWRfY2FsbGJhY2soc2VsZikKCgpjbGFzcyBXYXRjaDoK
ICAgICIiIgogICAgUmVwcmVzZW50IGEgd2F0Y2gsIGkuZS4gYSBmaWxlIG9yIGRpcmVjdG9yeSBi
ZWluZyB3YXRjaGVkLgoKICAgICIiIgogICAgX19zbG90c19fID0gKCd3ZCcsICdwYXRoJywgJ21h
c2snLCAncHJvY19mdW4nLCAnYXV0b19hZGQnLAogICAgICAgICAgICAgICAgICdleGNsdWRlX2Zp
bHRlcicsICdkaXInKQoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB3ZCwgcGF0aCwgbWFzaywgcHJv
Y19mdW4sIGF1dG9fYWRkLCBleGNsdWRlX2ZpbHRlcik6CiAgICAgICAgIiIiCiAgICAgICAgSW5p
dGlhbGl6YXRpb25zLgoKICAgICAgICBAcGFyYW0gd2Q6IFdhdGNoIGRlc2NyaXB0b3IuCiAgICAg
ICAgQHR5cGUgd2Q6IGludAogICAgICAgIEBwYXJhbSBwYXRoOiBQYXRoIG9mIHRoZSBmaWxlIG9y
IGRpcmVjdG9yeSBiZWluZyB3YXRjaGVkLgogICAgICAgIEB0eXBlIHBhdGg6IHN0cgogICAgICAg
IEBwYXJhbSBtYXNrOiBNYXNrLgogICAgICAgIEB0eXBlIG1hc2s6IGludAogICAgICAgIEBwYXJh
bSBwcm9jX2Z1bjogUHJvY2Vzc2luZyBjYWxsYWJsZSBvYmplY3QuCiAgICAgICAgQHR5cGUgcHJv
Y19mdW46CiAgICAgICAgQHBhcmFtIGF1dG9fYWRkOiBBdXRvbWF0aWNhbGx5IGFkZCB3YXRjaGVz
IG9uIG5ldyBkaXJlY3Rvcmllcy4KICAgICAgICBAdHlwZSBhdXRvX2FkZDogYm9vbAogICAgICAg
IEBwYXJhbSBleGNsdWRlX2ZpbHRlcjogQm9vbGVhbiBmdW5jdGlvbiwgdXNlZCB0byBleGNsdWRl
IG5ldwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0b3JpZXMgZnJvbSBiZWlu
ZyBhdXRvbWF0aWNhbGx5IHdhdGNoZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBT
ZWUgV2F0Y2hNYW5hZ2VyLl9faW5pdF9fCiAgICAgICAgQHR5cGUgZXhjbHVkZV9maWx0ZXI6IGNh
bGxhYmxlIG9iamVjdAogICAgICAgICIiIgogICAgICAgIHNlbGYud2QgPSB3ZAogICAgICAgIHNl
bGYucGF0aCA9IHBhdGgKICAgICAgICBzZWxmLm1hc2sgPSBtYXNrCiAgICAgICAgc2VsZi5wcm9j
X2Z1biA9IHByb2NfZnVuCiAgICAgICAgc2VsZi5hdXRvX2FkZCA9IGF1dG9fYWRkCiAgICAgICAg
c2VsZi5leGNsdWRlX2ZpbHRlciA9IGV4Y2x1ZGVfZmlsdGVyCiAgICAgICAgc2VsZi5kaXIgPSBv
cy5wYXRoLmlzZGlyKHNlbGYucGF0aCkKCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAg
IiIiCiAgICAgICAgQHJldHVybjogU3RyaW5nIHJlcHJlc2VudGF0aW9uLgogICAgICAgIEBydHlw
ZTogc3RyCiAgICAgICAgIiIiCiAgICAgICAgcyA9ICcgJy5qb2luKFsnJXMlcyVzJyAlIChvdXRw
dXRfZm9ybWF0LmZpZWxkX25hbWUoYXR0ciksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBvdXRwdXRfZm9ybWF0LnB1bmN0dWF0aW9uKCc9JyksCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBvdXRwdXRfZm9ybWF0LmZpZWxkX3ZhbHVlKGdldGF0dHIoc2VsZiwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBhdHRyKSkpIFwKICAgICAgICAgICAgICAgICAgICAgIGZvciBhdHRyIGluIHNlbGYu
X19zbG90c19fIGlmIG5vdCBhdHRyLnN0YXJ0c3dpdGgoJ18nKV0pCgogICAgICAgIHMgPSAnJXMl
cyAlcyAlcycgJSAob3V0cHV0X2Zvcm1hdC5wdW5jdHVhdGlvbignPCcpLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgb3V0cHV0X2Zvcm1hdC5jbGFzc19uYW1lKHNlbGYuX19jbGFzc19fLl9f
bmFtZV9fKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBvdXRwdXRfZm9ybWF0LnB1bmN0dWF0aW9uKCc+JykpCiAgICAgICAgcmV0dXJu
IHMKCgpjbGFzcyBFeGNsdWRlRmlsdGVyOgogICAgIiIiCiAgICBFeGNsdWRlRmlsdGVyIGlzIGFu
IGV4Y2x1c2lvbiBmaWx0ZXIuCiAgICAiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBhcmdfbHN0
KToKICAgICAgICAiIiIKICAgICAgICBFeGFtcGxlczoKICAgICAgICAgIGVmMSA9IEV4Y2x1ZGVG
aWx0ZXIoWyIvZXRjL3JjLioiLCAiL2V0Yy9ob3N0bmFtZSJdKQogICAgICAgICAgZWYyID0gRXhj
bHVkZUZpbHRlcigiL215L3BhdGgvZXhjbHVkZS5sc3QiKQogICAgICAgICAgV2hlcmUgZXhjbHVk
ZS5sc3QgY29udGFpbnM6CiAgICAgICAgICAvZXRjL3JjLioKICAgICAgICAgIC9ldGMvaG9zdG5h
bWUKCiAgICAgICAgTm90ZTogaXQgaXMgbm90IHBvc3NpYmxlIHRvIGV4Y2x1ZGUgYSBmaWxlIGlm
IGl0cyBlbmNhcHN1bGF0aW5nCiAgICAgICAgICAgICAgZGlyZWN0b3J5IGlzIGl0c2VsZiB3YXRj
aGVkLiBTZWUgdGhpcyBpc3N1ZSBmb3IgbW9yZSBkZXRhaWxzCiAgICAgICAgICAgICAgaHR0cHM6
Ly9naXRodWIuY29tL3NlYi1tL3B5aW5vdGlmeS9pc3N1ZXMvMzEKCiAgICAgICAgQHBhcmFtIGFy
Z19sc3Q6IGlzIGVpdGhlciBhIGxpc3Qgb2YgcGF0dGVybnMgb3IgYSBmaWxlbmFtZSBmcm9tIHdo
aWNoCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm5zIHdpbGwgYmUgbG9hZGVkLgogICAg
ICAgIEB0eXBlIGFyZ19sc3Q6IGxpc3Qgb2Ygc3RyIG9yIHN0cgogICAgICAgICIiIgogICAgICAg
IGlmIGlzaW5zdGFuY2UoYXJnX2xzdCwgc3RyKToKICAgICAgICAgICAgbHN0ID0gc2VsZi5fbG9h
ZF9wYXR0ZXJuc19mcm9tX2ZpbGUoYXJnX2xzdCkKICAgICAgICBlbGlmIGlzaW5zdGFuY2UoYXJn
X2xzdCwgbGlzdCk6CiAgICAgICAgICAgIGxzdCA9IGFyZ19sc3QKICAgICAgICBlbHNlOgogICAg
ICAgICAgICByYWlzZSBUeXBlRXJyb3IKCiAgICAgICAgc2VsZi5fbHJlZ2V4ID0gW10KICAgICAg
ICBmb3IgcmVnZXggaW4gbHN0OgogICAgICAgICAgICBzZWxmLl9scmVnZXguYXBwZW5kKHJlLmNv
bXBpbGUocmVnZXgsIHJlLlVOSUNPREUpKQoKICAgIGRlZiBfbG9hZF9wYXR0ZXJuc19mcm9tX2Zp
bGUoc2VsZiwgZmlsZW5hbWUpOgogICAgICAgIGxzdCA9IFtdCiAgICAgICAgZmlsZV9vYmogPSBm
aWxlKGZpbGVuYW1lLCAncicpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmb3IgbGluZSBpbiBm
aWxlX29iai5yZWFkbGluZXMoKToKICAgICAgICAgICAgICAgICMgVHJpbSBsZWFkaW5nIGFuIHRy
YWlsaW5nIHdoaXRlc3BhY2VzCiAgICAgICAgICAgICAgICBwYXR0ZXJuID0gbGluZS5zdHJpcCgp
CiAgICAgICAgICAgICAgICBpZiBub3QgcGF0dGVybiBvciBwYXR0ZXJuLnN0YXJ0c3dpdGgoJyMn
KToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgbHN0LmFwcGVu
ZChwYXR0ZXJuKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIGZpbGVfb2JqLmNsb3NlKCkK
ICAgICAgICByZXR1cm4gbHN0CgogICAgZGVmIF9tYXRjaChzZWxmLCByZWdleCwgcGF0aCk6CiAg
ICAgICAgcmV0dXJuIHJlZ2V4Lm1hdGNoKHBhdGgpIGlzIG5vdCBOb25lCgogICAgZGVmIF9fY2Fs
bF9fKHNlbGYsIHBhdGgpOgogICAgICAgICIiIgogICAgICAgIEBwYXJhbSBwYXRoOiBQYXRoIHRv
IG1hdGNoIGFnYWluc3QgcHJvdmlkZWQgcmVnZXhwcy4KICAgICAgICBAdHlwZSBwYXRoOiBzdHIK
ICAgICAgICBAcmV0dXJuOiBSZXR1cm4gVHJ1ZSBpZiBwYXRoIGhhcyBiZWVuIG1hdGNoZWQgYW5k
IHNob3VsZAogICAgICAgICAgICAgICAgIGJlIGV4Y2x1ZGVkLCBGYWxzZSBvdGhlcndpc2UuCiAg
ICAgICAgQHJ0eXBlOiBib29sCiAgICAgICAgIiIiCiAgICAgICAgZm9yIHJlZ2V4IGluIHNlbGYu
X2xyZWdleDoKICAgICAgICAgICAgaWYgc2VsZi5fbWF0Y2gocmVnZXgsIHBhdGgpOgogICAgICAg
ICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICByZXR1cm4gRmFsc2UKCgpjbGFzcyBXYXRjaE1h
bmFnZXJFcnJvcihFeGNlcHRpb24pOgogICAgIiIiCiAgICBXYXRjaE1hbmFnZXIgRXhjZXB0aW9u
LiBSYWlzZWQgb24gZXJyb3IgZW5jb3VudGVyZWQgb24gd2F0Y2hlcwogICAgb3BlcmF0aW9ucy4K
ICAgICIiIgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG1zZywgd21kKToKICAgICAgICAiIiIKICAg
ICAgICBAcGFyYW0gbXNnOiBFeGNlcHRpb24gc3RyaW5nJ3MgZGVzY3JpcHRpb24uCiAgICAgICAg
QHR5cGUgbXNnOiBzdHJpbmcKICAgICAgICBAcGFyYW0gd21kOiBUaGlzIGRpY3Rpb25hcnkgY29u
dGFpbnMgdGhlIHdkIGFzc2lnbmVkIHRvIHBhdGhzIG9mIHRoZQogICAgICAgICAgICAgICAgICAg
IHNhbWUgY2FsbCBmb3Igd2hpY2ggd2F0Y2hlcyB3ZXJlIHN1Y2Nlc3NmdWxseSBhZGRlZC4KICAg
ICAgICBAdHlwZSB3bWQ6IGRpY3QKICAgICAgICAiIiIKICAgICAgICBzZWxmLndtZCA9IHdtZAog
ICAgICAgIEV4Y2VwdGlvbi5fX2luaXRfXyhzZWxmLCBtc2cpCgoKY2xhc3MgV2F0Y2hNYW5hZ2Vy
OgogICAgIiIiCiAgICBQcm92aWRlIG9wZXJhdGlvbnMgZm9yIHdhdGNoaW5nIGZpbGVzIGFuZCBk
aXJlY3Rvcmllcy4gSXRzIGludGVybmFsCiAgICBkaWN0aW9uYXJ5IGlzIHVzZWQgdG8gcmVmZXJl
bmNlIHdhdGNoZWQgaXRlbXMuIFdoZW4gdXNlZCBpbnNpZGUKICAgIHRocmVhZGVkIGNvZGUsIG9u
ZSBtdXN0IGluc3RhbmNpYXRlIGFzIG1hbnkgV2F0Y2hNYW5hZ2VyIGluc3RhbmNlcyBhcwogICAg
dGhlcmUgYXJlIFRocmVhZGVkTm90aWZpZXIgaW5zdGFuY2VzLgoKICAgICIiIgogICAgZGVmIF9f
aW5pdF9fKHNlbGYsIGV4Y2x1ZGVfZmlsdGVyPWxhbWJkYSBwYXRoOiBGYWxzZSk6CiAgICAgICAg
IiIiCiAgICAgICAgSW5pdGlhbGl6YXRpb246IGluaXQgaW5vdGlmeSwgaW5pdCB3YXRjaCBtYW5h
Z2VyIGRpY3Rpb25hcnkuCiAgICAgICAgUmFpc2UgT1NFcnJvciBpZiBpbml0aWFsaXphdGlvbiBm
YWlscywgcmFpc2UgSW5vdGlmeUJpbmRpbmdOb3RGb3VuZEVycm9yCiAgICAgICAgaWYgbm8gaW5v
dGlmeSBiaW5kaW5nIHdhcyBmb3VuZCAodGhyb3VnaCBjdHlwZXMgb3IgZnJvbSBkaXJlY3QgYWNj
ZXNzIHRvCiAgICAgICAgc3lzY2FsbHMpLgoKICAgICAgICBAcGFyYW0gZXhjbHVkZV9maWx0ZXI6
IGJvb2xlYW4gZnVuY3Rpb24sIHJldHVybnMgVHJ1ZSBpZiBjdXJyZW50CiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBwYXRoIG11c3QgYmUgZXhjbHVkZWQgZnJvbSBiZWluZyB3YXRjaGVk
LgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29udmVuaWVudCBmb3IgcHJvdmlkaW5n
IGEgY29tbW9uIGV4Y2x1c2lvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVy
IGZvciBldmVyeSBjYWxsIHRvIGFkZF93YXRjaC4KICAgICAgICBAdHlwZSBleGNsdWRlX2ZpbHRl
cjogY2FsbGFibGUgb2JqZWN0CiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5faWdub3JlX2V2ZW50
cyA9IEZhbHNlCiAgICAgICAgc2VsZi5fZXhjbHVkZV9maWx0ZXIgPSBleGNsdWRlX2ZpbHRlcgog
ICAgICAgIHNlbGYuX3dtZCA9IHt9ICAjIHdhdGNoIGRpY3Qga2V5OiB3YXRjaCBkZXNjcmlwdG9y
LCB2YWx1ZTogd2F0Y2gKCiAgICAgICAgc2VsZi5faW5vdGlmeV93cmFwcGVyID0gSU5vdGlmeVdy
YXBwZXIuY3JlYXRlKCkKICAgICAgICBpZiBzZWxmLl9pbm90aWZ5X3dyYXBwZXIgaXMgTm9uZToK
ICAgICAgICAgICAgcmFpc2UgSW5vdGlmeUJpbmRpbmdOb3RGb3VuZEVycm9yKCkKCiAgICAgICAg
c2VsZi5fZmQgPSBzZWxmLl9pbm90aWZ5X3dyYXBwZXIuaW5vdGlmeV9pbml0KCkgIyBmaWxlIGRl
c2NyaXB0b3IKICAgICAgICBpZiBzZWxmLl9mZCA8IDA6CiAgICAgICAgICAgIGVyciA9ICdDYW5u
b3QgaW5pdGlhbGl6ZSBuZXcgaW5zdGFuY2Ugb2YgaW5vdGlmeSwgJXMnCiAgICAgICAgICAgIHJh
aXNlIE9TRXJyb3IoZXJyICUgc2VsZi5faW5vdGlmeV93cmFwcGVyLnN0cl9lcnJubygpKQoKICAg
IGRlZiBjbG9zZShzZWxmKToKICAgICAgICAiIiIKICAgICAgICBDbG9zZSBpbm90aWZ5J3MgZmls
ZSBkZXNjcmlwdG9yLCB0aGlzIGFjdGlvbiB3aWxsIGFsc28gYXV0b21hdGljYWxseQogICAgICAg
IHJlbW92ZSAoaS5lLiBzdG9wIHdhdGNoaW5nKSBhbGwgaXRzIGFzc29jaWF0ZWQgd2F0Y2ggZGVz
Y3JpcHRvcnMuCiAgICAgICAgQWZ0ZXIgYSBjYWxsIHRvIHRoaXMgbWV0aG9kIHRoZSBXYXRjaE1h
bmFnZXIncyBpbnN0YW5jZSBiZWNvbWUgdXNlbGVzcwogICAgICAgIGFuZCBjYW5ub3QgYmUgcmV1
c2VkLCBhIG5ldyBpbnN0YW5jZSBtdXN0IHRoZW4gYmUgaW5zdGFuY2lhdGVkLiBJdAogICAgICAg
IG1ha2VzIHNlbnNlIHRvIGNhbGwgdGhpcyBtZXRob2QgaW4gZmV3IHNpdHVhdGlvbnMgZm9yIGlu
c3RhbmNlIGlmCiAgICAgICAgc2V2ZXJhbCBpbmRlcGVuZGFudCBXYXRjaE1hbmFnZXIgbXVzdCBi
ZSBpbnN0YW5jaWF0ZWQgb3IgaWYgYWxsIHdhdGNoZXMKICAgICAgICBtdXN0IGJlIHJlbW92ZWQg
YW5kIG5vIG90aGVyIHdhdGNoZXMgbmVlZCB0byBiZSBhZGRlZC4KICAgICAgICAiIiIKICAgICAg
ICBvcy5jbG9zZShzZWxmLl9mZCkKCiAgICBkZWYgZ2V0X2ZkKHNlbGYpOgogICAgICAgICIiIgog
ICAgICAgIFJldHVybiBhc3NpZ25lZCBpbm90aWZ5J3MgZmlsZSBkZXNjcmlwdG9yLgoKICAgICAg
ICBAcmV0dXJuOiBGaWxlIGRlc2NyaXB0b3IuCiAgICAgICAgQHJ0eXBlOiBpbnQKICAgICAgICAi
IiIKICAgICAgICByZXR1cm4gc2VsZi5fZmQKCiAgICBkZWYgZ2V0X3dhdGNoKHNlbGYsIHdkKToK
ICAgICAgICAiIiIKICAgICAgICBHZXQgd2F0Y2ggZnJvbSBwcm92aWRlZCB3YXRjaCBkZXNjcmlw
dG9yIHdkLgoKICAgICAgICBAcGFyYW0gd2Q6IFdhdGNoIGRlc2NyaXB0b3IuCiAgICAgICAgQHR5
cGUgd2Q6IGludAogICAgICAgICIiIgogICAgICAgIHJldHVybiBzZWxmLl93bWQuZ2V0KHdkKQoK
ICAgIGRlZiBkZWxfd2F0Y2goc2VsZiwgd2QpOgogICAgICAgICIiIgogICAgICAgIFJlbW92ZSB3
YXRjaCBlbnRyeSBhc3NvY2lhdGVkIHRvIHdhdGNoIGRlc2NyaXB0b3Igd2QuCgogICAgICAgIEBw
YXJhbSB3ZDogV2F0Y2ggZGVzY3JpcHRvci4KICAgICAgICBAdHlwZSB3ZDogaW50CiAgICAgICAg
IiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBkZWwgc2VsZi5fd21kW3dkXQogICAgICAgIGV4
Y2VwdCBLZXlFcnJvciwgZXJyOgogICAgICAgICAgICBsb2cuZXJyb3IoJ0Nhbm5vdCBkZWxldGUg
dW5rbm93biB3YXRjaCBkZXNjcmlwdG9yICVzJyAlIHN0cihlcnIpKQoKICAgIEBwcm9wZXJ0eQog
ICAgZGVmIHdhdGNoZXMoc2VsZik6CiAgICAgICAgIiIiCiAgICAgICAgR2V0IGEgcmVmZXJlbmNl
IG9uIHRoZSBpbnRlcm5hbCB3YXRjaCBtYW5hZ2VyIGRpY3Rpb25hcnkuCgogICAgICAgIEByZXR1
cm46IEludGVybmFsIHdhdGNoIG1hbmFnZXIgZGljdGlvbmFyeS4KICAgICAgICBAcnR5cGU6IGRp
Y3QKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gc2VsZi5fd21kCgogICAgZGVmIF9fZm9ybWF0
X3BhdGgoc2VsZiwgcGF0aCk6CiAgICAgICAgIiIiCiAgICAgICAgRm9ybWF0IHBhdGggdG8gaXRz
IGludGVybmFsIChzdG9yZWQgaW4gd2F0Y2ggbWFuYWdlcikgcmVwcmVzZW50YXRpb24uCiAgICAg
ICAgIiIiCiAgICAgICAgIyBVbmljb2RlIHN0cmluZ3MgYXJlIGNvbnZlcnRlZCBiYWNrIHRvIHN0
cmluZ3MsIGJlY2F1c2UgaXQgc2VlbXMKICAgICAgICAjIHRoYXQgaW5vdGlmeV9hZGRfd2F0Y2gg
ZnJvbSBjdHlwZXMgZG9lcyBub3Qgd29yayB3ZWxsIHdoZW4KICAgICAgICAjIGl0IHJlY2VpdmVz
IGFuIGN0eXBlcy5jcmVhdGVfdW5pY29kZV9idWZmZXIgaW5zdGFuY2UgYXMgYXJndW1lbnQuCiAg
ICAgICAgIyBUaGVyZWZvcmUgZXZlbiB3ZCBhcmUgaW5kZXhlZCB3aXRoIGJ5dGVzIHN0cmluZyBh
bmQgbm90IHdpdGgKICAgICAgICAjIHVuaWNvZGUgcGF0aHMuCiAgICAgICAgaWYgaXNpbnN0YW5j
ZShwYXRoLCB1bmljb2RlKToKICAgICAgICAgICAgcGF0aCA9IHBhdGguZW5jb2RlKHN5cy5nZXRm
aWxlc3lzdGVtZW5jb2RpbmcoKSkKICAgICAgICByZXR1cm4gb3MucGF0aC5ub3JtcGF0aChwYXRo
KQoKICAgIGRlZiBfX2FkZF93YXRjaChzZWxmLCBwYXRoLCBtYXNrLCBwcm9jX2Z1biwgYXV0b19h
ZGQsIGV4Y2x1ZGVfZmlsdGVyKToKICAgICAgICAiIiIKICAgICAgICBBZGQgYSB3YXRjaCBvbiBw
YXRoLCBidWlsZCBhIFdhdGNoIG9iamVjdCBhbmQgaW5zZXJ0IGl0IGluIHRoZQogICAgICAgIHdh
dGNoIG1hbmFnZXIgZGljdGlvbmFyeS4gUmV0dXJuIHRoZSB3ZCB2YWx1ZS4KICAgICAgICAiIiIK
ICAgICAgICBwYXRoID0gc2VsZi5fX2Zvcm1hdF9wYXRoKHBhdGgpCiAgICAgICAgaWYgYXV0b19h
ZGQgYW5kIG5vdCBtYXNrICYgSU5fQ1JFQVRFOgogICAgICAgICAgICBtYXNrIHw9IElOX0NSRUFU
RQogICAgICAgIHdkID0gc2VsZi5faW5vdGlmeV93cmFwcGVyLmlub3RpZnlfYWRkX3dhdGNoKHNl
bGYuX2ZkLCBwYXRoLCBtYXNrKQogICAgICAgIGlmIHdkIDwgMDoKICAgICAgICAgICAgcmV0dXJu
IHdkCiAgICAgICAgd2F0Y2ggPSBXYXRjaCh3ZD13ZCwgcGF0aD1wYXRoLCBtYXNrPW1hc2ssIHBy
b2NfZnVuPXByb2NfZnVuLAogICAgICAgICAgICAgICAgICAgICAgYXV0b19hZGQ9YXV0b19hZGQs
IGV4Y2x1ZGVfZmlsdGVyPWV4Y2x1ZGVfZmlsdGVyKQogICAgICAgICMgd2QgYXJlIF9hbHdheXNf
IGluZGV4ZWQgd2l0aCB0aGVpciBvcmlnaW5hbCB1bmljb2RlIHBhdGhzIGluIHdtZC4KICAgICAg
ICBzZWxmLl93bWRbd2RdID0gd2F0Y2gKICAgICAgICBsb2cuZGVidWcoJ05ldyAlcycsIHdhdGNo
KQogICAgICAgIHJldHVybiB3ZAoKICAgIGRlZiBfX2dsb2Ioc2VsZiwgcGF0aCwgZG9fZ2xvYik6
CiAgICAgICAgaWYgZG9fZ2xvYjoKICAgICAgICAgICAgcmV0dXJuIGdsb2IocGF0aCkKICAgICAg
ICBlbHNlOgogICAgICAgICAgICByZXR1cm4gW3BhdGhdCgogICAgZGVmIGFkZF93YXRjaChzZWxm
LCBwYXRoLCBtYXNrLCBwcm9jX2Z1bj1Ob25lLCByZWM9RmFsc2UsCiAgICAgICAgICAgICAgICAg
IGF1dG9fYWRkPUZhbHNlLCBkb19nbG9iPUZhbHNlLCBxdWlldD1UcnVlLAogICAgICAgICAgICAg
ICAgICBleGNsdWRlX2ZpbHRlcj1Ob25lKToKICAgICAgICAiIiIKICAgICAgICBBZGQgd2F0Y2go
cykgb24gdGhlIHByb3ZpZGVkIHxwYXRofChzKSB3aXRoIGFzc29jaWF0ZWQgfG1hc2t8IGZsYWcK
ICAgICAgICB2YWx1ZSBhbmQgb3B0aW9uYWxseSB3aXRoIGEgcHJvY2Vzc2luZyB8cHJvY19mdW58
IGZ1bmN0aW9uIGFuZAogICAgICAgIHJlY3Vyc2l2ZSBmbGFnIHxyZWN8IHNldCB0byBUcnVlLgog
ICAgICAgIElkZWFsbHkgfHBhdGh8IGNvbXBvbmVudHMgc2hvdWxkIG5vdCBiZSB1bmljb2RlIG9i
amVjdHMuIE5vdGUgdGhhdAogICAgICAgIGFsdGhvdWdoIHVuaWNvZGUgcGF0aHMgYXJlIGFjY2Vw
dGVkIHRoZXJlIGFyZSBjb252ZXJ0ZWQgdG8gYnl0ZQogICAgICAgIHN0cmluZ3MgYmVmb3JlIGEg
d2F0Y2ggaXMgcHV0IG9uIHRoYXQgcGF0aC4gVGhlIGVuY29kaW5nIHVzZWQgZm9yCiAgICAgICAg
Y29udmVydGluZyB0aGUgdW5pY29kZSBvYmplY3QgaXMgZ2l2ZW4gYnkgc3lzLmdldGZpbGVzeXN0
ZW1lbmNvZGluZygpLgogICAgICAgIElmIHxwYXRofCBpcyBhbHJlYWR5IHdhdGNoZWQgaXQgaXMg
aWdub3JlZCwgYnV0IGlmIGl0IGlzIGNhbGxlZCB3aXRoCiAgICAgICAgb3B0aW9uIHJlYz1UcnVl
IGEgd2F0Y2ggaXMgcHV0IG9uIGVhY2ggb25lIG9mIGl0cyBub3Qtd2F0Y2hlZAogICAgICAgIHN1
YmRpcmVjdG9yeS4KCiAgICAgICAgQHBhcmFtIHBhdGg6IFBhdGggdG8gd2F0Y2gsIHRoZSBwYXRo
IGNhbiBlaXRoZXIgYmUgYSBmaWxlIG9yIGEKICAgICAgICAgICAgICAgICAgICAgZGlyZWN0b3J5
LiBBbHNvIGFjY2VwdHMgYSBzZXF1ZW5jZSAobGlzdCkgb2YgcGF0aHMuCiAgICAgICAgQHR5cGUg
cGF0aDogc3RyaW5nIG9yIGxpc3Qgb2Ygc3RyaW5ncwogICAgICAgIEBwYXJhbSBtYXNrOiBCaXRt
YXNrIG9mIGV2ZW50cy4KICAgICAgICBAdHlwZSBtYXNrOiBpbnQKICAgICAgICBAcGFyYW0gcHJv
Y19mdW46IFByb2Nlc3Npbmcgb2JqZWN0LgogICAgICAgIEB0eXBlIHByb2NfZnVuOiBmdW5jdGlv
biBvciBQcm9jZXNzRXZlbnQgaW5zdGFuY2Ugb3IgaW5zdGFuY2Ugb2YKICAgICAgICAgICAgICAg
ICAgICAgICAgb25lIG9mIGl0cyBzdWJjbGFzc2VzIG9yIGNhbGxhYmxlIG9iamVjdC4KICAgICAg
ICBAcGFyYW0gcmVjOiBSZWN1cnNpdmVseSBhZGQgd2F0Y2hlcyBmcm9tIHBhdGggb24gYWxsIGl0
cwogICAgICAgICAgICAgICAgICAgIHN1YmRpcmVjdG9yaWVzLCBzZXQgdG8gRmFsc2UgYnkgZGVm
YXVsdCAoZG9lc24ndAogICAgICAgICAgICAgICAgICAgIGZvbGxvd3Mgc3ltbGlua3MgaW4gYW55
IGNhc2UpLgogICAgICAgIEB0eXBlIHJlYzogYm9vbAogICAgICAgIEBwYXJhbSBhdXRvX2FkZDog
QXV0b21hdGljYWxseSBhZGQgd2F0Y2hlcyBvbiBuZXdseSBjcmVhdGVkCiAgICAgICAgICAgICAg
ICAgICAgICAgICBkaXJlY3RvcmllcyBpbiB3YXRjaGVkIHBhcmVudCB8cGF0aHwgZGlyZWN0b3J5
LgogICAgICAgICAgICAgICAgICAgICAgICAgSWYgfGF1dG9fYWRkfCBpcyBUcnVlLCBJTl9DUkVB
VEUgaXMgb3JlZCB3aXRoIHxtYXNrfAogICAgICAgICAgICAgICAgICAgICAgICAgd2hlbiB0aGUg
d2F0Y2ggaXMgYWRkZWQuCiAgICAgICAgQHR5cGUgYXV0b19hZGQ6IGJvb2wKICAgICAgICBAcGFy
YW0gZG9fZ2xvYjogRG8gZ2xvYmJpbmcgb24gcGF0aG5hbWUgKHNlZSBzdGFuZGFyZCBnbG9iYmlu
ZwogICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUgZm9yIG1vcmUgaW5mb3JtYXRpb25zKS4K
ICAgICAgICBAdHlwZSBkb19nbG9iOiBib29sCiAgICAgICAgQHBhcmFtIHF1aWV0OiBpZiBGYWxz
ZSByYWlzZXMgYSBXYXRjaE1hbmFnZXJFcnJvciBleGNlcHRpb24gb24KICAgICAgICAgICAgICAg
ICAgICAgIGVycm9yLiBTZWUgZXhhbXBsZSBub3RfcXVpZXQucHkuCiAgICAgICAgQHR5cGUgcXVp
ZXQ6IGJvb2wKICAgICAgICBAcGFyYW0gZXhjbHVkZV9maWx0ZXI6IHByZWRpY2F0ZSAoYm9vbGVh
biBmdW5jdGlvbiksIHdoaWNoIHJldHVybnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFRydWUgaWYgdGhlIGN1cnJlbnQgcGF0aCBtdXN0IGJlIGV4Y2x1ZGVkCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBmcm9tIGJlaW5nIHdhdGNoZWQuIFRoaXMgYXJndW1lbnQgaGFzCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVjZWRlbmNlIG92ZXIgZXhjbHVkZV9maWx0
ZXIgcGFzc2VkIHRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgY2xhc3MnIGNv
bnN0cnVjdG9yLgogICAgICAgIEB0eXBlIGV4Y2x1ZGVfZmlsdGVyOiBjYWxsYWJsZSBvYmplY3QK
ICAgICAgICBAcmV0dXJuOiBkaWN0IG9mIHBhdGhzIGFzc29jaWF0ZWQgdG8gd2F0Y2ggZGVzY3Jp
cHRvcnMuIEEgd2QgdmFsdWUKICAgICAgICAgICAgICAgICBpcyBwb3NpdGl2ZSBpZiB0aGUgd2F0
Y2ggd2FzIGFkZGVkIHN1Y2Vzc2Z1bGx5LCBvdGhlcndpc2UKICAgICAgICAgICAgICAgICB0aGUg
dmFsdWUgaXMgbmVnYXRpdmUuIElmIHRoZSBwYXRoIHdhcyBpbnZhbGlkIG9yIHdhcyBhbHJlYWR5
CiAgICAgICAgICAgICAgICAgd2F0Y2hlZCBpdCBpcyBub3QgaW5jbHVkZWQgaW50byB0aGlzIHJl
dHVybmVkIGRpY3Rpb25hcnkuCiAgICAgICAgQHJ0eXBlOiBkaWN0IG9mIHtzdHI6IGludH0KICAg
ICAgICAiIiIKICAgICAgICByZXRfID0ge30gIyByZXR1cm4ge3BhdGg6IHdkLCAuLi59CgogICAg
ICAgIGlmIGV4Y2x1ZGVfZmlsdGVyIGlzIE5vbmU6CiAgICAgICAgICAgIGV4Y2x1ZGVfZmlsdGVy
ID0gc2VsZi5fZXhjbHVkZV9maWx0ZXIKCiAgICAgICAgIyBub3JtYWxpemUgYXJncyBhcyBsaXN0
IGVsZW1lbnRzCiAgICAgICAgZm9yIG5wYXRoIGluIHNlbGYuX19mb3JtYXRfcGFyYW0ocGF0aCk6
CiAgICAgICAgICAgICMgdW5peCBwYXRobmFtZSBwYXR0ZXJuIGV4cGFuc2lvbgogICAgICAgICAg
ICBmb3IgYXBhdGggaW4gc2VsZi5fX2dsb2IobnBhdGgsIGRvX2dsb2IpOgogICAgICAgICAgICAg
ICAgIyByZWN1cnNpdmVseSBsaXN0IHN1YmRpcnMgYWNjb3JkaW5nIHRvIHJlYyBwYXJhbQogICAg
ICAgICAgICAgICAgZm9yIHJwYXRoIGluIHNlbGYuX193YWxrX3JlYyhhcGF0aCwgcmVjKToKICAg
ICAgICAgICAgICAgICAgICBpZiBub3QgZXhjbHVkZV9maWx0ZXIocnBhdGgpOgogICAgICAgICAg
ICAgICAgICAgICAgICB3ZCA9IHJldF9bcnBhdGhdID0gc2VsZi5fX2FkZF93YXRjaChycGF0aCwg
bWFzaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcHJvY19mdW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGF1dG9fYWRkLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNsdWRlX2ZpbHRlcikKICAgICAg
ICAgICAgICAgICAgICAgICAgaWYgd2QgPCAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ZXJyID0gKCdhZGRfd2F0Y2g6IGNhbm5vdCB3YXRjaCAlcyBXRD0lZCwgJXMnICUgXAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocnBhdGgsIHdkLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5faW5vdGlmeV93cmFwcGVyLnN0cl9lcnJu
bygpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHF1aWV0OgogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGxvZy5lcnJvcihlcnIpCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIFdhdGNoTWFu
YWdlckVycm9yKGVyciwgcmV0XykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAg
ICAgICAgICAgICAgICAjIExldCdzIHNheSAtMiBtZWFucyAnZXhwbGljaXRlbHkgZXhjbHVkZWQK
ICAgICAgICAgICAgICAgICAgICAgICAgIyBmcm9tIHdhdGNoaW5nJy4KICAgICAgICAgICAgICAg
ICAgICAgICAgcmV0X1tycGF0aF0gPSAtMgogICAgICAgIHJldHVybiByZXRfCgogICAgZGVmIF9f
Z2V0X3N1Yl9yZWMoc2VsZiwgbHBhdGgpOgogICAgICAgICIiIgogICAgICAgIEdldCBldmVyeSB3
ZCBmcm9tIHNlbGYuX3dtZCBpZiBpdHMgcGF0aCBpcyB1bmRlciB0aGUgcGF0aCBvZgogICAgICAg
IG9uZSAoYXQgbGVhc3QpIG9mIHRob3NlIGluIGxwYXRoLiBEb2Vzbid0IGZvbGxvdyBzeW1saW5r
cy4KCiAgICAgICAgQHBhcmFtIGxwYXRoOiBsaXN0IG9mIHdhdGNoIGRlc2NyaXB0b3IKICAgICAg
ICBAdHlwZSBscGF0aDogbGlzdCBvZiBpbnQKICAgICAgICBAcmV0dXJuOiBsaXN0IG9mIHdhdGNo
IGRlc2NyaXB0b3IKICAgICAgICBAcnR5cGU6IGxpc3Qgb2YgaW50CiAgICAgICAgIiIiCiAgICAg
ICAgZm9yIGQgaW4gbHBhdGg6CiAgICAgICAgICAgIHJvb3QgPSBzZWxmLmdldF9wYXRoKGQpCiAg
ICAgICAgICAgIGlmIHJvb3QgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAjIGFsd2F5cyBr
ZWVwIHJvb3QKICAgICAgICAgICAgICAgIHlpZWxkIGQKICAgICAgICAgICAgZWxzZToKICAgICAg
ICAgICAgICAgICMgaWYgaW52YWxpZAogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAg
ICAgICMgbm90aGluZyBlbHNlIHRvIGV4cGVjdAogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5p
c2Rpcihyb290KToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAjIG5vcm1h
bGl6YXRpb24KICAgICAgICAgICAgcm9vdCA9IG9zLnBhdGgubm9ybXBhdGgocm9vdCkKICAgICAg
ICAgICAgIyByZWN1cnNpb24KICAgICAgICAgICAgbGVuZCA9IGxlbihyb290KQogICAgICAgICAg
ICBmb3IgaXdkIGluIHNlbGYuX3dtZC5pdGVtcygpOgogICAgICAgICAgICAgICAgY3VyID0gaXdk
WzFdLnBhdGgKICAgICAgICAgICAgICAgIHByZWYgPSBvcy5wYXRoLmNvbW1vbnByZWZpeChbcm9v
dCwgY3VyXSkKICAgICAgICAgICAgICAgIGlmIHJvb3QgPT0gb3Muc2VwIG9yIChsZW4ocHJlZikg
PT0gbGVuZCBhbmQgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbihj
dXIpID4gbGVuZCBhbmQgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1
cltsZW5kXSA9PSBvcy5zZXApOgogICAgICAgICAgICAgICAgICAgIHlpZWxkIGl3ZFsxXS53ZAoK
ICAgIGRlZiB1cGRhdGVfd2F0Y2goc2VsZiwgd2QsIG1hc2s9Tm9uZSwgcHJvY19mdW49Tm9uZSwg
cmVjPUZhbHNlLAogICAgICAgICAgICAgICAgICAgICBhdXRvX2FkZD1GYWxzZSwgcXVpZXQ9VHJ1
ZSk6CiAgICAgICAgIiIiCiAgICAgICAgVXBkYXRlIGV4aXN0aW5nIHdhdGNoIGRlc2NyaXB0b3Jz
IHx3ZHwuIFRoZSB8bWFza3wgdmFsdWUsIHRoZQogICAgICAgIHByb2Nlc3Npbmcgb2JqZWN0IHxw
cm9jX2Z1bnwsIHRoZSByZWN1cnNpdmUgcGFyYW0gfHJlY3wgYW5kIHRoZQogICAgICAgIHxhdXRv
X2FkZHwgYW5kIHxxdWlldHwgZmxhZ3MgY2FuIGFsbCBiZSB1cGRhdGVkLgoKICAgICAgICBAcGFy
YW0gd2Q6IFdhdGNoIERlc2NyaXB0b3IgdG8gdXBkYXRlLiBBbHNvIGFjY2VwdHMgYSBsaXN0IG9m
CiAgICAgICAgICAgICAgICAgICB3YXRjaCBkZXNjcmlwdG9ycy4KICAgICAgICBAdHlwZSB3ZDog
aW50IG9yIGxpc3Qgb2YgaW50CiAgICAgICAgQHBhcmFtIG1hc2s6IE9wdGlvbmFsIG5ldyBiaXRt
YXNrIG9mIGV2ZW50cy4KICAgICAgICBAdHlwZSBtYXNrOiBpbnQKICAgICAgICBAcGFyYW0gcHJv
Y19mdW46IE9wdGlvbmFsIG5ldyBwcm9jZXNzaW5nIGZ1bmN0aW9uLgogICAgICAgIEB0eXBlIHBy
b2NfZnVuOiBmdW5jdGlvbiBvciBQcm9jZXNzRXZlbnQgaW5zdGFuY2Ugb3IgaW5zdGFuY2Ugb2YK
ICAgICAgICAgICAgICAgICAgICAgICAgb25lIG9mIGl0cyBzdWJjbGFzc2VzIG9yIGNhbGxhYmxl
IG9iamVjdC4KICAgICAgICBAcGFyYW0gcmVjOiBPcHRpb25hbGx5IGFkZHMgd2F0Y2hlcyByZWN1
cnNpdmVseSBvbiBhbGwKICAgICAgICAgICAgICAgICAgICBzdWJkaXJlY3RvcmllcyBjb250YWlu
ZWQgaW50byB8d2R8IGRpcmVjdG9yeS4KICAgICAgICBAdHlwZSByZWM6IGJvb2wKICAgICAgICBA
cGFyYW0gYXV0b19hZGQ6IEF1dG9tYXRpY2FsbHkgYWRkcyB3YXRjaGVzIG9uIG5ld2x5IGNyZWF0
ZWQKICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdG9yaWVzIGluIHRoZSB3YXRjaCdzIHBh
dGggY29ycmVzcG9uZGluZyB0byB8d2R8LgogICAgICAgICAgICAgICAgICAgICAgICAgSWYgfGF1
dG9fYWRkfCBpcyBUcnVlLCBJTl9DUkVBVEUgaXMgb3JlZCB3aXRoIHxtYXNrfAogICAgICAgICAg
ICAgICAgICAgICAgICAgd2hlbiB0aGUgd2F0Y2ggaXMgdXBkYXRlZC4KICAgICAgICBAdHlwZSBh
dXRvX2FkZDogYm9vbAogICAgICAgIEBwYXJhbSBxdWlldDogSWYgRmFsc2UgcmFpc2VzIGEgV2F0
Y2hNYW5hZ2VyRXJyb3IgZXhjZXB0aW9uIG9uCiAgICAgICAgICAgICAgICAgICAgICBlcnJvci4g
U2VlIGV4YW1wbGUgbm90X3F1aWV0LnB5CiAgICAgICAgQHR5cGUgcXVpZXQ6IGJvb2wKICAgICAg
ICBAcmV0dXJuOiBkaWN0IG9mIHdhdGNoIGRlc2NyaXB0b3JzIGFzc29jaWF0ZWQgdG8gYm9vbGVh
bnMgdmFsdWVzLgogICAgICAgICAgICAgICAgIFRydWUgaWYgdGhlIGNvcnJlc3BvbmRpbmcgd2Qg
aGFzIGJlZW4gc3VjY2Vzc2Z1bGx5CiAgICAgICAgICAgICAgICAgdXBkYXRlZCwgRmFsc2Ugb3Ro
ZXJ3aXNlLgogICAgICAgIEBydHlwZTogZGljdCBvZiB7aW50OiBib29sfQogICAgICAgICIiIgog
ICAgICAgIGx3ZCA9IHNlbGYuX19mb3JtYXRfcGFyYW0od2QpCiAgICAgICAgaWYgcmVjOgogICAg
ICAgICAgICBsd2QgPSBzZWxmLl9fZ2V0X3N1Yl9yZWMobHdkKQoKICAgICAgICByZXRfID0ge30g
ICMgcmV0dXJuIHt3ZDogYm9vbCwgLi4ufQogICAgICAgIGZvciBhd2QgaW4gbHdkOgogICAgICAg
ICAgICBhcGF0aCA9IHNlbGYuZ2V0X3BhdGgoYXdkKQogICAgICAgICAgICBpZiBub3QgYXBhdGgg
b3IgYXdkIDwgMDoKICAgICAgICAgICAgICAgIGVyciA9ICd1cGRhdGVfd2F0Y2g6IGludmFsaWQg
V0Q9JWQnICUgYXdkCiAgICAgICAgICAgICAgICBpZiBxdWlldDoKICAgICAgICAgICAgICAgICAg
ICBsb2cuZXJyb3IoZXJyKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAg
ICAgICByYWlzZSBXYXRjaE1hbmFnZXJFcnJvcihlcnIsIHJldF8pCgogICAgICAgICAgICBpZiBt
YXNrOgogICAgICAgICAgICAgICAgd2RfID0gc2VsZi5faW5vdGlmeV93cmFwcGVyLmlub3RpZnlf
YWRkX3dhdGNoKHNlbGYuX2ZkLCBhcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXNrKQogICAgICAgICAgICAgICAgaWYg
d2RfIDwgMDoKICAgICAgICAgICAgICAgICAgICByZXRfW2F3ZF0gPSBGYWxzZQogICAgICAgICAg
ICAgICAgICAgIGVyciA9ICgndXBkYXRlX3dhdGNoOiBjYW5ub3QgdXBkYXRlICVzIFdEPSVkLCAl
cycgJSBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYXBhdGgsIHdkXywgc2VsZi5f
aW5vdGlmeV93cmFwcGVyLnN0cl9lcnJubygpKSkKICAgICAgICAgICAgICAgICAgICBpZiBxdWll
dDoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmVycm9yKGVycikKICAgICAgICAgICAgICAg
ICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICByYWlzZSBXYXRjaE1hbmFnZXJF
cnJvcihlcnIsIHJldF8pCgogICAgICAgICAgICAgICAgYXNzZXJ0KGF3ZCA9PSB3ZF8pCgogICAg
ICAgICAgICBpZiBwcm9jX2Z1biBvciBhdXRvX2FkZDoKICAgICAgICAgICAgICAgIHdhdGNoXyA9
IHNlbGYuX3dtZFthd2RdCgogICAgICAgICAgICBpZiBwcm9jX2Z1bjoKICAgICAgICAgICAgICAg
IHdhdGNoXy5wcm9jX2Z1biA9IHByb2NfZnVuCgogICAgICAgICAgICBpZiBhdXRvX2FkZDoKICAg
ICAgICAgICAgICAgIHdhdGNoXy5hdXRvX2FkZCA9IGF1dG9fYWRkCgogICAgICAgICAgICByZXRf
W2F3ZF0gPSBUcnVlCiAgICAgICAgICAgIGxvZy5kZWJ1ZygnVXBkYXRlZCB3YXRjaCAtICVzJywg
c2VsZi5fd21kW2F3ZF0pCiAgICAgICAgcmV0dXJuIHJldF8KCiAgICBkZWYgX19mb3JtYXRfcGFy
YW0oc2VsZiwgcGFyYW0pOgogICAgICAgICIiIgogICAgICAgIEBwYXJhbSBwYXJhbTogUGFyYW1l
dGVyLgogICAgICAgIEB0eXBlIHBhcmFtOiBzdHJpbmcgb3IgaW50CiAgICAgICAgQHJldHVybjog
d3JhcCBwYXJhbS4KICAgICAgICBAcnR5cGU6IGxpc3Qgb2YgdHlwZShwYXJhbSkKICAgICAgICAi
IiIKICAgICAgICBpZiBpc2luc3RhbmNlKHBhcmFtLCBsaXN0KToKICAgICAgICAgICAgZm9yIHBf
IGluIHBhcmFtOgogICAgICAgICAgICAgICAgeWllbGQgcF8KICAgICAgICBlbHNlOgogICAgICAg
ICAgICB5aWVsZCBwYXJhbQoKICAgIGRlZiBnZXRfd2Qoc2VsZiwgcGF0aCk6CiAgICAgICAgIiIi
CiAgICAgICAgUmV0dXJucyB0aGUgd2F0Y2ggZGVzY3JpcHRvciBhc3NvY2lhdGVkIHRvIHBhdGgu
IFRoaXMgbWV0aG9kCiAgICAgICAgcHJlc2VudHMgYSBwcm9oaWJpdGl2ZSBjb3N0LCBhbHdheXMg
cHJlZmVyIHRvIGtlZXAgdGhlIFdECiAgICAgICAgcmV0dXJuZWQgYnkgYWRkX3dhdGNoKCkuIElm
IHRoZSBwYXRoIGlzIHVua25vd24gaXQgcmV0dXJucyBOb25lLgoKICAgICAgICBAcGFyYW0gcGF0
aDogUGF0aC4KICAgICAgICBAdHlwZSBwYXRoOiBzdHIKICAgICAgICBAcmV0dXJuOiBXRCBvciBO
b25lLgogICAgICAgIEBydHlwZTogaW50IG9yIE5vbmUKICAgICAgICAiIiIKICAgICAgICBwYXRo
ID0gc2VsZi5fX2Zvcm1hdF9wYXRoKHBhdGgpCiAgICAgICAgZm9yIGl3ZCBpbiBzZWxmLl93bWQu
aXRlbXMoKToKICAgICAgICAgICAgaWYgaXdkWzFdLnBhdGggPT0gcGF0aDoKICAgICAgICAgICAg
ICAgIHJldHVybiBpd2RbMF0KCiAgICBkZWYgZ2V0X3BhdGgoc2VsZiwgd2QpOgogICAgICAgICIi
IgogICAgICAgIFJldHVybnMgdGhlIHBhdGggYXNzb2NpYXRlZCB0byBXRCwgaWYgV0QgaXMgdW5r
bm93biBpdCByZXR1cm5zIE5vbmUuCgogICAgICAgIEBwYXJhbSB3ZDogV2F0Y2ggZGVzY3JpcHRv
ci4KICAgICAgICBAdHlwZSB3ZDogaW50CiAgICAgICAgQHJldHVybjogUGF0aCBvciBOb25lLgog
ICAgICAgIEBydHlwZTogc3RyaW5nIG9yIE5vbmUKICAgICAgICAiIiIKICAgICAgICB3YXRjaF8g
PSBzZWxmLl93bWQuZ2V0KHdkKQogICAgICAgIGlmIHdhdGNoXyBpcyBub3QgTm9uZToKICAgICAg
ICAgICAgcmV0dXJuIHdhdGNoXy5wYXRoCgogICAgZGVmIF9fd2Fsa19yZWMoc2VsZiwgdG9wLCBy
ZWMpOgogICAgICAgICIiIgogICAgICAgIFlpZWxkcyBlYWNoIHN1YmRpcmVjdG9yaWVzIG9mIHRv
cCwgZG9lc24ndCBmb2xsb3cgc3ltbGlua3MuCiAgICAgICAgSWYgcmVjIGlzIGZhbHNlLCBvbmx5
IHlpZWxkIHRvcC4KCiAgICAgICAgQHBhcmFtIHRvcDogcm9vdCBkaXJlY3RvcnkuCiAgICAgICAg
QHR5cGUgdG9wOiBzdHJpbmcKICAgICAgICBAcGFyYW0gcmVjOiByZWN1cnNpdmUgZmxhZy4KICAg
ICAgICBAdHlwZSByZWM6IGJvb2wKICAgICAgICBAcmV0dXJuOiBwYXRoIG9mIG9uZSBzdWJkaXJl
Y3RvcnkuCiAgICAgICAgQHJ0eXBlOiBzdHJpbmcKICAgICAgICAiIiIKICAgICAgICBpZiBub3Qg
cmVjIG9yIG9zLnBhdGguaXNsaW5rKHRvcCkgb3Igbm90IG9zLnBhdGguaXNkaXIodG9wKToKICAg
ICAgICAgICAgeWllbGQgdG9wCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZm9yIHJvb3QsIGRp
cnMsIGZpbGVzIGluIG9zLndhbGsodG9wKToKICAgICAgICAgICAgICAgIHlpZWxkIHJvb3QKCiAg
ICBkZWYgcm1fd2F0Y2goc2VsZiwgd2QsIHJlYz1GYWxzZSwgcXVpZXQ9VHJ1ZSk6CiAgICAgICAg
IiIiCiAgICAgICAgUmVtb3ZlcyB3YXRjaChzKS4KCiAgICAgICAgQHBhcmFtIHdkOiBXYXRjaCBE
ZXNjcmlwdG9yIG9mIHRoZSBmaWxlIG9yIGRpcmVjdG9yeSB0byB1bndhdGNoLgogICAgICAgICAg
ICAgICAgICAgQWxzbyBhY2NlcHRzIGEgbGlzdCBvZiBXRHMuCiAgICAgICAgQHR5cGUgd2Q6IGlu
dCBvciBsaXN0IG9mIGludC4KICAgICAgICBAcGFyYW0gcmVjOiBSZWN1cnNpdmVseSByZW1vdmVz
IHdhdGNoZXMgb24gZXZlcnkgYWxyZWFkeSB3YXRjaGVkCiAgICAgICAgICAgICAgICAgICAgc3Vi
ZGlyZWN0b3JpZXMgYW5kIHN1YmZpbGVzLgogICAgICAgIEB0eXBlIHJlYzogYm9vbAogICAgICAg
IEBwYXJhbSBxdWlldDogSWYgRmFsc2UgcmFpc2VzIGEgV2F0Y2hNYW5hZ2VyRXJyb3IgZXhjZXB0
aW9uIG9uCiAgICAgICAgICAgICAgICAgICAgICBlcnJvci4gU2VlIGV4YW1wbGUgbm90X3F1aWV0
LnB5CiAgICAgICAgQHR5cGUgcXVpZXQ6IGJvb2wKICAgICAgICBAcmV0dXJuOiBkaWN0IG9mIHdh
dGNoIGRlc2NyaXB0b3JzIGFzc29jaWF0ZWQgdG8gYm9vbGVhbnMgdmFsdWVzLgogICAgICAgICAg
ICAgICAgIFRydWUgaWYgdGhlIGNvcnJlc3BvbmRpbmcgd2QgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5
CiAgICAgICAgICAgICAgICAgcmVtb3ZlZCwgRmFsc2Ugb3RoZXJ3aXNlLgogICAgICAgIEBydHlw
ZTogZGljdCBvZiB7aW50OiBib29sfQogICAgICAgICIiIgogICAgICAgIGx3ZCA9IHNlbGYuX19m
b3JtYXRfcGFyYW0od2QpCiAgICAgICAgaWYgcmVjOgogICAgICAgICAgICBsd2QgPSBzZWxmLl9f
Z2V0X3N1Yl9yZWMobHdkKQoKICAgICAgICByZXRfID0ge30gICMgcmV0dXJuIHt3ZDogYm9vbCwg
Li4ufQogICAgICAgIGZvciBhd2QgaW4gbHdkOgogICAgICAgICAgICAjIHJlbW92ZSB3YXRjaAog
ICAgICAgICAgICB3ZF8gPSBzZWxmLl9pbm90aWZ5X3dyYXBwZXIuaW5vdGlmeV9ybV93YXRjaChz
ZWxmLl9mZCwgYXdkKQogICAgICAgICAgICBpZiB3ZF8gPCAwOgogICAgICAgICAgICAgICAgcmV0
X1thd2RdID0gRmFsc2UKICAgICAgICAgICAgICAgIGVyciA9ICgncm1fd2F0Y2g6IGNhbm5vdCBy
ZW1vdmUgV0Q9JWQsICVzJyAlIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgKGF3ZCwgc2Vs
Zi5faW5vdGlmeV93cmFwcGVyLnN0cl9lcnJubygpKSkKICAgICAgICAgICAgICAgIGlmIHF1aWV0
OgogICAgICAgICAgICAgICAgICAgIGxvZy5lcnJvcihlcnIpCiAgICAgICAgICAgICAgICAgICAg
Y29udGludWUKICAgICAgICAgICAgICAgIHJhaXNlIFdhdGNoTWFuYWdlckVycm9yKGVyciwgcmV0
XykKCiAgICAgICAgICAgICMgUmVtb3ZlIHdhdGNoIGZyb20gb3VyIGRpY3Rpb25hcnkKICAgICAg
ICAgICAgaWYgYXdkIGluIHNlbGYuX3dtZDoKICAgICAgICAgICAgICAgIGRlbCBzZWxmLl93bWRb
YXdkXQogICAgICAgICAgICByZXRfW2F3ZF0gPSBUcnVlCiAgICAgICAgICAgIGxvZy5kZWJ1Zygn
V2F0Y2ggV0Q9JWQgKCVzKSByZW1vdmVkJywgYXdkLCBzZWxmLmdldF9wYXRoKGF3ZCkpCiAgICAg
ICAgcmV0dXJuIHJldF8KCgogICAgZGVmIHdhdGNoX3RyYW5zaWVudF9maWxlKHNlbGYsIGZpbGVu
YW1lLCBtYXNrLCBwcm9jX2NsYXNzKToKICAgICAgICAiIiIKICAgICAgICBXYXRjaCBhIHRyYW5z
aWVudCBmaWxlLCB3aGljaCB3aWxsIGJlIGNyZWF0ZWQgYW5kIGRlbGV0ZWQgZnJlcXVlbnRseQog
ICAgICAgIG92ZXIgdGltZSAoZS5nLiBwaWQgZmlsZSkuCgogICAgICAgIEBhdHRlbnRpb246IEN1
cnJlbnRseSB1bmRlciB0aGUgY2FsbCB0byB0aGlzIGZ1bmN0aW9uIGl0IGlzIG5vdAogICAgICAg
IHBvc3NpYmxlIHRvIGNvcnJlY3RseSB3YXRjaCB0aGUgZXZlbnRzIHRyaWdnZXJlZCBpbnRvIHRo
ZSBzYW1lCiAgICAgICAgYmFzZSBkaXJlY3RvcnkgdGhhbiB0aGUgZGlyZWN0b3J5IHdoZXJlIGlz
IGxvY2F0ZWQgdGhpcyB3YXRjaGVkCiAgICAgICAgdHJhbnNpZW50IGZpbGUuIEZvciBpbnN0YW5j
ZSBpdCB3b3VsZCBiZSB3cm9uZyB0byBtYWtlIHRoZXNlCiAgICAgICAgdHdvIHN1Y2Nlc3NpdmUg
Y2FsbHM6IHdtLndhdGNoX3RyYW5zaWVudF9maWxlKCcvdmFyL3J1bi9mb28ucGlkJywgLi4uKQog
ICAgICAgIGFuZCB3bS5hZGRfd2F0Y2goJy92YXIvcnVuLycsIC4uLikKCiAgICAgICAgQHBhcmFt
IGZpbGVuYW1lOiBGaWxlbmFtZS4KICAgICAgICBAdHlwZSBmaWxlbmFtZTogc3RyaW5nCiAgICAg
ICAgQHBhcmFtIG1hc2s6IEJpdG1hc2sgb2YgZXZlbnRzLCBzaG91bGQgY29udGFpbiBJTl9DUkVB
VEUgYW5kIElOX0RFTEVURS4KICAgICAgICBAdHlwZSBtYXNrOiBpbnQKICAgICAgICBAcGFyYW0g
cHJvY19jbGFzczogUHJvY2Vzc0V2ZW50IChvciBvZiBvbmUgb2YgaXRzIHN1YmNsYXNzKSwgYmV3
YXJlIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdGluZyBhIFByb2Nlc3NFdmVu
dCdzIGluc3RhbmNlIGFzIGFyZ3VtZW50IGludG8KICAgICAgICAgICAgICAgICAgICAgICAgICAg
X19pbml0X18sIHNlZSB0cmFuc2llbnRfZmlsZS5weSBleGFtcGxlIGZvciBtb3JlCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGRldGFpbHMuCiAgICAgICAgQHR5cGUgcHJvY19jbGFzczogUHJv
Y2Vzc0V2ZW50J3MgaW5zdGFuY2Ugb3Igb2Ygb25lIG9mIGl0cyBzdWJjbGFzc2VzLgogICAgICAg
IEByZXR1cm46IFNhbWUgYXMgYWRkX3dhdGNoKCkuCiAgICAgICAgQHJ0eXBlOiBTYW1lIGFzIGFk
ZF93YXRjaCgpLgogICAgICAgICIiIgogICAgICAgIGRpcm5hbWUgPSBvcy5wYXRoLmRpcm5hbWUo
ZmlsZW5hbWUpCiAgICAgICAgaWYgZGlybmFtZSA9PSAnJzoKICAgICAgICAgICAgcmV0dXJuIHt9
ICAjIE1haW50YWlucyBjb2hlcmVuY2Ugd2l0aCBhZGRfd2F0Y2goKQogICAgICAgIGJhc2VuYW1l
ID0gb3MucGF0aC5iYXNlbmFtZShmaWxlbmFtZSkKICAgICAgICAjIEFzc3VtaW5nIHdlIGFyZSB3
YXRjaGluZyBhdCBsZWFzdCBmb3IgSU5fQ1JFQVRFIGFuZCBJTl9ERUxFVEUKICAgICAgICBtYXNr
IHw9IElOX0NSRUFURSB8IElOX0RFTEVURQoKICAgICAgICBkZWYgY21wX25hbWUoZXZlbnQpOgog
ICAgICAgICAgICBpZiBnZXRhdHRyKGV2ZW50LCAnbmFtZScpIGlzIE5vbmU6CiAgICAgICAgICAg
ICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgcmV0dXJuIGJhc2VuYW1lID09IGV2ZW50Lm5h
bWUKICAgICAgICByZXR1cm4gc2VsZi5hZGRfd2F0Y2goZGlybmFtZSwgbWFzaywKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgcHJvY19mdW49cHJvY19jbGFzcyhDaGFpbklmVHJ1ZShmdW5j
PWNtcF9uYW1lKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYz1GYWxzZSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b19hZGQ9RmFsc2UsIGRvX2dsb2I9RmFsc2Us
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGVfZmlsdGVyPWxhbWJkYSBwYXRo
OiBGYWxzZSkKCiAgICBkZWYgZ2V0X2lnbm9yZV9ldmVudHMoc2VsZik6CiAgICAgICAgcmV0dXJu
IHNlbGYuX2lnbm9yZV9ldmVudHMKCiAgICBkZWYgc2V0X2lnbm9yZV9ldmVudHMoc2VsZiwgbnZh
bCk6CiAgICAgICAgc2VsZi5faWdub3JlX2V2ZW50cyA9IG52YWwKCiAgICBpZ25vcmVfZXZlbnRz
ID0gcHJvcGVydHkoZ2V0X2lnbm9yZV9ldmVudHMsIHNldF9pZ25vcmVfZXZlbnRzLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICJNYWtlIHdhdGNoIG1hbmFnZXIgaWdub3JpbmcgbmV3IGV2
ZW50cy4iKQoKCmNsYXNzIFJhd091dHB1dEZvcm1hdDoKICAgICIiIgogICAgRm9ybWF0IHN0cmlu
ZyByZXByZXNlbnRhdGlvbnMuCiAgICAiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmb3JtYXQ9
Tm9uZSk6CiAgICAgICAgc2VsZi5mb3JtYXQgPSBmb3JtYXQgb3Ige30KCiAgICBkZWYgc2ltcGxl
KHNlbGYsIHMsIGF0dHJpYnV0ZSk6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uocywgc3RyKToK
ICAgICAgICAgICAgcyA9IHN0cihzKQogICAgICAgIHJldHVybiAoc2VsZi5mb3JtYXQuZ2V0KGF0
dHJpYnV0ZSwgJycpICsgcyArCiAgICAgICAgICAgICAgICBzZWxmLmZvcm1hdC5nZXQoJ25vcm1h
bCcsICcnKSkKCiAgICBkZWYgcHVuY3R1YXRpb24oc2VsZiwgcyk6CiAgICAgICAgIiIiUHVuY3R1
YXRpb24gY29sb3IuIiIiCiAgICAgICAgcmV0dXJuIHNlbGYuc2ltcGxlKHMsICdub3JtYWwnKQoK
ICAgIGRlZiBmaWVsZF92YWx1ZShzZWxmLCBzKToKICAgICAgICAiIiJGaWVsZCB2YWx1ZSBjb2xv
ci4iIiIKICAgICAgICByZXR1cm4gc2VsZi5zaW1wbGUocywgJ3B1cnBsZScpCgogICAgZGVmIGZp
ZWxkX25hbWUoc2VsZiwgcyk6CiAgICAgICAgIiIiRmllbGQgbmFtZSBjb2xvci4iIiIKICAgICAg
ICByZXR1cm4gc2VsZi5zaW1wbGUocywgJ2JsdWUnKQoKICAgIGRlZiBjbGFzc19uYW1lKHNlbGYs
IHMpOgogICAgICAgICIiIkNsYXNzIG5hbWUgY29sb3IuIiIiCiAgICAgICAgcmV0dXJuIHNlbGYu
Zm9ybWF0LmdldCgncmVkJywgJycpICsgc2VsZi5zaW1wbGUocywgJ2JvbGQnKQoKb3V0cHV0X2Zv
cm1hdCA9IFJhd091dHB1dEZvcm1hdCgpCgpjbGFzcyBDb2xvcmVkT3V0cHV0Rm9ybWF0KFJhd091
dHB1dEZvcm1hdCk6CiAgICAiIiIKICAgIEZvcm1hdCBjb2xvcmVkIHN0cmluZyByZXByZXNlbnRh
dGlvbnMuCiAgICAiIiIKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBmID0geydub3Jt
YWwnOiAnXDAzM1swbScsCiAgICAgICAgICAgICAnYmxhY2snOiAnXDAzM1szMG0nLAogICAgICAg
ICAgICAgJ3JlZCc6ICdcMDMzWzMxbScsCiAgICAgICAgICAgICAnZ3JlZW4nOiAnXDAzM1szMm0n
LAogICAgICAgICAgICAgJ3llbGxvdyc6ICdcMDMzWzMzbScsCiAgICAgICAgICAgICAnYmx1ZSc6
ICdcMDMzWzM0bScsCiAgICAgICAgICAgICAncHVycGxlJzogJ1wwMzNbMzVtJywKICAgICAgICAg
ICAgICdjeWFuJzogJ1wwMzNbMzZtJywKICAgICAgICAgICAgICdib2xkJzogJ1wwMzNbMW0nLAog
ICAgICAgICAgICAgJ3VsaW5lJzogJ1wwMzNbNG0nLAogICAgICAgICAgICAgJ2JsaW5rJzogJ1ww
MzNbNW0nLAogICAgICAgICAgICAgJ2ludmVydCc6ICdcMDMzWzdtJ30KICAgICAgICBSYXdPdXRw
dXRGb3JtYXQuX19pbml0X18oc2VsZiwgZikKCgpkZWYgY29tcGF0aWJpbGl0eV9tb2RlKCk6CiAg
ICAiIiIKICAgIFVzZSB0aGlzIGZ1bmN0aW9uIHRvIHR1cm4gb24gdGhlIGNvbXBhdGliaWxpdHkg
bW9kZS4gVGhlIGNvbXBhdGliaWxpdHkKICAgIG1vZGUgaXMgdXNlZCB0byBpbXByb3ZlIGNvbXBh
dGliaWxpdHkgd2l0aCBQeWlub3RpZnkgMC43LjEgKG9yIG9sZGVyKQogICAgcHJvZ3JhbXMuIFRo
ZSBjb21wYXRpYmlsaXR5IG1vZGUgcHJvdmlkZXMgYWRkaXRpb25hbCB2YXJpYWJsZXMgJ2lzX2Rp
cicsCiAgICAnZXZlbnRfbmFtZScsICdFdmVudHNDb2Rlcy5JTl8qJyBhbmQgJ0V2ZW50c0NvZGVz
LkFMTF9FVkVOVFMnIGFzCiAgICBQeWlub3RpZnkgMC43LjEgcHJvdmlkZWQuIERvIG5vdCBjYWxs
IHRoaXMgZnVuY3Rpb24gZnJvbSBuZXcgcHJvZ3JhbXMhIQogICAgRXNwZWNpYWxseSBpZiB0aGVy
ZSBhcmUgZGV2ZWxvcHBlZCBmb3IgUHlpbm90aWZ5ID49IDAuOC54LgogICAgIiIiCiAgICBzZXRh
dHRyKEV2ZW50c0NvZGVzLCAnQUxMX0VWRU5UUycsIEFMTF9FVkVOVFMpCiAgICBmb3IgZXZuYW1l
IGluIGdsb2JhbHMoKToKICAgICAgICBpZiBldm5hbWUuc3RhcnRzd2l0aCgnSU5fJyk6CiAgICAg
ICAgICAgIHNldGF0dHIoRXZlbnRzQ29kZXMsIGV2bmFtZSwgZ2xvYmFscygpW2V2bmFtZV0pCiAg
ICBnbG9iYWwgQ09NUEFUSUJJTElUWV9NT0RFCiAgICBDT01QQVRJQklMSVRZX01PREUgPSBUcnVl
CgoKZGVmIGNvbW1hbmRfbGluZSgpOgogICAgIiIiCiAgICBCeSBkZWZhdWx0IHRoZSB3YXRjaGVk
IHBhdGggaXMgJy90bXAnIGFuZCBhbGwgdHlwZXMgb2YgZXZlbnRzIGFyZQogICAgbW9uaXRvcmVk
LiBFdmVudHMgbW9uaXRvcmluZyBzZXJ2ZXMgZm9yZXZlciwgdHlwZSBjXmMgdG8gc3RvcCBpdC4K
ICAgICIiIgogICAgZnJvbSBvcHRwYXJzZSBpbXBvcnQgT3B0aW9uUGFyc2VyCgogICAgdXNhZ2Ug
PSAidXNhZ2U6ICVwcm9nIFtvcHRpb25zXSBbcGF0aDFdIFtwYXRoMl0gW3BhdGhuXSIKCiAgICBw
YXJzZXIgPSBPcHRpb25QYXJzZXIodXNhZ2U9dXNhZ2UpCiAgICBwYXJzZXIuYWRkX29wdGlvbigi
LXYiLCAiLS12ZXJib3NlIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwKICAgICAgICAgICAgICAgICAg
ICAgIGRlc3Q9InZlcmJvc2UiLCBoZWxwPSJWZXJib3NlIG1vZGUiKQogICAgcGFyc2VyLmFkZF9v
cHRpb24oIi1yIiwgIi0tcmVjdXJzaXZlIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwKICAgICAgICAg
ICAgICAgICAgICAgIGRlc3Q9InJlY3Vyc2l2ZSIsCiAgICAgICAgICAgICAgICAgICAgICBoZWxw
PSJBZGQgd2F0Y2hlcyByZWN1cnNpdmVseSBvbiBwYXRocyIpCiAgICBwYXJzZXIuYWRkX29wdGlv
bigiLWEiLCAiLS1hdXRvX2FkZCIsIGFjdGlvbj0ic3RvcmVfdHJ1ZSIsCiAgICAgICAgICAgICAg
ICAgICAgICBkZXN0PSJhdXRvX2FkZCIsCiAgICAgICAgICAgICAgICAgICAgICBoZWxwPSJBdXRv
bWF0aWNhbGx5IGFkZCB3YXRjaGVzIG9uIG5ldyBkaXJlY3RvcmllcyIpCiAgICBwYXJzZXIuYWRk
X29wdGlvbigiLWciLCAiLS1nbG9iIiwgYWN0aW9uPSJzdG9yZV90cnVlIiwKICAgICAgICAgICAg
ICAgICAgICAgIGRlc3Q9Imdsb2IiLAogICAgICAgICAgICAgICAgICAgICAgaGVscD0iVHJlYXQg
cGF0aHMgYXMgZ2xvYnMiKQogICAgcGFyc2VyLmFkZF9vcHRpb24oIi1lIiwgIi0tZXZlbnRzLWxp
c3QiLCBtZXRhdmFyPSJFVkVOVFssLi4uXSIsCiAgICAgICAgICAgICAgICAgICAgICBkZXN0PSJl
dmVudHNfbGlzdCIsCiAgICAgICAgICAgICAgICAgICAgICBoZWxwPSgiQSBjb21tYS1zZXBhcmF0
ZWQgbGlzdCBvZiBldmVudHMgdG8gd2F0Y2ggZm9yIC0gIgogICAgICAgICAgICAgICAgICAgICAg
ICAgICAic2VlIHRoZSBkb2N1bWVudGF0aW9uIGZvciB2YWxpZCBvcHRpb25zIChkZWZhdWx0cyIK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIiB0byBldmVyeXRoaW5nKSIpKQogICAgcGFyc2Vy
LmFkZF9vcHRpb24oIi1zIiwgIi0tc3RhdHMiLCBhY3Rpb249InN0b3JlX3RydWUiLAogICAgICAg
ICAgICAgICAgICAgICAgZGVzdD0ic3RhdHMiLAogICAgICAgICAgICAgICAgICAgICAgaGVscD0i
RGlzcGxheSBkdW1teSBzdGF0aXN0aWNzIikKICAgIHBhcnNlci5hZGRfb3B0aW9uKCItViIsICIt
LXZlcnNpb24iLCBhY3Rpb249InN0b3JlX3RydWUiLAogICAgICAgICAgICAgICAgICAgICAgZGVz
dD0idmVyc2lvbiIsICBoZWxwPSJQeWlub3RpZnkgdmVyc2lvbiIpCiAgICBwYXJzZXIuYWRkX29w
dGlvbigiLWYiLCAiLS1yYXctZm9ybWF0IiwgYWN0aW9uPSJzdG9yZV90cnVlIiwKICAgICAgICAg
ICAgICAgICAgICAgIGRlc3Q9InJhd19mb3JtYXQiLAogICAgICAgICAgICAgICAgICAgICAgaGVs
cD0iRGlzYWJsZSBlbmhhbmNlZCBvdXRwdXQgZm9ybWF0LiIpCiAgICBwYXJzZXIuYWRkX29wdGlv
bigiLWMiLCAiLS1jb21tYW5kIiwgYWN0aW9uPSJzdG9yZSIsCiAgICAgICAgICAgICAgICAgICAg
ICBkZXN0PSJjb21tYW5kIiwKICAgICAgICAgICAgICAgICAgICAgIGhlbHA9IlNoZWxsIGNvbW1h
bmQgdG8gcnVuIHVwb24gZXZlbnQiKQoKICAgIChvcHRpb25zLCBhcmdzKSA9IHBhcnNlci5wYXJz
ZV9hcmdzKCkKCiAgICBpZiBvcHRpb25zLnZlcmJvc2U6CiAgICAgICAgbG9nLnNldExldmVsKDEw
KQoKICAgIGlmIG9wdGlvbnMudmVyc2lvbjoKICAgICAgICBwcmludChfX3ZlcnNpb25fXykKCiAg
ICBpZiBub3Qgb3B0aW9ucy5yYXdfZm9ybWF0OgogICAgICAgIGdsb2JhbCBvdXRwdXRfZm9ybWF0
CiAgICAgICAgb3V0cHV0X2Zvcm1hdCA9IENvbG9yZWRPdXRwdXRGb3JtYXQoKQoKICAgIGlmIGxl
bihhcmdzKSA8IDE6CiAgICAgICAgcGF0aCA9ICcvdG1wJyAgIyBkZWZhdWx0IHdhdGNoZWQgcGF0
aAogICAgZWxzZToKICAgICAgICBwYXRoID0gYXJncwoKICAgICMgd2F0Y2ggbWFuYWdlciBpbnN0
YW5jZQogICAgd20gPSBXYXRjaE1hbmFnZXIoKQogICAgIyBub3RpZmllciBpbnN0YW5jZSBhbmQg
aW5pdAogICAgaWYgb3B0aW9ucy5zdGF0czoKICAgICAgICBub3RpZmllciA9IE5vdGlmaWVyKHdt
LCBkZWZhdWx0X3Byb2NfZnVuPVN0YXRzKCksIHJlYWRfZnJlcT01KQogICAgZWxzZToKICAgICAg
ICBub3RpZmllciA9IE5vdGlmaWVyKHdtLCBkZWZhdWx0X3Byb2NfZnVuPVByaW50QWxsRXZlbnRz
KCkpCgogICAgIyBXaGF0IG1hc2sgdG8gYXBwbHkKICAgIG1hc2sgPSAwCiAgICBpZiBvcHRpb25z
LmV2ZW50c19saXN0OgogICAgICAgIGV2ZW50c19saXN0ID0gb3B0aW9ucy5ldmVudHNfbGlzdC5z
cGxpdCgnLCcpCiAgICAgICAgZm9yIGV2IGluIGV2ZW50c19saXN0OgogICAgICAgICAgICBldmNv
ZGUgPSBFdmVudHNDb2Rlcy5BTExfRkxBR1MuZ2V0KGV2LCAwKQogICAgICAgICAgICBpZiBldmNv
ZGU6CiAgICAgICAgICAgICAgICBtYXNrIHw9IGV2Y29kZQogICAgICAgICAgICBlbHNlOgogICAg
ICAgICAgICAgICAgcGFyc2VyLmVycm9yKCJUaGUgZXZlbnQgJyVzJyBzcGVjaWZpZWQgd2l0aCBv
cHRpb24gLWUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBpcyBub3QgdmFsaWQiICUg
ZXYpCiAgICBlbHNlOgogICAgICAgIG1hc2sgPSBBTExfRVZFTlRTCgogICAgIyBzdGF0cwogICAg
Y2JfZnVuID0gTm9uZQogICAgaWYgb3B0aW9ucy5zdGF0czoKICAgICAgICBkZWYgY2Iocyk6CiAg
ICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUocmVwcihzLnByb2NfZnVuKCkpKQogICAgICAgICAg
ICBzeXMuc3Rkb3V0LndyaXRlKCdcbicpCiAgICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUoc3Ry
KHMucHJvY19mdW4oKSkpCiAgICAgICAgICAgIHN5cy5zdGRvdXQud3JpdGUoJ1xuJykKICAgICAg
ICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgY2JfZnVuID0gY2IKCiAgICAjIEV4dGVy
bmFsIGNvbW1hbmQKICAgIGlmIG9wdGlvbnMuY29tbWFuZDoKICAgICAgICBkZWYgY2Iocyk6CiAg
ICAgICAgICAgIHN1YnByb2Nlc3MuUG9wZW4ob3B0aW9ucy5jb21tYW5kLCBzaGVsbD1UcnVlKQog
ICAgICAgIGNiX2Z1biA9IGNiCgogICAgbG9nLmRlYnVnKCdTdGFydCBtb25pdG9yaW5nICVzLCAo
cHJlc3MgY15jIHRvIGhhbHQgcHlpbm90aWZ5KScgJSBwYXRoKQoKICAgIHdtLmFkZF93YXRjaChw
YXRoLCBtYXNrLCByZWM9b3B0aW9ucy5yZWN1cnNpdmUsIGF1dG9fYWRkPW9wdGlvbnMuYXV0b19h
ZGQsIGRvX2dsb2I9b3B0aW9ucy5nbG9iKQogICAgIyBMb29wIGZvcmV2ZXIgKHVudGlsIHNpZ2lu
dCBzaWduYWwgZ2V0IGNhdWdodCkKICAgIG5vdGlmaWVyLmxvb3AoY2FsbGJhY2s9Y2JfZnVuKQoK
CmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBjb21tYW5kX2xpbmUoKQo=
'''


def extract_pyinotify(path):
    logging.info(u'释放pyinotify.py到当前目录')
    try:
        fp = open(path + 'pyinotify.py', 'w')
        fp.write(pyinotifydata.decode('base64'))
        fp.close()
    except Exception as err:
        logging.fatal(u'无法释放pyinotify.py到当前目录!')
        logging.info(u'请自行复制pyinotify.py到当前目录！')
        logging.debug(err)
        raise err

try:
    logging.info(u'加载pyinotify模块')
    import pyinotify
except Exception as err:
    logging.error(u'尝试包含pynotify失败！')
    logging.debug(err)
    try:
        extract_pyinotify('./')
        import pyinotify
    except Exception as err1:
        raise err1

def backup(args):
    bakpath, fullname = args
    # 计算文件名的MD5
    m = md5(fullname)
    f_md5 = m.hexdigest()
    path = os.path.join(bakpath, f_md5[:2])
    try:
        if not os.access(path, os.F_OK):
            os.makedirs(path)
            logging.info(u'创建备份目录 %s' %path)
    except Exception as err:
        logging.error(u'创建备份目录 %s 失败' % path)
        logging.debug(err)
        return False
    # 开始计算文件MD5
    logging.info(u'开始备份文件 %s 到 %s' % (fullname, os.path.join(path, f_md5)))
    if not os.access(fullname, os.R_OK):
        logging.error(u'文件 %s 不可读，备份失败！' % fullname)
        return False
    if not os.access(path, os.W_OK):
        logging.error(u'备份目录 %s 不可写，备份失败！' % path)
        return False
    fp = open(fullname, 'rb')
    data = fp.read()
    fp.close()
    m = md5(data)
    fp = open(os.path.join(path, f_md5), 'wb')
    fp.write(pack('I', len(m.hexdigest())))
    fp.write(m.hexdigest())
    fp.write(pack('I', len(fullname)))
    fp.write(fullname)
    fp.write(pack('I', len(data)));
    fp.write(data)
    fp.flush()
    fp.close()
    logging.info(u'备份文件 %s 到 %s 完成' % (fullname, os.path.join(path, f_md5)))
    return True

def backup_data(args):
    bakpath, fullname, data = args
    # 计算文件名的MD5
    m = md5(fullname)
    f_md5 = m.hexdigest()
    path = os.path.join(bakpath, f_md5[:2])
    try:
        if not os.access(path, os.F_OK):
            os.makedirs(path)
            logging.info(u'创建备份目录 %s' %path)
    except Exception as err:
        logging.error(u'创建备份目录 %s 失败' % path)
        logging.debug(err)
        return False
    # 开始计算文件MD5
    logging.info(u'开始备份文件 %s 到 %s' % (fullname, os.path.join(path, f_md5)))
    
    m = md5(data)
    fp = open(os.path.join(path, f_md5), 'wb')
    fp.write(pack('I', len(m.hexdigest())))
    fp.write(m.hexdigest())
    fp.write(pack('I', len(fullname)))
    fp.write(fullname)
    fp.write(pack('I', len(data)));
    fp.write(data)
    fp.flush()
    fp.close()
    logging.info(u'备份文件 %s 到 %s 完成' % (fullname, os.path.join(path, f_md5)))
    return True
    

def file_backuper(args):
    targetpath, bakpath = args
    w = os.walk(targetpath)
    targets = []
    while True:
        try:
            path, dirs,files = w.next()
            for f in files:
                targets.append((bakpath, os.path.join(path,f)))
        except:
            break
    logging.info(u'开始备份文件')
    pool = Pool(5)
    results = pool.map(backup, targets)
    pool.close()
    pool.join()

def remove_dir(pathname):
    lst = os.listdir(pathname)
    for v in lst:
        f = os.path.join(pathname, v)
        if os.path.isfile(f):
            try:
                os.remove(f)
            except:
                pass
        elif os.path.islink(f):
            try:
                os.unlink(f)
            except:
                pass
        elif os.path.isdir(f):
            remove_dir(f)
    try:
        os.rmdir(pathname)
    except:
        pass
            



def find_all(pattern, content, pos=0):
    ret = ''
    match = pattern.search(content, pos)
    if match is not None:
        ret = find_all(pattern, content, match.span()[1])
        return ret + match.group(0)
    else:
        return ret
def replace(content):
    flag = False
    p_eval = re.compile('(@?\s*(assert|eval|system|exec)\s*\(\s*\$_(POST|GET|REQUEST|COOKIE|SERVER)\s*\[[^\]]+?\][^\)]*?\)[^;]*?;)')
    ma = p_eval.search(content)
    logging.debug(ma)
    flag = ma is not None
    item = ''
    if flag:
        item = find_all(p_eval, content, pos=0)
        content = p_eval.sub(lambda m:'/*'+m.group(0)+'*/', content)
    if flag:
        return (flag, item, content)
    else:
        return (flag, None, content)

def filecontent_check(fullname, bakpath):
    m = md5(fullname)
    f_md5 = m.hexdigest()
    b_path = os.path.join(bakpath, f_md5[:2], f_md5)
    logging.info(u'检查备份文件: %s 是否存在' % b_path)
    if not os.access(b_path, os.F_OK):
        logging.info(u'备份文件: %s 不存在，开始检查文件内容' % b_path)
        if not os.access(fullname, os.R_OK | os.W_OK):
            logging.error(u'文件 %s 不可读写' % fullname)
            return
        fp = open(fullname, 'r')
        data = fp.read()
        fp.close()
        # logging.debug('Before: %s' % data)
        flag, item, data = replace(data)
        # logging.debug('After: %s' % data)
        backup_data((bakpath, fullname, data))
        if flag:
            logging.info(u'[%s] : (%s) is changed!' % (fullname, item))
            fp = open(fullname, 'w')
            fp.write(data)
            fp.flush()
            fp.close()
    else:
        logging.info(u'备份文件: %s 存在，开始检查文件MD5' % b_path)
        if not os.access(fullname, os.R_OK | os.W_OK):
            logging.error(u'文件 %s 不可读写' % fullname)
            return
        fp = open(fullname, 'r')
        data = fp.read()
        fp.close()
        fb = open(b_path, 'rb')
        l, = unpack('I', fb.read(4))
        ms = fb.read(l)
        logging.debug(u'备份的MD5为: %s' % ms)
        m = md5(data)
        logging.debug(u'当前文件的MD5为: %s' % m.hexdigest())
        if ms != m.hexdigest():
            logging.info(u'文件 %s 的MD5与备份文件不一至，开始还原文件' % fullname)
            l,=unpack('I', fb.read(4))
            o_filename = fb.read(l)
            logging.info(u'原始文件名为: %s' % o_filename)
            l,=unpack('I', fb.read(4))
            logging.info(u'原始文件长度为: %d 字节' % l)
            fp = open(fullname, 'w')
            fp.write(fb.read(l))
            fp.flush()
            fp.close()
            fb.close()
            
def file_checker(args):
    isDir, mask, fullname, bakpath = args
    p_filename = re.compile('^([^\.]+\.)+(php[0-9s]?|phtml)(.[^\.]+)*$')
    p_swp = re.compile('^.*\.swp$')
    p_imgs = re.compile('^.*\.(jpg|jpeg|png|bmp|gif)$')
    logging.info(u'检查文件名是否符合PHP文件名规则')
    if p_filename.match(fullname) is not None:
        if mask & pyinotify.IN_CREATE > 0:
            if isDir:
                logging.info(u'一个符合PHP文件名规则的目录被创建: %s' % fullname)
                remove_dir(fullname)
                logging.info(u'删除目录: %s' % fullname)
            else:
                logging.info(u'一个PHP文件被创建: %s' % fullname)
                filecontent_check(fullname, bakpath)
        elif mask & pyinotify.IN_MODIFY > 0 and not isDir:
            logging.info(u'一个PHP文件被修改: %s' % fullname)
            filecontent_check(fullname, bakpath)
        elif mask & pyinotify.IN_MOVED_TO:
            if isDir:
                logging.info(u'一个符合PHP文件名规则的目录被移动: %s' % fullname)
                remove_dir(fullname)
                logging.info(u'删除目录: %s' % fullname)
            else:
                logging.info(u'一个PHP文件被移动: %s' % fullname)
                filecontent_check(fullname, bakpath)
    elif p_swp.match(fullname) is not None:
        return
    elif p_imgs.match(fullname) is not None and not isDir:
        filecontent_check(fullname, bakpath)
    else:
        if not isDir:
            filecontent_check(fullname, bakpath)

class event_handler(pyinotify.ProcessEvent):

    def __init__(self, bakpath):
        self.bakpath = bakpath
        pyinotify.ProcessEvent.__init__(self)
        
    def process_IN_CREATE(self, event):
        fullname = os.path.join(event.path, event.name)
        logging.info(u'文件/目录 %s 被创建' % fullname)
        file_checker((event.dir, event.mask, fullname, self.bakpath))
        pass

    def process_IN_MODIFY(self, event):
        fullname = os.path.join(event.path, event.name)
        logging.info(u'文件/目录 %s 被修改' % fullname)
        file_checker((event.dir, event.mask, fullname, self.bakpath))
        pass

    def process_IN_MOVED_FROM(self, event):
        fullname = os.path.join(event.path, event.name)
        logging.info(u'文件/目录 %s 被移动(FROM)' % fullname)
        pass
    def process_IN_MOVED_TO(self, event):
        fullname = os.path.join(event.path, event.name)
        logging.info(u'文件/目录 %s 被移动(TO)' % fullname)
        file_checker((event.dir, event.mask, fullname, self.bakpath))
        pass

class monitor:
    def __init__(self, mon_path, bak_path):
        self.mon_path = mon_path
        self.bak_path = bak_path
        self.handle = pyinotify.WatchManager()
        self.notifier = pyinotify.Notifier(self.handle, event_handler(bak_path))
        
    def start_monitor(self, mask):
        path = self.mon_path
        logging.info(u'准备在目录 %s 上开始监控!' % path)
        try:
            self.handle.add_watch(path, mask, auto_add = True, rec = True)
        except Exception as err:
            logging.fatal(u'在目录 %s 上添加监控失败！' % path)
            logging.debug(err)
            raise err
        logging.info(u'在目录 %s 上开始监控!' % path)
        while True:
            try:
                self.notifier.process_events()
                if self.notifier.check_events():
                    self.notifier.read_events()
            except KeyboardInterrupt:
                logging.info(u'收到键盘中断,退出监控')
                self.notifier.stop()
                break
        
if __name__ == '__main__':
    file_backuper(('/var/www/html', './bak'))
    mon = monitor('/var/www/html', './bak')
    mon.start_monitor(
        pyinotify.IN_CREATE | pyinotify.IN_MOVED_FROM | pyinotify.IN_MOVED_TO | pyinotify.IN_MODIFY
    )    
